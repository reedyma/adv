<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Choose Your Own Adventure</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Simple fade-in animation for new content */
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4 transition-colors duration-500">

    <!-- Screen for selecting a color theme -->
    <div id="color-selection-screen" class="w-full max-w-md bg-gray-800 rounded-xl shadow-2xl p-6 md:p-8 text-center fade-in hidden">
        <h1 class="text-3xl font-bold mb-4 text-white">Pick A Theme</h1>
        <p class="mb-6 text-gray-400">Choose a color scheme for your adventure.</p>
        <div class="grid grid-cols-2 sm:grid-cols-3 gap-4">
            <button data-theme="default" class="theme-btn bg-slate-700 text-white p-4 rounded-lg font-semibold transition-transform hover:scale-105">Default</button>
            <button data-theme="green" class="theme-btn bg-green-600 text-white p-4 rounded-lg font-semibold transition-transform hover:scale-105">Green</button>
            <button data-theme="blue" class="theme-btn bg-sky-600 text-white p-4 rounded-lg font-semibold transition-transform hover:scale-105">Blue</button>
            <button data-theme="purple" class="theme-btn bg-purple-600 text-white p-4 rounded-lg font-semibold transition-transform hover:scale-105">Purple</button>
            <button data-theme="pink" class="theme-btn bg-pink-500 text-white p-4 rounded-lg font-semibold transition-transform hover:scale-105">Pink</button>
            <button data-theme="gray" class="theme-btn bg-gray-500 text-white p-4 rounded-lg font-semibold transition-transform hover:scale-105">Gray</button>
        </div>
    </div>

    <!-- Welcome screen for username input -->
    <div id="welcome-screen" class="w-full max-w-md rounded-xl shadow-2xl p-6 md:p-8 text-center hidden themed-container">
        <h1 class="text-3xl font-bold mb-4 themed-text">Choose Your Name</h1>
        <p class="mb-6 themed-subtle-text">Enter your name to begin or continue your journey.</p>
        <input type="text" id="username-input" placeholder="Your Name" class="w-full text-white rounded-lg px-4 py-3 mb-4 focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-shadow themed-input">
        <button id="start-button" class="w-full text-white font-bold py-3 px-4 rounded-lg shadow-md transition-all duration-300 transform hover:scale-105 themed-primary-btn">Start Adventure</button>
        
        <!-- Gender selection appears after name is entered for a new game -->
        <div id="gender-selection" class="hidden mt-4">
            <p class="mb-4 themed-subtle-text">Select your character.</p>
            <div class="flex gap-4">
                <button id="male-button" class="w-full bg-sky-600 hover:bg-sky-700 text-white font-bold py-3 px-4 rounded-lg shadow-md transition-all duration-300">Male</button>
                <button id="female-button" class="w-full bg-pink-500 hover:bg-pink-600 text-white font-bold py-3 px-4 rounded-lg shadow-md transition-all duration-300">Female</button>
            </div>
        </div>
    </div>

    <!-- Main game container -->
    <div id="game-container" class="w-full max-w-2xl rounded-xl shadow-2xl p-6 md:p-8 hidden themed-container">
        <div class="flex justify-between items-center mb-2 pb-4 border-b themed-border">
            <p class="themed-subtle-text">Player: <span id="player-name" class="font-bold themed-text"></span></p>
            <button id="reset-button" class="text-sm bg-red-600 hover:bg-red-700 text-white font-semibold py-1 px-3 rounded-lg transition-colors duration-300">Reset Progress</button>
        </div>
        
        <!-- Inventory will be displayed here when items are collected -->
        <div id="inventory-container" class="mb-4 p-3 rounded-lg hidden themed-input">
            <h3 class="font-bold mb-2 themed-text text-sm">Inventory</h3>
            <ul id="inventory-list" class="text-sm space-y-1 themed-subtle-text list-disc list-inside">
                <!-- Items dynamically added by JavaScript -->
            </ul>
        </div>

        <!-- Story text is displayed here -->
        <div id="story-text" class="text-lg md:text-xl leading-relaxed mb-6 themed-text"></div>
        
        <!-- Choices are displayed here -->
        <div id="choices-container" class="grid grid-cols-1 gap-4"></div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            
            // --- DOM ELEMENTS ---
            const elements = {
                colorSelectionScreen: document.getElementById('color-selection-screen'),
                welcomeScreen: document.getElementById('welcome-screen'),
                gameContainer: document.getElementById('game-container'),
                usernameInput: document.getElementById('username-input'),
                startButton: document.getElementById('start-button'),
                resetButton: document.getElementById('reset-button'),
                storyTextElement: document.getElementById('story-text'),
                choicesContainerElement: document.getElementById('choices-container'),
                playerNameElement: document.getElementById('player-name'),
                genderSelectionContainer: document.getElementById('gender-selection'),
                maleButton: document.getElementById('male-button'),
                femaleButton: document.getElementById('female-button'),
                inventoryContainer: document.getElementById('inventory-container'),
                inventoryList: document.getElementById('inventory-list')
            };

            // --- THEME DATA ---
            const themes = {
                default: { bg: 'bg-slate-900', container: 'bg-slate-800', text: 'text-slate-200', subtleText: 'text-slate-400', primaryBtn: 'bg-indigo-600 hover:bg-indigo-700', secondaryBtn: 'bg-slate-700 hover:bg-indigo-600', input: 'bg-slate-700', border: 'border-slate-700' },
                green: { bg: 'bg-green-900', container: 'bg-green-800', text: 'text-white', subtleText: 'text-green-200', primaryBtn: 'bg-lime-500 hover:bg-lime-600', secondaryBtn: 'bg-green-700 hover:bg-lime-500', input: 'bg-green-700', border: 'border-green-700' },
                blue: { bg: 'bg-blue-900', container: 'bg-blue-800', text: 'text-white', subtleText: 'text-blue-200', primaryBtn: 'bg-sky-500 hover:bg-sky-600', secondaryBtn: 'bg-blue-700 hover:bg-sky-500', input: 'bg-blue-700', border: 'border-blue-700' },
                purple: { bg: 'bg-purple-900', container: 'bg-purple-800', text: 'text-white', subtleText: 'text-purple-200', primaryBtn: 'bg-fuchsia-500 hover:bg-fuchsia-600', secondaryBtn: 'bg-purple-700 hover:bg-fuchsia-500', input: 'bg-purple-700', border: 'border-purple-700' },
                pink: { bg: 'bg-pink-100', container: 'bg-white', text: 'text-pink-800', subtleText: 'text-pink-500', primaryBtn: 'bg-pink-500 hover:bg-pink-600', secondaryBtn: 'bg-pink-100 hover:bg-pink-200 text-pink-700', input: 'bg-pink-50 text-pink-900', border: 'border-pink-300' },
                gray: { bg: 'bg-gray-200', container: 'bg-white', text: 'text-gray-900', subtleText: 'text-gray-600', primaryBtn: 'bg-gray-800 hover:bg-gray-900', secondaryBtn: 'bg-gray-100 hover:bg-gray-300 text-gray-800', input: 'bg-gray-100 text-gray-800', border: 'border-gray-300' }
            };
            
            // --- STORY DATA (COMPLETE & FULLY VERIFIED) ---
            const story = [
                // Morning Routine
                { id: 1, text: 'You open your eyes. The dream is already gone, just a vague feeling of unease remains. The alarm blares.', choices: [{ text: "Hit snooze", nextId: 11 }, { text: "Get up and stretch", nextId: 12 }, { text: "Grab your phone first", nextId: 13 }, { text: "Take a wake and bake dab", nextId: 60 }] },
                { id: 11, text: "You drift off again. Suddenly it’s 7:30. You’re late.", choices: [{ text: "Rush out of bed, forget shower/breakfast", nextId: 21 }, { text: "Say screw it, call in sick", nextId: 22 }] },
                { id: 12, text: "Your muscles pop. You feel awake. Time for the bathroom.", choices: [{ text: "Hot shower", nextId: 23 }, { text: "Cold shower", nextId: 24 }, { text: "Skip shower, brush teeth only", nextId: 25 }] },
                { id: 13, text: 'You scroll through your phone. A weirdly targeted ad appears: "Tired of your boring life? Try Tactical Soap. Washes away the grime AND the regret."', choices: [{ text: "Click the ad", nextId: 26 }, { text: "Ignore it, head to bathroom", nextId: 27 }] },
                
                // Late / Sick Path
                { id: 21, text: "You scramble around, a whirlwind of panicked energy.", choices: [{ text: "Throw on random clothes quickly", nextId: 31 }, { text: "Leave house in pajamas", nextId: 32 }] },
                { id: 22, text: "You grab your phone and call in sick, putting on your best 'dying frog' voice. The day is yours.", choices: [{ text: "Actually stay home all day", nextId: 33 }, { text: "Decide to explore the city instead", nextId: 34 }, { text: "Smoke weed and see where the day goes", nextId: 70 }, { text: "Go get a proper diner breakfast.", nextId: 10000 }, { text: "Finally fix that wobbly bookshelf.", nextId: 10010 }, { text: "Finally return that overdue library book.", nextId: 9000 }] },

                // Shower Path
                { id: 23, text: "The hot water is a blessing, melting away the last of your sleepiness. You feel refreshed and relaxed.", choices: [{ text: "Get dressed", nextId: 89 }] },
                { id: 24, text: "The cold water is a shock to the system. You gasp, but emerge feeling electric and wide awake, if a little cranky.", choices: [{ text: "Get dressed", nextId: 89 }] },
                { id: 25, text: "You give your teeth a thorough brushing, but decide a shower is a luxury you don't have time for. You smell a little, but oh well.", choices: [{ text: "Get dressed", nextId: 89 }] },

                // Ad Path
                { id: 26, text: 'The ad takes you to a GeoCities-looking website for "Tactical Soap." It\'s full of testimonials from guys named Chad and Brad. At the bottom, a tiny link says: "For TRUE believers ONLY."', choices: [{ text: "Click the 'TRUE believers' link", nextId: 261 }, { text: "Close the tab, this is stupid", nextId: 27 }] },
                { id: 261, text: "The link takes you to a forum about cryptid sightings in your area. Apparently, someone saw a 'Wobble-Gonk' near the old mill. You've wasted five minutes you'll never get back.", choices: [{ text: "Head to the bathroom", nextId: 27 }] },
                { id: 27, text: "It's just an ad. You toss your phone on the bed and head to the bathroom.", choices: [{ text: "Hot shower", nextId: 23 }, { text: "Cold shower", nextId: 24 }, { text: "Skip shower", nextId: 25 }] },

                // Breakfast / Commute Path
                { id: 31, text: "You grab a shirt and pants from the floor. They might be clean. They might not. No time to check.", choices: [{ text: "Breakfast (Eggs/Toast)", nextId: 41 }, { text: "Breakfast (Cereal)", nextId: 42 }, { text: "Breakfast (Oatmeal)", nextId: 46 }, { text: "Coffee Only", nextId: 43 }, { text: "Skip Breakfast", nextId: 44 }] },
                { id: 32, text: "You're already late, what's a dress code violation on top of it? You walk out the door in your flannel pajama pants.", choices: [{ text: "Breakfast (Eggs/Toast)", nextId: 41 }, { text: "Breakfast (Cereal)", nextId: 42 }, { text: "Breakfast (Oatmeal)", nextId: 46 }, { text: "Coffee Only", nextId: 43 }, { text: "Skip Breakfast", nextId: 44 }] },
                { id: 33, text: "You spend the day on the couch, binging shows and ordering delivery. You feel a bit like a slob, but a comfortable, happy slob. As evening approaches, your phone buzzes.", choices: [{ text: "Check your phone.", nextId: 299 }] },
                { id: 34, text: "You wander the city, a tourist in your own town. What should you do?", choices: [{ text: "Visit a cafe.", nextId: 341 }, { text: "Go to the park.", nextId: 342 }, { text: "Go to the mall.", nextId: 341 }] },
                { id: 341, text: "You spend a few hours at a cafe/mall, just people watching and enjoying the freedom. As the sun begins to set, your phone buzzes.", choices: [{ text: "Check your phone.", nextId: 299 }] },
                { id: 342, text: "You head to the local park. It's peaceful. You see a friendly-looking orange tabby cat sitting on a bench.", choices: [{ text: "Try to pet the cat.", nextId: 343 }, { text: "Leave it be and enjoy the quiet.", nextId: 341 }] },
                { id: 343, text: "You approach slowly and offer your hand. The cat purrs loudly and rubs against you before hopping off the bench. As it leaves, it nudges something shiny on the ground with its nose, looks back at you, and darts away. It's an old, heavy silver dollar.", setState: { silverDollar: true }, choices: [{ text: "What a strange cat. What a cool coin.", nextId: 341 }] },
                { id: 41, text: "You quickly whip up some eggs and toast. A solid breakfast.", choices: [{ text: "Commute (Drive)", nextId: 51 }, { text: "Commute (Bus)", nextId: 52 }, { text: "Smoke a bowl before you go", nextId: 80 }, { text: "Skip Work Last Minute", nextId: 54 }] },
                { id: 42, text: "You pour a bowl of cereal. It's fast and easy.", choices: [{ text: "Commute (Drive)", nextId: 51 }, { text: "Commute (Bus)", nextId: 52 }, { text: "Smoke a bowl before you go", nextId: 80 }, { text: "Skip Work Last Minute", nextId: 54 }] },
                { id: 43, text: "No time for food. You brew a strong cup of coffee and drink it black.", choices: [{ text: "Drink a second cup", nextId: 431 }, { text: "One is enough. Time to go.", nextId: 45 }] },
                { id: 44, text: "Your stomach rumbles, but you ignore it. Time is money.", choices: [{ text: "Commute (Drive)", nextId: 51 }, { text: "Commute (Bus)", nextId: 52 }, { text: "Smoke a bowl before you go", nextId: 80 }, { text: "Skip Work Last Minute", nextId: 54 }] },
                { id: 45, text: "Caffeine coursing through your veins, you head for the door.", choices: [{ text: "Commute (Drive)", nextId: 51 }, { text: "Commute (Bus)", nextId: 52 }, { text: "Smoke a bowl before you go", nextId: 80 }, { text: "Skip Work Last Minute", nextId: 54 }] },
                { id: 46, text: "You make a quick bowl of oatmeal. It's warm and filling.", choices: [{ text: "Commute (Drive)", nextId: 51 }, { text: "Commute (Bus)", nextId: 52 }, { text: "Smoke a bowl before you go", nextId: 80 }, { text: "Skip Work Last Minute", nextId: 54 }] },
                { id: 431, text: "The second cup makes your heart pound. You feel wired, a bit jittery, but immensely focused.", choices: [{ text: "Drink a third cup. Embrace the chaos.", nextId: 432 }, { text: "Okay, that's enough. Time to go.", nextId: 45 }] },
                { id: 432, text: "You down the third cup. Your hands are shaking. You are a being of pure caffeine, ready to face the day at 1000 mph.", choices: [{ text: "Commute (Drive, VERY fast)", nextId: 512 }, { text: "Commute (Bus, try not to vibrate out of your seat)", nextId: 52 }] },

                // Branching to Main Storylines
                { id: 51, text: "You get in your old, trusty truck and head to your job at the bank. The gas gauge is broken, but you have a pretty good feel for it. Usually. Halfway there, the engine sputters and dies. You're out of gas.", choices: [{ text: "Call for help", nextId: 401 }, { text: "Start walking to the nearest gas station", nextId: 402 }, { text: "Call an Uber to work and deal with this later", nextId: 403 }, { text: "Just wait and see what happens", nextId: 405 }] },
                { id: 52, text: "You catch the bus to work. As you ride, you see someone drop a folded piece of paper. You pick it up. It looks like a lottery ticket.", choices: [{ text: "Check the numbers.", nextId: 55 }, { text: "Put it in your pocket for later.", nextId: 101 }] },
                { id: 54, text: "You know what? Screw it. You're not going to work. The city awaits.", choices: [{ text: "Begin your adventure", nextId: 34 }] },
                { id: 55, text: "You pull up the lottery results on your phone. You scan the ticket. Holy cow. It's a $100 winner! You carefully fold it and put it in your pocket, a grin spreading across your face.", setState: { lotteryTicket: true }, choices: [{ text: "Arrive at the bank, feeling lucky.", nextId: 101 }] },

                // Weed Paths
                { id: 60, text: "You grab your rig from the nightstand. The torch roars to life. You take a fat dab and hold it in, coughing until you see stars. The world slows down. Everything is hazy and kinda funny now.", choices: [{ text: "Get up and stretch (slowly)", nextId: 61 }, { text: "Grab your phone and zone out", nextId: 13 }] },
                { id: 61, text: "You slowly rise, your body feeling both heavy and light. A good stretch feels incredible. Time to get ready, maybe.", choices: [{ text: "Hot shower", nextId: 62 }, { text: "Cold shower", nextId: 63 }, { text: "Just brush teeth", nextId: 64 }] },
                { id: 62, text: "The hot water feels amazing. You space out for what feels like an hour, just enjoying the steam.", choices: [{ text: "Get dressed.", nextId: 89 }] },
                { id: 63, text: "The cold water is a sensory explosion. Your brain short-circuits for a second, then reboots with crystal clarity. A bold choice.", choices: [{ text: "Get dressed.", nextId: 89 }] },
                { id: 64, text: "Showering seems like a lot of work. You brush your teeth meticulously instead, focusing intensely on each tooth.", choices: [{ text: "Get dressed.", nextId: 89 }] },
                { id: 70, text: "You pack a fat bowl. The sweet smoke fills your lungs. An hour later, you're staring at the ceiling, contemplating the mysteries of the universe and whether you have any chips in the house.", choices: [{ text: "Watch TV", nextId: 71 }, { text: "Go on a snack quest to the kitchen", nextId: 72 }, { text: "Mindlessly scroll Facebook Marketplace", nextId: 73 }] },
                { id: 71, text: "You flip on the TV. What's the plan?", choices: [{ text: "See what's on Adult Swim", nextId: 711 }, { text: "Watch daytime court shows and feel superior", nextId: 712 }] },
                { id: 711, text: "You get sucked into a marathon of 'Delocated'. Jon is trying to get a new 'krime' photo taken. You grab your snacks and forget the outside world exists.", choices: [{ text: "The perfect day.", nextId: 79 }] },
                { id: 712, text: "You get sucked into hours of petty disputes and questionable rulings. You yell at the TV a lot. It's surprisingly cathartic.", choices: [{ text: "A surprisingly cathartic day.", nextId: 79 }] },
                { id: 72, text: "You embark on a perilous journey to the kitchen. You construct a magnificent sandwich out of leftovers and eat it over the sink like an animal. It's the best thing you've ever tasted.", choices: [{ text: "A truly magnificent sandwich.", nextId: 79 }] },
                { id: 73, text: "You open Facebook Marketplace. Amidst the broken furniture and MLM scams, something beautiful catches your eye: a 1995 Z28 Camaro, T-tops, cherry red. The price is... suspiciously low.", choices: [{ text: "Message the seller: 'is this still available?'", nextId: 201 }, { text: "Assume it's a scam and look for weird taxidermy instead", nextId: 70 }] },
                { id: 79, text: "You spend the rest of the day in a blissful haze. As evening sets in, your phone buzzes, pulling you back to reality.", choices: [{ text: "See who it is.", nextId: 299 }] },
                { id: 80, text: "You take a quick rip from your bong to 'prepare' for the day. You feel calm, maybe too calm. Time to head to work, hopefully no one notices your eyes are as red as the devil's... well, you know.", choices: [{ text: "Commute (Drive, probably a bad idea)", nextId: 511 }, { text: "Commute (Bus, the safer choice)", nextId: 52 }] },
                
                // Getting Dressed (Morning)
                { id: 89, text: "Time to pick an outfit for the day.", routeBy: 'gender', routes: { male: 891, female: 892 } },
                { id: 891, text: "Time to pick an outfit for the day.", choices: [{ text: "Pick outfit (Jeans/Hoodie)", nextId: 35 }, { text: "Pick outfit (Slacks/Business)", nextId: 36 }, { text: "Pick outfit (Hawaiian Shirt)", nextId: 37 }, { text: "Stay in Pajamas", nextId: 38 }] },
                { id: 892, text: "Time to pick an outfit for the day.", choices: [{ text: "A blue dress", nextId: 1000 }, { text: "A black skirt with pink blouse and white sweater", nextId: 1001 }, { text: "A black hoodie and a pair of jeans", nextId: 1002 }, { text: "Sweatpants and a cutoff shirt", nextId: 1003 }] },
                { id: 35, text: "You pull on a comfortable pair of jeans and a hoodie. Casual Friday, here you come.", setState: { wearsHawaiianShirt: false }, choices: [{ text: "Finish getting ready", nextId: 90 }] },
                { id: 36, text: "You dress in your work uniform: slacks and a button-up. Professional, if a bit boring.", setState: { wearsHawaiianShirt: false }, choices: [{ text: "Finish getting ready", nextId: 90 }] },
                { id: 37, text: "You decide today needs a splash of color. The Hawaiian shirt it is. Let the world know you're here for a good time.", setState: { wearsHawaiianShirt: true }, choices: [{ text: "Finish getting ready", nextId: 90 }] },
                { id: 38, text: "Why bother changing? You're already comfortable. You decide to embrace the pajama lifestyle.", setState: { wearsHawaiianShirt: false }, choices: [{ text: "Finish getting ready", nextId: 90 }] },
                { id: 1000, text: "You slip on a simple but elegant blue dress. It's comfortable and makes you feel confident.", setState: { wearsHawaiianShirt: false }, choices: [{ text: "Finish getting ready", nextId: 95 }] },
                { id: 1001, text: "You choose the black skirt, pink blouse, and a cozy white sweater. It's a classic, cute look.", setState: { wearsHawaiianShirt: false }, choices: [{ text: "Finish getting ready", nextId: 95 }] },
                { id: 1002, text: "You go for comfort and style with a black hoodie and your favorite pair of jeans. You're ready for anything.", setState: { wearsHawaiianShirt: false }, choices: [{ text: "Finish getting ready", nextId: 95 }] },
                { id: 1003, text: "Maximum comfort is the goal. You pull on a pair of soft sweatpants and a cutoff shirt. It's a lazy day, after all.", setState: { wearsHawaiianShirt: false }, choices: [{ text: "Finish getting ready", nextId: 95 }] },
                { id: 90, text: "You're all dressed. One last look in the mirror. Any final preparations before breakfast?", choices: [{ text: "Strap on your shoulder harness and gold 9mm Glock.", nextId: 91 }, { text: "Nah, let's just get some breakfast.", nextId: 95 }] },
                { id: 91, text: "You open a hidden compartment in your closet and pull out your custom gold 9mm Glock. You strap on the leather shoulder harness. It feels heavy and familiar under your jacket. You're ready for anything.", setState: { hasGlock: true }, choices: [{ text: "Now for some breakfast.", nextId: 95 }] },
                { id: 95, text: "You head to the kitchen, ready for the most important meal of the day.", choices: [{ text: "Breakfast (Eggs/Toast)", nextId: 41 }, { text: "Breakfast (Cereal)", nextId: 42 }, { text: "Breakfast (Oatmeal)", nextId: 46 }, { text: "Coffee Only", nextId: 43 }, { text: "Skip Breakfast", nextId: 44 }] },

                // Bank Teller Path
                { id: 101, text: "Centerville Savings Bank stands tall in its beige blandness. The lobby smells faintly of stale coffee and Lysol. You swipe in and step behind the counter. Matt, your coworker, waves at you. 'Hey, they finally restocked the Nutter Butters.' Mr. Johns, your boss, shuffles past. 'Clock in already. And no slacking.'", textFemale: "Centerville Savings Bank stands tall in its beige blandness. The lobby smells faintly of stale coffee and Lysol. You swipe in and step behind the counter. Karen, your coworker, waves at you. 'Hey, they finally restocked the Nutter Butters.' Mr. Johns, your boss, shuffles past. 'Clock in already. And no slacking.'", choices: [{ text: "Talk about Nutter Butters.", nextId: 102 }, { text: "Go straight to work", nextId: 130 }, { text: "Sneak to breakroom for a donut first", nextId: 104 }] },
                { id: 102, text: "You walk over to Matt. 'No way, for real?' you ask.", textFemale: "You walk over to Karen. 'No way, for real?' you ask.", choices: [{ text: "I love Nutter Butters.", nextId: 105 }, { text: "Nutter Butters are kinda gross.", nextId: 106 }] },
                { id: 104, text: "You sneak a powdered donut. Sweet victory — but Mr. Johns catches you. 'You’re already late and now you’re eating on my time?'", choices: [{ text: "Apologize sincerely", nextId: 110 }, { text: "Sass him back", nextId: 111 }, { text: "Pretend to choke dramatically to distract him", nextId: 112 }] },
                { id: 105, text: "Matt scoffs. ''Gross.'' he says. 'You should see their Instagram page, though. It's completely insane.'", textFemale: "Karen scoffs. ''Gross.'' she says. 'You should see their Instagram page, though. It's completely insane.'", choices: [{ text: "Huh. Weird. Well, time to get ready.", nextId: 130 }] },
                { id: 106, text: "'Are you kidding?' Matt says, looking shocked. 'They're the best. You gotta check out their Instagram page, it rips.'", textFemale: "'Are you kidding?' Karen says, looking shocked. 'They're the best. You gotta check out their Instagram page, it rips.'", choices: [{ text: "Alright, whatever. Time to get ready.", nextId: 130 }] },
                { id: 110, text: "Mr. Johns sighs. 'Just don’t let it happen again.'", choices: [{ text: "Get to work", nextId: 130 }] },
                { id: 111, text: "'Maybe if you bought better donuts I’d be faster,' you joke. Mr. Johns glares. 'Last warning.'", choices: [{ text: "Get to work", nextId: 130 }] },
                { id: 112, text: "You clutch your throat dramatically. Matt rushes in pretending to save you. Mr. Johns rolls his eyes. 'Idiots.'", textFemale: "You clutch your throat dramatically. Karen rushes in pretending to save you. Mr. Johns rolls his eyes. 'Idiots.'", choices: [{ text: "Get to work", nextId: 130 }] },
                { id: 130, text: "As you wait for the first customer, you think of your partner. You miss them. You pull out your phone under the counter.", choices: [{ text: "Send them a ❤️ and 😘 emoji.", nextId: 131 }, { text: "Send them an 'i miss you bb' text.", nextId: 132 }, { text: "Just think about them. Don't want to seem clingy.", nextId: 133 }] },
                { id: 131, text: "A moment later, your phone buzzes. They've sent back a 😘. You smile and put your phone away, feeling a little warmer.", choices: [{ text: "Time to get to work.", nextId: 134 }] },
                { id: 132, text: "Your phone buzzes almost instantly with a reply: 'ILY'. You feel a rush of affection and quickly put your phone away as the first customer approaches.", choices: [{ text: "Time to get to work.", nextId: 134 }] },
                { id: 133, text: "You decide against it. Better to stay focused. You put your phone away and get ready for the day.", choices: [{ text: "Time to get to work.", nextId: 134 }] },
                { id: 134, text: "You put your phone away, feeling good. Barry from HR wanders over.", choices: [{ text: "Great. It's Barry.", nextId: 135 }] },
                { id: 135, text: "'Hey,' Barry says, leaning conspiratorially. 'Did you hear about what happened in the parking lot this morning? Classic Mr. Johns.'", choices: [{ text: "No, what happened?", nextId: 136 }, { text: "Sorry Barry, I've got to get to work.", nextId: 150 }] },
                { id: 136, text: "Barry launches into a juicy, probably exaggerated story about Mr. Johns getting into a screaming match with the parking garage gate. You try to stifle a laugh.", setState: { heardGossip: true }, choices: [{ text: "File that away for later.", nextId: 138 }] },
                { id: 138, text: "Later that day, you head to the breakroom for a coffee. Mr. Johns is in there, looking grumpy as usual.", choices: [{ text: "Get your coffee and leave.", nextId: 140 }] },
                { id: 150, text: "The morning rush is over, leaving a quiet lull. What should you tackle next?", choices: [ { text: "Process last week's deposit slips.", nextId: 151 }, { text: "Do it later. Stretch your legs for a bit.", nextId: 160 } ] },
                { id: 151, text: "You grab the stack of deposit slips. It's tedious work, but it has to be done.", choices: [{ text: "File them and export a copy for your records.", nextId: 152 }, { text: "Just file them. No need for extra steps.", nextId: 153 }] },
                { id: 152, text: "You finish filing and start an export. Do you want to CC Mr. Johns on the confirmation email?", choices: [{ text: "Yes, keep the boss in the loop.", nextId: 154 }, { text: "No, no need to bother him.", nextId: 154 }] },
                { id: 153, text: "You efficiently file away the slips. The task takes up a good chunk of your afternoon.", choices: [{ text: "Alright, that's done.", nextId: 140 }] },
                { id: 154, text: "You send the email. It's good to have a digital paper trail. That task takes a while, and before you know it, the day is winding down.", choices: [{ text: "Time flew by.", nextId: 140 }] },
                { id: 160, text: "You decide to put off the paperwork and wander into the back offices. You pass an empty cubicle with a sad-looking plant. On the desk sits a chipped mug that reads 'World's Best Boss'.", choices: [{ text: "Take the mug as a souvenir.", nextId: 168 }, { text: "Leave it and keep walking.", nextId: 169 }] },
                { id: 168, text: "You grab the mug. It feels appropriately cynical. You tuck it under your arm and continue your stroll.", setState: { bossMug: true }, choices: [{ text: "Let's see what else is back here.", nextId: 169 }] },
                { id: 169, text: "You notice the door to the old records room is slightly ajar.", choices: [{text: "Peek inside.", nextId: 170}, {text: "Probably shouldn't. Keep walking.", nextId: 140}] },
                { id: 170, text: "You slip into the dusty room. It's filled with old file cabinets. On a table sits a long-forgotten deposit box. Inside, under some papers, you find a single, heavy clay poker chip from 'The River Palace,' a casino that closed down decades ago.", setState: { oldCasinoChip: true }, choices: [{text: "What a cool find.", nextId: 140}] },
                { id: 140, text: "The rest of the workday is surprisingly calm. As you're packing up to leave, your phone buzzes.", choices: [{ text: "Check the text.", nextId: 299 }] },
                
                // End of Day / Date Decision
                { id: 299, text: "As evening approaches, your phone buzzes with a text from your partner.", choices: [{ text: "Read it.", nextId: 300 }] },
                { id: 300, text: "'Hey! Date night tonight :) Where do you want to go?'", textFemale: "'Hey! Date night tonight :) Where do you want to go?'", choices: [{ text: "Maggiano's", nextId: 301 }, { text: "The Cheesecake Factory", nextId: 321 }, { text: "The Mala Hot Pot", nextId: 311 }] },
                { id: 301, text: "You text back: 'Maggiano's for sure.' They reply instantly: 'Yesss! Perfect. See you in a bit!'", textFemale: "You text back: 'Maggiano's for sure.' He replies instantly: 'Yesss! Perfect. See you in a bit!'", setState: { dateLocation: 'maggianos' }, choices: [{ text: "Time to get ready.", nextId: 7000 }] },
                { id: 311, text: "You text back: 'Let's try the hot pot place!' They reply: 'Yay! I'm so excited! I'll meet you there!'", textFemale: "You text back: 'Let's try the hot pot place!' He replies: 'Yay! I'm so excited! I'll meet you there!'", setState: { dateLocation: 'hotpot' }, choices: [{ text: "Time to get ready.", nextId: 7000 }] },
                { id: 321, text: "You suggest The Cheesecake Factory. A classic choice. They text back: 'Okay! The wait will be insane but I need that brown bread. See you there!'", textFemale: "You suggest The Cheesecake Factory. A classic choice. He texts back: 'Okay! The wait will be insane but I need that brown bread. See you there!'", setState: { dateLocation: 'cheesecake' }, choices: [{ text: "Time to get ready.", nextId: 7000 }] },
                
                // Arrival at Date
                { id: 312, text: "You arrive at the Hot Pot restaurant. The smell of sichuan peppercorns is in the air as you're seated.", choices: [{ text: "So, about your day...", nextId: 2000 }] },
                { id: 322, text: "You arrive at The Cheesecake Factory. It's bustling, as expected, but you get a table.", choices: [{ text: "So, about your day...", nextId: 2000 }] },
                { id: 900, text: "You arrive at Maggiano's. The atmosphere is cozy and romantic. You're seated at your table and look over the menu.", choices: [{ text: "Your partner points out an expensive bottle of wine.", nextId: 901 }, { text: "You spot something on the floor by a vacant table.", nextId: 307 }, { text: "Excuse yourself to the bathroom.", nextId: 950, condition: { gender: 'female', state: '!usedBathroom' } }] },
                
                // Date Scenarios
                { id: 950, text: "You excuse yourself and head to the restroom. It's a moment of quiet away from the restaurant buzz.", setState: { usedBathroom: true }, choices: [{ text: "Check your phone.", nextId: 951 }, { text: "Just freshen up and head back.", nextId: 900 }] },
                { id: 951, text: "You pull out your phone and see a text from your best friend Cammy: 'Hey hows the date?'", choices: [{ text: "its great!", nextId: 952 }, { text: "Girl, its amazing", nextId: 952 }, { text: "The food is the best here.", nextId: 952 }] },
                { id: 952, text: "You quickly send the text and put your phone away. You head back to the table, feeling refreshed.", choices: [{ text: "Continue the date...", nextId: 900 }] },
                { id: 2000, text: "Your partner leans in conspiratorially. 'Oh my god, there is tea,' they say, their eyes wide. 'There is work tea.'", textFemale: "Your partner leans in conspiratorially. 'Oh my god, there is tea,' he says, his eyes wide. 'There is work tea.'", choices: [ { text: "Remind him about the ring you're wearing.", nextId: 2029, condition: { gender: 'female', state: 'hasRing' } }, { text: "Okay, let's hear it.", nextId: 2001 }, { text: "You know I love it.", nextId: 2001 }, { text: "Oh yeah? Is it that you're the hottest woman that works there?", textFemale: "Oh yeah? Is it that you're the most handsome guy that works there?", nextId: 2002 } ] },
                { id: 2001, text: "Your partner launches into a long, dramatic story about office politics involving a birthday cake and a shared blouse. It's petty, hilarious, and you're completely engrossed.", choices: [{ text: "What a night.", nextId: 2011 }] },
                { id: 2002, text: "Your partner playfully rolls their eyes and laughs. 'Shut up. Okay, but for real, listen to this.'", textFemale: "Your boyfriend laughs. 'I wish. Nah, listen to this.'", choices: [{ text: "I'm listening...", nextId: 2001 }] },
                { id: 2011, text: "After the story, the conversation flows easily. The date is going perfectly.", choices: [{ text: "Time to head home.", nextId: 3000 }] },
                { id: 2029, text: "'This is still my favorite ring,' you say, showing him your hand. He smiles. 'I remember getting that for you a year ago. It looks perfect on you. I'll have to get you an even bigger one soon.'", setState: { hasRing: false }, choices: [{ text: "So, about this work tea...", nextId: 2001 }] },
                
                // Post-Date
                { id: 3000, text: "You walk out to their car, but as you approach, you both see it: the rear passenger-side tire is completely, hopelessly flat. 'You've got to be kidding me,' they groan.", choices: [{ text: "Well, looks like you're riding with me.", nextId: 3001 }] },
                { id: 3001, text: "She gets in your truck, a little closer than usual. The cab is filled with her perfume. The drive back to your place is quiet at first, the streetlights painting stripes across her face.", textFemale: "You get in his truck, a little closer than usual. The cab smells like his cologne. The drive back to your place is quiet at first, the streetlights painting stripes across his face.", choices: [ { text: "'I had such a great time tonight. That place is boss.'", textFemale: "'I had such a great time tonight. That place is boss.'", nextId: 3002 }, { text: "'It's crazy how hot you are, just like, all the time.'", textFemale: "Compliment him back. 'It's crazy how handsome you are.'", nextId: 3003 }, { text: "'The waiter was cool... I like that dark oil stuff he brought.'", textFemale: "'The waiter was cool... I like that dark oil stuff he brought.'", nextId: 3004 }, { text: "Hand her the aux cord.", textFemale: "Ask for the aux cord.", nextId: 3005 }, { text: "Let's stop for gas and snacks.", textFemale: "Suggest stopping for gas and snacks.", nextId: 3100 } ] },
                { id: 3002, text: "'I did too,' she says, smiling. 'It was perfect.' She scoots a little closer on the bench seat.", textFemale: "'I did too,' he says, smiling. 'It was perfect.' He scoots a little closer.", choices: [{ text: "Continue driving...", nextId: 3006 }] },
                { id: 3003, text: "She blushes, a real, genuine blush. 'Stop,' she says, but she's smiling. 'You're not so bad yourself.' She puts her hand on your thigh.", textFemale: "He grins, a real, genuine grin. 'Oh yeah?' he says, his voice a little lower. 'You're not so bad yourself.' He puts his hand on your thigh.", choices: [{ text: "Continue driving...", nextId: 3006 }] },
                { id: 3004, text: "She laughs, a bright, clear sound. 'You mean the balsamic vinegar?' she asks, playfully. 'You're such a dork.'", textFemale: "'You mean the balsamic vinegar?' he asks, laughing. 'You're such a dork.'", choices: [{ text: "Continue driving...", nextId: 3006 }] },
                { id: 3005, text: "You hand her the aux cord. A moment later, a slow, moody song fills the truck. She knows exactly what she's doing.", textFemale: "He hands you the aux cord. A moment later, a slow, moody song fills the truck. He knows exactly what he's doing.", choices: [{ text: "Continue driving...", nextId: 3006 }] },
                { id: 3006, text: "The mood in the truck is thick with unspoken energy. The city lights blur past.", textFemale: "The mood in the truck is thick with unspoken energy. The city lights blur past.", choices: [ { text: "Just enjoy the silence and the music.", nextId: 3200 } ] },
                { id: 3100, text: "You pull into a brightly lit gas station. 'Be right back,' you say, hopping out of the truck.", textFemale: "'Be right back,' he says, hopping out of the truck.", choices: [{ text: "Go inside.", nextId: 3101 }] },
                { id: 3101, text: "You put $20 of gas in the truck. Inside, you grab a pack of gum, a box of Raw cones, and a blunt wrap. Anything else?", textFemale: "He puts $20 of gas in the truck. He comes back from inside with a pack of gum, a box of Raw cones, and a blunt wrap.", setState: { cones: true, bluntWrap: true, gum: true }, choices: [ { text: "Get some candy.", textFemale: "Ask him to get your favorite candy.", nextId: 3102 }, { text: "No, that's good.", textFemale: "No, that's good.", nextId: 3103 } ] },
                { id: 3102, text: "You grab a bag of her favorite candy. You know the way to her heart.", textFemale: "He comes back with a bag of your favorite candy. He knows the way to your heart.", setState: { candy: true }, choices: [{ text: "Head back to the truck.", nextId: 3103 }] },
                { id: 3103, text: "You get back in the truck with your supplies. She gives you a knowing smile as you pull back onto the road.", textFemale: "He gets back in the truck with the supplies. You give him a knowing smile as he pulls back onto the road.", choices: [{ text: "Now, where were we...", nextId: 3006 }] },
                { id: 3200, text: "You pull up to your apartment. You kill the engine, and the sudden silence is heavy. You both look at each other, the question hanging in the air.", textFemale: "He pulls up to his apartment. He kills the engine, and the sudden silence is heavy. You both look at each other, the question hanging in the air.", choices: [{ text: "Let's go inside.", textFemale: "Let's go inside.", nextId: 4000 }] },


                // Getting Ready for Date
                { id: 7000, text: "Time to get ready for your date.", routeBy: 'gender', routes: { male: 7001, female: 7010 } },
                { id: 7001, text: "You get home with plenty of time to get ready. First things first, time to clean up.", choices: [{ text: "Take a quick shower.", nextId: 7002 }, { text: "Nah, a little deodorant will do.", nextId: 7002 }] },
                { id: 7002, text: "You look in the mirror. Your facial hair is a little scruffy.", choices: [{ text: "Shave it clean.", nextId: 7003 }, { text: "Leave the whiskers. It's a look.", nextId: 7003 }] },
                { id: 7003, text: "Time for cologne. What's the vibe tonight?", choices: [{ text: "A heavy, musky cologne.", nextId: 7004 }, { text: "A light, fresh cologne.", nextId: 7004 }] },
                { id: 7004, text: "Now for the outfit. You want to look good tonight.", choices: [{ text: "Wear a black polo shirt and grey pants.", nextId: 7100 }, { text: "Wear a long sleeve light grey sweater and tan pants.", nextId: 7100 }, { text: "Wear a black t-shirt with a nice jacket and grey pants.", nextId: 7100 }] },
                { id: 7010, text: "You get home with plenty of time. A little pampering is in order before your date.", choices: [{ text: "Take a long, relaxing shower.", nextId: 7011 }, { text: "Just a quick touch-up is fine.", nextId: 7011 }] },
                { id: 7011, text: "You stand in front of your huge perfume collection. What's the scent for tonight?", choices: [{ text: "A light and balanced perfume.", nextId: 7012 }, { text: "A deep floral scent.", nextId: 7012 }, { text: "A spicy and sweet perfume.", nextId: 7012 }] },
                { id: 7012, text: "Perfect. Now for the killer outfit.", choices: [{ text: "The silk slip dress in deep emerald.", nextId: 7110 }, { text: "The bright pink mini dress.", nextId: 7110 }, { text: "The high-waisted leather skirt with a satin blouse.", nextId: 7110 }] },
                { id: 7050, text: "You head out for your date, feeling excited.", routeBy: 'dateLocation', routes: { maggianos: 900, cheesecake: 322, hotpot: 312 } },
                { id: 7100, text: "You're dressed and about to head out when your phone buzzes. It's a text from your friend Aaron in the group chat: 'Boys, me and Ian just shot -4 and -5 at the outing today. We're basically pros.'", choices: [{ text: "Damn boys that's legit", nextId: 7200 }, { text: "Send a GIF of Tim Robinson squinting.", nextId: 7200 }, { text: "I figured you boys would be in the sub 6's like me in no time.", nextId: 7200 }] },
                { id: 7110, text: "You're dressed and look amazing. As you're about to grab your purse, your phone buzzes. It's a text from your friend Tammy in the group chat: 'omg you will never beleive what tyler got me, a great dane puppy!'", choices: [{ text: "oh wow how cute, whats the name?", nextId: 7111 }, { text: "those dogs get huge, you live in a studio", nextId: 7111 }, { text: "thats great haha", nextId: 7111 }] },
                { id: 7111, text: "You reply to the text, a smile on your face. One last check. Any accessories?", choices: [{ text: "Put on the ring your boyfriend gave you.", nextId: 7112 }, { text: "No, this is perfect.", nextId: 7200 }] },
                { id: 7112, text: "You slip on the beautiful ring. It sparkles on your finger.", setState: { hasRing: true }, choices: [{ text: "Okay, now you're ready.", nextId: 7200 }] },
                { id: 7200, text: "You're all ready to go. You grab your keys and wallet and head out the door.", choices: [{ text: "Head to the date.", nextId: 7050 }] },
                
                // Romance & Tire Change
                { id: 4000, text: "You unlock the door and step inside. As the door clicks shut, you turn to each other...", choices: [{ text: "The night fades away...", nextId: 6000 }] },
                { id: 6000, text: "You wake up late the next morning, the sun streaming through the blinds. Last night was amazing. You feel a deep sense of peace and happiness. After a while, they stir.", choices: [{ text: "'Morning, sleepyhead.'", nextId: 6001 }] },
                { id: 6001, text: "'Morning,' they say, their voice husky. 'Last night was... wow.' You both share a smile. 'I'm starving,' they add.", choices: [ { text: "Breakfast (Eggs/Toast)", nextId: 6002 }, { text: "Breakfast (Cereal)", nextId: 6002 }, { text: "Breakfast (Oatmeal)", nextId: 6002 }, { text: "Coffee Only", nextId: 6002 } ] },
                { id: 6002, text: "After a lazy breakfast filled with laughter and talk about your amazing date, you remember the problem. 'Oh, right... your car,' you say.", textFemale: "After a lazy breakfast filled with laughter and talk about your amazing date, you remember the problem. 'Oh, right... your car,' he says.", choices: [{ text: "What should we do about the flat tire?", nextId: 6003 }] },
                { id: 6003, text: "You both think for a moment. Her car is still sitting in the restaurant parking lot with a very flat tire.", textFemale: "You both think for a moment. His car is still sitting in the restaurant parking lot with a very flat tire.", choices: [ { text: "Call AAA. They can handle it.", nextId: 6004 }, { text: "I can fix it. It'll just take a while.", nextId: 6005 }, { text: "Let's just get you an Uber for now.", nextId: 6006 } ] },
                { id: 6004, text: "'Thanks for handling that,' she says, giving you a kiss. 'Today was perfect.'", textFemale: "'Thanks for handling that,' you say, giving him a kiss. 'Today was perfect.'", choices: [{ text: "The perfect end to a wild day.", nextId: 1205 }] },
                { id: 6005, text: "You decide to handle the tire yourself. It's the chivalrous thing to do.", choices: [{ text: "Time to get this sorted.", nextId: 8000 }] },
                { id: 6006, text: "You order her an Uber to get her home safely. 'Thank you for everything. Last night was incredible.'", textFemale: "He orders you an Uber to get you home safely. He gives you a long, passionate kiss. 'Thank you for everything. Last night was incredible.'", choices: [{ text: "A perfect end to a wild day.", nextId: 1205 }] },

                { id: 8000, text: "You order her an Uber. While you wait, you carry her bag out for her. 'I love you, and I had a wonderful time,' you say. 'I'm gonna go fix that tire. I'll text you when I'm done and I'll drop the car off, then we can go get my truck.'", choices: [{ text: "Wait for her reply.", nextId: 8001 }] },
                { id: 8001, text: "'Okay, love you too,' she says as the Uber pulls up. 'Be safe.' The car is waiting.", choices: [{ text: "Open the door for her.", nextId: 8002 }, { text: "Let her get in.", nextId: 8003 }] },
                { id: 8002, text: "You open the car door. The driver, an older man, smiles. 'You don't see that much anymore,' he says. You smile, close the door, and wave as she leaves.", choices: [{ text: "Time to get to work.", nextId: 8004 }] },
                { id: 8003, text: "She gets in the car, blows you a kiss, and is on her way. You wave as the car disappears down the street.", choices: [{ text: "Time to get to work.", nextId: 8004 }] },
                { id: 8004, text: "Alright, time to deal with this tire. It's a bit of a buzzkill, but you're still feeling great from the date.", choices: [{ text: "Smoke a joint before you go.", nextId: 8005 }, { text: "Just head straight over.", nextId: 8006 }] },
                { id: 8005, text: "You light up a joint and take a few puffs to get in the right headspace for some manual labor. You grab an extra one for the road.", choices: [{ text: "Head to the restaurant parking lot.", nextId: 8006 }] },
                { id: 8006, text: "You get to the restaurant parking lot. It's mostly empty now. You pull up next to her car and assess the situation.", choices: [{ text: "Time to jack up the car.", nextId: 8007 }] },
                { id: 8007, text: "Which jack are you going to use?", choices: [{ text: "The heavy floor jack from your truck.", nextId: 8008 }, { text: "The scissor jack in her car's trunk.", nextId: 8009 }] },
                { id: 8008, text: "You haul the heavy floor jack out of your truck. It's a beast to maneuver, but it's reliable. You get it in position under the car frame.", choices: [{ text: "Jack it up.", nextId: 8010 }] },
                { id: 8009, text: "You pop her trunk. It's held down by a stubborn zip tie. You spend a few frustrating minutes trying to wrestle it free, busting your knuckles against the trunk latch in the process. A little blood wells up.", choices: [{ text: "Okay, ow. Jack up the car.", nextId: 8010 }] },
                { id: 8010, text: "With the car safely jacked up, you get the lugs off and pull the wheel off. You quickly find the culprit: a small, sharp nail. You pull it out with your pliers. Now, to find the tire patch kit in your truck...", choices: [ { text: "Check the glovebox.", nextId: 8011 }, { text: "Check the center console.", nextId: 8012 }, { text: "Look in the storage under the back seat.", nextId: 8013 } ]},
                { id: 8011, text: "You rummage through the glovebox. No patch kit, but you do find a forgotten Starbucks gift card with a few bucks on it. Score.", setState: { giftCard: true }, choices: [{ text: "Okay, where else...", nextId: 8010 }] },
                { id: 8012, text: "You check the center console. No kit, but you find a pack of gum. You pop a piece in your mouth.", setState: { gum: true }, choices: [{ text: "Okay, where else...", nextId: 8010 }] },
                { id: 8013, text: "You lift the back seat and there it is. The trusty tire plug kit. You also spot an old shirt you forgot you had. Nice.", setState: { tirePlugs: true }, choices: [{ text: "Got it. Time to plug this thing.", nextId: 8014 }] },
                { id: 8014, text: "You get the sticky plug ready and ream the hole. This is the hard part: forcing the plug into the tire.", choices: [ { text: "Wedge the tire against the truck for leverage.", nextId: 8015 }, { text: "Sit on the tire and try to press it straight down.", nextId: 8016 } ]},
                { id: 8015, text: "You prop the tire against your truck's frame and use your body weight. With a grunt, the plug pops into place. Easy enough.", choices: [{ text: "Perfect. Now to fill it up.", nextId: 8017 }] },
                { id: 8016, text: "You sit on the tire, trying to get enough downward force. The tire wobbles, and the sticky patch goop smears all over your pant leg. The plug goes in crooked and fails. You curse, pull it out, and have to use the truck for leverage anyway. It works, but now your pants are stained.", choices: [{ text: "Finally. Now to fill it up.", nextId: 8017 }] },
                { id: 8017, text: "You get the portable air pump from your truck, plug it into the cigarette lighter, and fill the tire. It stops at a perfect 32 PSI. You put the wheel back on, lower the car, and tighten the lugs. All done.", choices: [{ text: "Job's finished. What about this mess?", nextId: 8018 }] },
                { id: 8018, text: "You look at the jacks, the tools, the patch kit wrappers.", choices: [{ text: "Toss everything in the back of the truck and leave.", nextId: 8019 }, { text: "Clean it all up properly.", nextId: 8020 }] },
                { id: 8019, text: "You quickly throw all the tools into the bed of your truck and hop in. You send a quick text: 'Car is all set. On my way to drop it off!'", choices: [{ text: "The perfect end to a wild day.", nextId: 1205 }] },
                { id: 8020, text: "You take a few extra minutes to put everything back in its proper place. As you're finishing up, a couple of teenagers skateboard into the parking lot. They see you watching them.", choices: [{ text: "'You skate?' one of them asks.", nextId: 8021 }] },
                { id: 8021, text: "They're just kids, full of energy. You can't help but smile.", choices: [ { text: "'Yeah, a little bit.'", nextId: 8022 }, { text: "'Nah, not really.'", nextId: 8022 }, { text: "'Not anymore, but I used to.'", nextId: 8022 } ]},
                { id: 8022, text: "'No way! Try a kickflip on this,' the kid says, offering you his board.", choices: [ { text: "Okay, try a kickflip.", nextId: 8023 }, { text: "Nah, let's impress them with a tre flip.", nextId: 8023 }, { text: "Do a 360 shove-it.", nextId: 8024 } ]},
                { id: 8023, text: "You pop the board, flick your ankle, and land it cleanly. The kids give you a nod of respect. 'Sick.'", choices: [{ text: "Give the board back.", nextId: 8025 }] },
                { id: 8024, text: "You decide to show off a little. You pop the board and it spins a perfect 360 degrees under your feet before you land bolts. The kids lose their minds. 'WHOA! THAT WAS INSANE!'", choices: [{ text: "Give the board back, legend.", nextId: 8025 }] },
                { id: 8025, text: "You hand the board back with a smile. You feel pretty cool. You shoot your girlfriend a text: 'Car is all set. On my way to drop it off!' What a day.", choices: [{ text: "The perfect end to a wild day.", nextId: 1205 }] },

                // Endings and other paths
                { id: 1205, text: "This single day has changed your life forever. THE END.", choices: [{ text: "Play Again", nextId: 1 }] }
            ];
            
            // --- GAME STATE ---
            let gameState = {
                currentUser: '',
                playerGender: '',
                playerState: {},
            };

            const defaultPlayerState = { 
                hasKey: false, hasCoins: false, wearsHawaiianShirt: false, hasGlock: false, hasCarInfo: false,
                giftCard: false, tirePlugs: false, gum: false, cones: false, bluntWrap: false, candy: false,
                lotteryTicket: false, bossMug: false, stevesCard: false, embarrassingPhoto: false, heardGossip: false,
                fiveDollars: false, silverDollar: false, oldCasinoChip: false, guitarPick: false, silverLocket: false, pocketKnife: false,
                hasRing: false, usedBathroom: false, dateLocation: null
             };
             
             // --- CORE GAME LOGIC ---

            /**
             * Applies a color theme to the entire UI.
             * @param {string} themeName - The name of the theme to apply.
             */
            function applyTheme(themeName) {
                const theme = themes[themeName] || themes.default;
                const allThemeClasses = [...new Set(Object.values(themes).flatMap(t => Object.values(t)).join(' ').split(' '))];

                const applyClasses = (element, classList) => {
                    if (!element) return;
                    element.classList.remove(...allThemeClasses);
                    element.classList.add(...classList.split(' '));
                };

                applyClasses(document.body, `${theme.bg} ${theme.text}`);
                document.querySelectorAll('.themed-container').forEach(el => applyClasses(el, theme.container));
                document.querySelectorAll('.themed-text').forEach(el => applyClasses(el, theme.text));
                document.querySelectorAll('.themed-subtle-text').forEach(el => applyClasses(el, theme.subtleText));
                document.querySelectorAll('.themed-primary-btn').forEach(el => applyClasses(el, theme.primaryBtn));
                document.querySelectorAll('.themed-input').forEach(el => applyClasses(el, theme.input));
                document.querySelectorAll('.themed-border').forEach(el => applyClasses(el, theme.border));
                
                if (elements.choicesContainerElement) {
                    elements.choicesContainerElement.dataset.secondaryBtnClass = theme.secondaryBtn;
                }
            }

            /**
             * Updates the inventory display based on the current player state.
             */
            function updateInventoryDisplay() {
                if (!elements.inventoryList) return;
                elements.inventoryList.innerHTML = '';
                const itemsMap = {
                    hasKey: "Small Ornate Key", hasCoins: "8 Gold Coins", lotteryTicket: "Winning Lottery Ticket ($100)",
                    bossMug: "Chipped 'World's Best Boss' Mug", stevesCard: "Steve's Business Card", hasCarInfo: "Note with Phone # (Corvette)",
                    hasGlock: "Gold 9mm Glock", giftCard: "Starbucks Gift Card", tirePlugs: "Tire Plug Kit", gum: "Pack of Gum",
                    cones: "Raw Cones", bluntWrap: "Blunt Wrap", candy: "Partner's Favorite Candy", embarrassingPhoto: "Embarrassing High School Photo",
                    fiveDollars: "$5 Bill", silverDollar: "Old Silver Dollar", oldCasinoChip: "Old Casino Chip",
                    guitarPick: "Worn Guitar Pick", silverLocket: "Silver Locket", pocketKnife: "Classic Pocket Knife", hasRing: "Boyfriend's Ring"
                };

                const items = Object.keys(gameState.playerState)
                    .filter(key => gameState.playerState[key] && itemsMap[key])
                    .map(key => itemsMap[key]);

                if (items.length > 0) {
                    elements.inventoryContainer.classList.remove('hidden');
                    items.forEach(itemText => {
                        const li = document.createElement('li');
                        li.textContent = itemText;
                        elements.inventoryList.appendChild(li);
                    });
                } else {
                    elements.inventoryContainer.classList.add('hidden');
                }
            }
            
            /**
             * Main function to display a story node and its choices.
             * @param {number} nodeId - The ID of the story node to display.
             */
            function showStoryNode(nodeId) {
                let currentNode = story.find(node => node.id === nodeId);

                if (!currentNode) {
                    console.error(`Story node with id ${nodeId} not found! Resetting.`);
                    return showStoryNode(1);
                }

                if (currentNode.routeBy) {
                    const routeValue = gameState.playerState[currentNode.routeBy] || gameState[currentNode.routeBy];
                    const nextNodeId = currentNode.routes[routeValue];
                    if (nextNodeId !== undefined) {
                        return showStoryNode(nextNodeId);
                    } else {
                         console.error(`Invalid route for node ${nodeId} with value ${routeValue}`);
                         return showStoryNode(1);
                    }
                }

                if (currentNode.setState) {
                    Object.assign(gameState.playerState, currentNode.setState);
                }
                
                const textToDisplay = (gameState.playerGender === 'female' && currentNode.textFemale)
                    ? currentNode.textFemale
                    : currentNode.text;

                elements.storyTextElement.classList.remove('fade-in');
                void elements.storyTextElement.offsetWidth;
                elements.storyTextElement.innerText = textToDisplay;
                elements.storyTextElement.classList.add('fade-in');
                
                elements.choicesContainerElement.innerHTML = '';
                
                const availableChoices = currentNode.choices.filter(choice => {
                    if (!choice.condition) return true;
                    
                    let stateConditionMet = true;
                    if (choice.condition.state) {
                        const stateKey = choice.condition.state;
                        if (stateKey.startsWith('!')) {
                            stateConditionMet = !gameState.playerState[stateKey.substring(1)];
                        } else {
                            stateConditionMet = gameState.playerState[stateKey];
                        }
                    }

                    const genderConditionMet = !choice.condition.gender || gameState.playerGender === choice.condition.gender;

                    return stateConditionMet && genderConditionMet;
                });

                availableChoices.forEach(choice => {
                    const button = document.createElement('button');
                    const choiceText = (gameState.playerGender === 'female' && choice.textFemale) ? choice.textFemale : choice.text;
                    
                    button.innerText = choiceText;
                    const secondaryBtnClasses = elements.choicesContainerElement.dataset.secondaryBtnClass || themes.default.secondaryBtn;
                    button.className = `w-full text-white font-semibold py-3 px-4 rounded-lg shadow-md transition-all duration-300 ease-in-out transform hover:scale-105 fade-in ${secondaryBtnClasses}`;
                    
                    button.addEventListener('click', () => {
                        saveProgress(choice.nextId);
                        showStoryNode(choice.nextId);
                    });
                    elements.choicesContainerElement.appendChild(button);
                });
                
                updateInventoryDisplay();
            }

            /**
             * Handles starting the game after a user provides their name.
             */
            function startGame() {
                const username = elements.usernameInput.value.trim();
                if (!username) {
                    elements.usernameInput.placeholder = "Please enter a name!";
                    elements.usernameInput.classList.add('placeholder-red-400', 'ring-2', 'ring-red-500');
                    return;
                }
                gameState.currentUser = username;
                elements.playerNameElement.innerText = gameState.currentUser;

                const savedData = loadProgress();
                if (savedData && savedData.nodeId) {
                    gameState.playerGender = savedData.gender;
                    gameState.playerState = { ...defaultPlayerState, ...savedData.state };
                    elements.welcomeScreen.classList.add('hidden');
                    elements.gameContainer.classList.remove('hidden', 'fade-in');
                    void elements.gameContainer.offsetWidth;
                    elements.gameContainer.classList.add('fade-in');
                    showStoryNode(savedData.nodeId);
                } else {
                    elements.usernameInput.classList.add('hidden');
                    elements.startButton.classList.add('hidden');
                    elements.welcomeScreen.querySelector('.themed-subtle-text').innerText = `Welcome, ${gameState.currentUser}. Select your character.`;
                    elements.genderSelectionContainer.classList.remove('hidden');
                }
            }

            /**
             * Sets the player's gender and begins a new adventure.
             * @param {string} gender - 'male' or 'female'.
             */
            function setGenderAndStart(gender) {
                gameState.playerGender = gender;
                gameState.playerState = { ...defaultPlayerState };
                elements.welcomeScreen.classList.add('hidden');
                elements.gameContainer.classList.remove('hidden', 'fade-in');
                void elements.gameContainer.offsetWidth;
                elements.gameContainer.classList.add('fade-in');
                saveProgress(1);
                showStoryNode(1);
            }

            // --- LOCAL STORAGE ---
            function saveProgress(nodeId) {
                try {
                    const allProgress = JSON.parse(localStorage.getItem('adventureGameProgress')) || {};
                    allProgress[gameState.currentUser] = { nodeId, gender: gameState.playerGender, state: gameState.playerState };
                    localStorage.setItem('adventureGameProgress', JSON.stringify(allProgress));
                } catch (e) {
                    console.error("Could not save progress:", e);
                }
            }

            function loadProgress() {
                try {
                    const allProgress = JSON.parse(localStorage.getItem('adventureGameProgress')) || {};
                    return allProgress[gameState.currentUser];
                } catch (e) {
                    console.error("Could not load progress:", e);
                    return null;
                }
            }
            
            // --- INITIALIZATION & EVENT LISTENERS ---
            
            const savedTheme = localStorage.getItem('adventureGameTheme');
            if (savedTheme) {
                applyTheme(savedTheme);
                elements.welcomeScreen.classList.remove('hidden');
            } else {
                elements.colorSelectionScreen.classList.remove('hidden');
            }

            document.querySelectorAll('.theme-btn').forEach(button => {
                button.addEventListener('click', () => {
                    const themeName = button.dataset.theme;
                    localStorage.setItem('adventureGameTheme', themeName);
                    applyTheme(themeName);
                    elements.colorSelectionScreen.classList.add('hidden');
                    elements.welcomeScreen.classList.remove('hidden', 'fade-in');
                    void elements.welcomeScreen.offsetWidth;
                    elements.welcomeScreen.classList.add('fade-in');
                });
            });

            elements.startButton.addEventListener('click', startGame);
            elements.usernameInput.addEventListener('keyup', e => e.key === 'Enter' && startGame());
            elements.maleButton.addEventListener('click', () => setGenderAndStart('male'));
            elements.femaleButton.addEventListener('click', () => setGenderAndStart('female'));

            elements.resetButton.addEventListener('click', () => {
                localStorage.removeItem('adventureGameProgress');
                localStorage.removeItem('adventureGameTheme');
                window.location.reload();
            });
        });
    </script>
</body>
</html>

