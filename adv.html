<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Choose Your Own Adventure</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Simple fade-in animation for new content */
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4 transition-colors duration-500">

    <!-- Screen for selecting a color theme -->
    <div id="color-selection-screen" class="w-full max-w-md bg-gray-800 rounded-xl shadow-2xl p-6 md:p-8 text-center fade-in hidden">
        <h1 class="text-3xl font-bold mb-4 text-white">Pick A Theme</h1>
        <p class="mb-6 text-gray-400">Choose a color scheme for your adventure.</p>
        <div class="grid grid-cols-2 sm:grid-cols-3 gap-4">
            <button data-theme="default" class="theme-btn bg-slate-700 text-white p-4 rounded-lg font-semibold transition-transform hover:scale-105">Default</button>
            <button data-theme="green" class="theme-btn bg-green-600 text-white p-4 rounded-lg font-semibold transition-transform hover:scale-105">Green</button>
            <button data-theme="blue" class="theme-btn bg-sky-600 text-white p-4 rounded-lg font-semibold transition-transform hover:scale-105">Blue</button>
            <button data-theme="purple" class="theme-btn bg-purple-600 text-white p-4 rounded-lg font-semibold transition-transform hover:scale-105">Purple</button>
            <button data-theme="pink" class="theme-btn bg-pink-500 text-white p-4 rounded-lg font-semibold transition-transform hover:scale-105">Pink</button>
            <button data-theme="gray" class="theme-btn bg-gray-500 text-white p-4 rounded-lg font-semibold transition-transform hover:scale-105">Gray</button>
        </div>
    </div>

    <!-- Welcome screen for username input -->
    <div id="welcome-screen" class="w-full max-w-md rounded-xl shadow-2xl p-6 md:p-8 text-center hidden themed-container">
        <h1 class="text-3xl font-bold mb-4 themed-text">Choose Your Name</h1>
        <p class="mb-6 themed-subtle-text">Enter your name to begin or continue your journey.</p>
        <input type="text" id="username-input" placeholder="Your Name" class="w-full text-white rounded-lg px-4 py-3 mb-4 focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-shadow themed-input">
        <button id="start-button" class="w-full text-white font-bold py-3 px-4 rounded-lg shadow-md transition-all duration-300 transform hover:scale-105 themed-primary-btn">Start Adventure</button>
        
        <!-- Gender selection appears after name is entered for a new game -->
        <div id="gender-selection" class="hidden mt-4">
            <p class="mb-4 themed-subtle-text">Select your character.</p>
            <div class="flex gap-4">
                <button id="male-button" class="w-full bg-sky-600 hover:bg-sky-700 text-white font-bold py-3 px-4 rounded-lg shadow-md transition-all duration-300">Male</button>
                <button id="female-button" class="w-full bg-pink-500 hover:bg-pink-600 text-white font-bold py-3 px-4 rounded-lg shadow-md transition-all duration-300">Female</button>
            </div>
        </div>
    </div>

    <!-- Main game container -->
    <div id="game-container" class="w-full max-w-2xl rounded-xl shadow-2xl p-6 md:p-8 hidden themed-container">
        <div class="flex justify-between items-center mb-2 pb-4 border-b themed-border">
            <p class="themed-subtle-text">Player: <span id="player-name" class="font-bold themed-text"></span></p>
            <button id="reset-button" class="text-sm bg-red-600 hover:bg-red-700 text-white font-semibold py-1 px-3 rounded-lg transition-colors duration-300">Reset Progress</button>
        </div>
        
        <!-- Inventory will be displayed here when items are collected -->
        <div id="inventory-container" class="mb-4 p-3 rounded-lg hidden themed-input">
            <h3 class="font-bold mb-2 themed-text text-sm">Inventory</h3>
            <ul id="inventory-list" class="text-sm space-y-1 themed-subtle-text list-disc list-inside">
                <!-- Items dynamically added by JavaScript -->
            </ul>
        </div>

        <!-- Story text is displayed here -->
        <div id="story-text" class="text-lg md:text-xl leading-relaxed mb-6 themed-text"></div>
        
        <!-- Choices are displayed here -->
        <div id="choices-container" class="grid grid-cols-1 gap-4"></div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            
            // --- DOM ELEMENTS ---
            const elements = {
                colorSelectionScreen: document.getElementById('color-selection-screen'),
                welcomeScreen: document.getElementById('welcome-screen'),
                gameContainer: document.getElementById('game-container'),
                usernameInput: document.getElementById('username-input'),
                startButton: document.getElementById('start-button'),
                resetButton: document.getElementById('reset-button'),
                storyTextElement: document.getElementById('story-text'),
                choicesContainerElement: document.getElementById('choices-container'),
                playerNameElement: document.getElementById('player-name'),
                genderSelectionContainer: document.getElementById('gender-selection'),
                maleButton: document.getElementById('male-button'),
                femaleButton: document.getElementById('female-button'),
                inventoryContainer: document.getElementById('inventory-container'),
                inventoryList: document.getElementById('inventory-list')
            };

            // --- THEME DATA ---
            const themes = {
                default: { bg: 'bg-slate-900', container: 'bg-slate-800', text: 'text-slate-200', subtleText: 'text-slate-400', primaryBtn: 'bg-indigo-600 hover:bg-indigo-700', secondaryBtn: 'bg-slate-700 hover:bg-indigo-600', input: 'bg-slate-700', border: 'border-slate-700' },
                green: { bg: 'bg-green-900', container: 'bg-green-800', text: 'text-white', subtleText: 'text-green-200', primaryBtn: 'bg-lime-500 hover:bg-lime-600', secondaryBtn: 'bg-green-700 hover:bg-lime-500', input: 'bg-green-700', border: 'border-green-700' },
                blue: { bg: 'bg-blue-900', container: 'bg-blue-800', text: 'text-white', subtleText: 'text-blue-200', primaryBtn: 'bg-sky-500 hover:bg-sky-600', secondaryBtn: 'bg-blue-700 hover:bg-sky-500', input: 'bg-blue-700', border: 'border-blue-700' },
                purple: { bg: 'bg-purple-900', container: 'bg-purple-800', text: 'text-white', subtleText: 'text-purple-200', primaryBtn: 'bg-fuchsia-500 hover:bg-fuchsia-600', secondaryBtn: 'bg-purple-700 hover:bg-fuchsia-500', input: 'bg-purple-700', border: 'border-purple-700' },
                pink: { bg: 'bg-pink-100', container: 'bg-white', text: 'text-pink-800', subtleText: 'text-pink-500', primaryBtn: 'bg-pink-500 hover:bg-pink-600', secondaryBtn: 'bg-pink-100 hover:bg-pink-200 text-pink-700', input: 'bg-pink-50 text-pink-900', border: 'border-pink-300' },
                gray: { bg: 'bg-gray-200', container: 'bg-white', text: 'text-gray-900', subtleText: 'text-gray-600', primaryBtn: 'bg-gray-800 hover:bg-gray-900', secondaryBtn: 'bg-gray-100 hover:bg-gray-300 text-gray-800', input: 'bg-gray-100 text-gray-800', border: 'border-gray-300' }
            };
            
            // --- STORY DATA (COMPLETE) ---
            const story = [
                // Morning Routine
                { id: 1, text: 'You open your eyes. The dream is already gone, just a vague feeling of unease remains. The alarm blares.', choices: [{ text: "Hit snooze", nextId: 11 }, { text: "Get up and stretch", nextId: 12 }, { text: "Grab your phone first", nextId: 13 }, { text: "Take a wake and bake dab", nextId: 60 }] },
                { id: 11, text: "You drift off again. Suddenly itâ€™s 7:30. Youâ€™re late.", choices: [{ text: "Rush out of bed, forget shower/breakfast", nextId: 21 }, { text: "Say screw it, call in sick", nextId: 22 }] },
                { id: 12, text: "Your muscles pop. You feel awake. Time for the bathroom.", choices: [{ text: "Hot shower", nextId: 23 }, { text: "Cold shower", nextId: 24 }, { text: "Skip shower, brush teeth only", nextId: 25 }] },
                { id: 13, text: 'You scroll through your phone. A weirdly targeted ad appears: "Tired of your boring life? Try Tactical Soap. Washes away the grime AND the regret."', choices: [{ text: "Click the ad", nextId: 26 }, { text: "Ignore it, head to bathroom", nextId: 27 }] },
                
                // Late / Sick Path
                { id: 21, text: "You scramble around, a whirlwind of panicked energy.", choices: [{ text: "Throw on random clothes quickly", nextId: 31 }, { text: "Leave house in pajamas", nextId: 32 }] },
                { id: 22, text: "You grab your phone and call in sick, putting on your best 'dying frog' voice. The day is yours.", choices: [{ text: "Actually stay home all day", nextId: 33 }, { text: "Decide to explore the city instead", nextId: 34 }, { text: "Smoke weed and see where the day goes", nextId: 70 }, { text: "Go get a proper diner breakfast.", nextId: 10000 }, { text: "Finally fix that wobbly bookshelf.", nextId: 10010 }, { text: "Finally return that overdue library book.", nextId: 9000 }] },

                // Shower Path
                { id: 23, text: "The hot water is a blessing, melting away the last of your sleepiness. You feel refreshed and relaxed.", choices: [{ text: "Get dressed", nextId: 88 }] },
                { id: 24, text: "The cold water is a shock to the system. You gasp, but emerge feeling electric and wide awake, if a little cranky.", choices: [{ text: "Get dressed", nextId: 88 }] },
                { id: 25, text: "You give your teeth a thorough brushing, but decide a shower is a luxury you don't have time for. You smell a little, but oh well.", choices: [{ text: "Get dressed", nextId: 88 }] },

                // Ad Path
                { id: 26, text: 'The ad takes you to a GeoCities-looking website for "Tactical Soap." It\'s full of testimonials from guys named Chad and Brad. At the bottom, a tiny link says: "For TRUE believers ONLY."', choices: [{ text: "Click the 'TRUE believers' link", nextId: 261 }, { text: "Close the tab, this is stupid", nextId: 27 }] },
                { id: 261, text: "The link takes you to a forum about cryptid sightings in your area. Apparently, someone saw a 'Wobble-Gonk' near the old mill. You've wasted five minutes you'll never get back.", choices: [{ text: "Head to the bathroom", nextId: 27 }] },
                { id: 27, text: "It's just an ad. You toss your phone on the bed and head to the bathroom.", choices: [{ text: "Hot shower", nextId: 23 }, { text: "Cold shower", nextId: 24 }, { text: "Skip shower", nextId: 25 }] },

                // Breakfast / Commute Path
                { id: 31, text: "You grab a shirt and pants from the floor. They might be clean. They might not. No time to check.", choices: [{ text: "Breakfast (Eggs/Toast)", nextId: 41 }, { text: "Breakfast (Cereal)", nextId: 42 }, { text: "Breakfast (Oatmeal)", nextId: 46 }, { text: "Coffee Only", nextId: 43 }, { text: "Skip Breakfast", nextId: 44 }] },
                { id: 32, text: "You're already late, what's a dress code violation on top of it? You walk out the door in your flannel pajama pants.", choices: [{ text: "Breakfast (Eggs/Toast)", nextId: 41 }, { text: "Breakfast (Cereal)", nextId: 42 }, { text: "Breakfast (Oatmeal)", nextId: 46 }, { text: "Coffee Only", nextId: 43 }, { text: "Skip Breakfast", nextId: 44 }] },
                { id: 41, text: "You quickly whip up some eggs and toast. A solid breakfast.", choices: [{ text: "Commute (Drive)", nextId: 51 }, { text: "Commute (Bus)", nextId: 52 }, { text: "Smoke a bowl before you go", nextId: 80 }, { text: "Skip Work Last Minute", nextId: 54 }] },
                { id: 42, text: "You pour a bowl of cereal. It's fast and easy.", choices: [{ text: "Commute (Drive)", nextId: 51 }, { text: "Commute (Bus)", nextId: 52 }, { text: "Smoke a bowl before you go", nextId: 80 }, { text: "Skip Work Last Minute", nextId: 54 }] },
                { id: 43, text: "No time for food. You brew a strong cup of coffee and drink it black.", choices: [{ text: "Drink a second cup", nextId: 431 }, { text: "One is enough. Time to go.", nextId: 45 }] },
                { id: 44, text: "Your stomach rumbles, but you ignore it. Time is money.", choices: [{ text: "Commute (Drive)", nextId: 51 }, { text: "Commute (Bus)", nextId: 52 }, { text: "Smoke a bowl before you go", nextId: 80 }, { text: "Skip Work Last Minute", nextId: 54 }] },
                { id: 45, text: "Caffeine coursing through your veins, you head for the door.", choices: [{ text: "Commute (Drive)", nextId: 51 }, { text: "Commute (Bus)", nextId: 52 }, { text: "Smoke a bowl before you go", nextId: 80 }, { text: "Skip Work Last Minute", nextId: 54 }] },
                { id: 46, text: "You make a quick bowl of oatmeal. It's warm and filling.", choices: [{ text: "Commute (Drive)", nextId: 51 }, { text: "Commute (Bus)", nextId: 52 }, { text: "Smoke a bowl before you go", nextId: 80 }, { text: "Skip Work Last Minute", nextId: 54 }] },
                { id: 431, text: "The second cup makes your heart pound. You feel wired, a bit jittery, but immensely focused.", choices: [{ text: "Drink a third cup. Embrace the chaos.", nextId: 432 }, { text: "Okay, that's enough. Time to go.", nextId: 45 }] },
                { id: 432, text: "You down the third cup. Your hands are shaking. You are a being of pure caffeine, ready to face the day at 1000 mph.", choices: [{ text: "Commute (Drive, VERY fast)", nextId: 512 }, { text: "Commute (Bus, try not to vibrate out of your seat)", nextId: 52 }] },

                // Branching to Main Storylines
                { id: 51, text: "You get in your old, trusty truck and head to your job at the bank. The gas gauge is broken, but you have a pretty good feel for it. Usually. Halfway there, the engine sputters and dies. You're out of gas.", choices: [{ text: "Call for help", nextId: 401 }, { text: "Start walking to the nearest gas station", nextId: 402 }, { text: "Call an Uber to work and deal with this later", nextId: 403 }, { text: "Just wait and see what happens", nextId: 405 }] },
                { id: 52, text: "You catch the bus to work. As you ride, you see someone drop a folded piece of paper. You pick it up. It looks like a lottery ticket.", choices: [{ text: "Check the numbers.", nextId: 55 }, { text: "Put it in your pocket for later.", nextId: 101 }] },
                { id: 54, text: "You know what? Screw it. You're not going to work. The city awaits.", choices: [{ text: "Begin your adventure", nextId: 34 }] },
                { id: 55, text: "You pull up the lottery results on your phone. You scan the ticket. Holy cow. It's a $100 winner! You carefully fold it and put it in your pocket, a grin spreading across your face.", setState: { lotteryTicket: true }, choices: [{ text: "Arrive at the bank, feeling lucky.", nextId: 101 }] },

                // Weed Paths
                { id: 60, text: "You grab your rig from the nightstand. The torch roars to life. You take a fat dab and hold it in, coughing until you see stars. The world slows down. Everything is hazy and kinda funny now.", choices: [{ text: "Get up and stretch (slowly)", nextId: 61 }, { text: "Grab your phone and zone out", nextId: 13 }] },
                { id: 61, text: "You slowly rise, your body feeling both heavy and light. A good stretch feels incredible. Time to get ready, maybe.", choices: [{ text: "Hot shower", nextId: 62 }, { text: "Cold shower", nextId: 63 }, { text: "Just brush teeth", nextId: 64 }] },
                { id: 62, text: "The hot water feels amazing. You space out for what feels like an hour, just enjoying the steam.", choices: [{ text: "Get dressed.", nextId: 88 }] },
                { id: 63, text: "The cold water is a sensory explosion. Your brain short-circuits for a second, then reboots with crystal clarity. A bold choice.", choices: [{ text: "Get dressed.", nextId: 88 }] },
                { id: 64, text: "Showering seems like a lot of work. You brush your teeth meticulously instead, focusing intensely on each tooth.", choices: [{ text: "Get dressed.", nextId: 88 }] },
                { id: 70, text: "You pack a fat bowl. The sweet smoke fills your lungs. An hour later, you're staring at the ceiling, contemplating the mysteries of the universe and whether you have any chips in the house.", choices: [{ text: "Watch TV", nextId: 71 }, { text: "Go on a snack quest to the kitchen", nextId: 72 }, { text: "Mindlessly scroll Facebook Marketplace", nextId: 73 }] },
                { id: 71, text: "You flip on the TV. What's the plan?", choices: [{ text: "See what's on Adult Swim", nextId: 711 }, { text: "Watch daytime court shows and feel superior", nextId: 712 }] },
                { id: 72, text: "You embark on a perilous journey to the kitchen. You construct a magnificent sandwich out of leftovers and eat it over the sink like an animal. It's the best thing you've ever tasted.", choices: [{ text: "A truly magnificent sandwich.", nextId: 79 }] },
                { id: 73, text: "You open Facebook Marketplace. Amidst the broken furniture and MLM scams, something beautiful catches your eye: a 1995 Z28 Camaro, T-tops, cherry red. The price is... suspiciously low.", choices: [{ text: "Message the seller: 'is this still available?'", nextId: 201 }, { text: "Assume it's a scam and look for weird taxidermy instead", nextId: 70 }] },
                { id: 79, text: "You spend the rest of the day in a blissful haze. As evening sets in, your phone buzzes, pulling you back to reality.", choices: [{ text: "See who it is.", nextId: 299 }] },
                { id: 80, text: "You take a quick rip from your bong to 'prepare' for the day. You feel calm, maybe too calm. Time to head to work, hopefully no one notices your eyes are as red as the devil's... well, you know.", choices: [{ text: "Commute (Drive, probably a bad idea)", nextId: 511 }, { text: "Commute (Bus, the safer choice)", nextId: 52 }] },
                
                // Getting Dressed (Morning)
                { id: 88, text: "You quickly throw on some clothes suitable for the day ahead.", choices: [{ text: "Any final preparations?", nextId: 89 }] },
                { id: 89, routeBy: 'gender', routes: { male: 90, female: 95 } },
                { id: 90, text: "You're all dressed. One last look in the mirror. Any final preparations before breakfast?", choices: [{ text: "Strap on your shoulder harness and gold 9mm Glock.", nextId: 91 }, { text: "Nah, let's just get some breakfast.", nextId: 95 }] },
                { id: 91, text: "You open a hidden compartment in your closet and pull out your custom gold 9mm Glock. You strap on the leather shoulder harness. It feels heavy and familiar under your jacket. You're ready for anything.", setState: { hasGlock: true }, choices: [{ text: "Now for some breakfast.", nextId: 95 }] },
                { id: 95, text: "You head to the kitchen, ready for the most important meal of the day.", choices: [{ text: "Breakfast (Eggs/Toast)", nextId: 41 }, { text: "Breakfast (Cereal)", nextId: 42 }, { text: "Breakfast (Oatmeal)", nextId: 46 }, { text: "Coffee Only", nextId: 43 }, { text: "Skip Breakfast", nextId: 44 }] },

                // Bank Teller Path
                { id: 101, text: "Centerville Savings Bank stands tall in its beige blandness. The lobby smells faintly of stale coffee and Lysol. You swipe in and step behind the counter. Matt, your coworker, waves at you. 'Hey, they finally restocked the Nutter Butters.' Mr. Johns, your boss, shuffles past. 'Clock in already. And no slacking.'", textFemale: "Centerville Savings Bank stands tall in its beige blandness. The lobby smells faintly of stale coffee and Lysol. You swipe in and step behind the counter. Karen, your coworker, waves at you. 'Hey, they finally restocked the Nutter Butters.' Mr. Johns, your boss, shuffles past. 'Clock in already. And no slacking.'", choices: [{ text: "Talk about Nutter Butters.", nextId: 102 }, { text: "Go straight to work", nextId: 130 }, { text: "Sneak to breakroom for a donut first", nextId: 104 }] },
                { id: 130, text: "As you wait for the first customer, you think of your partner. You miss them. You pull out your phone under the counter.", choices: [{ text: "Send them a â¤ï¸ and ðŸ˜˜ emoji.", nextId: 131 }, { text: "Send them an 'i miss you bb' text.", nextId: 132 }, { text: "Just think about them. Don't want to seem clingy.", nextId: 133 }] },
                { id: 140, text: "The rest of the workday is surprisingly calm. As you're packing up to leave, your phone buzzes.", choices: [{ text: "Check the text.", nextId: 299 }] },
                
                // End of Day / Date Decision
                { id: 299, text: "As evening approaches, your phone buzzes with a text from your partner.", choices: [{ text: "Read it.", nextId: 300 }] },
                { id: 300, text: "'Hey! Date night tonight :) Where do you want to go?'", textFemale: "'Hey! Date night tonight :) Where do you want to go?'", choices: [{ text: "Maggiano's", nextId: 301 }, { text: "The Cheesecake Factory", nextId: 321 }, { text: "The Mala Hot Pot", nextId: 311 }] },
                { id: 301, text: "You text back: 'Maggiano's for sure.' They reply instantly: 'Yesss! Perfect. See you in a bit!'", textFemale: "You text back: 'Maggiano's for sure.' He replies instantly: 'Yesss! Perfect. See you in a bit!'", setState: { dateLocation: 'maggianos' }, choices: [{ text: "Time to get ready.", nextId: 7000 }] },
                { id: 311, text: "You text back: 'Let's try the hot pot place!' They reply: 'Yay! I'm so excited! I'll meet you there!'", textFemale: "You text back: 'Let's try the hot pot place!' He replies: 'Yay! I'm so excited! I'll meet you there!'", setState: { dateLocation: 'hotpot' }, choices: [{ text: "Time to get ready.", nextId: 7000 }] },
                { id: 321, text: "You suggest The Cheesecake Factory. A classic choice. They text back: 'Okay! The wait will be insane but I need that brown bread. See you there!'", textFemale: "You suggest The Cheesecake Factory. A classic choice. He texts back: 'Okay! The wait will be insane but I need that brown bread. See you there!'", setState: { dateLocation: 'cheesecake' }, choices: [{ text: "Time to get ready.", nextId: 7000 }] },
                
                // Arrival at Date
                { id: 312, text: "You arrive at the Hot Pot restaurant. The smell of sichuan peppercorns is in the air as you're seated.", choices: [{ text: "So, about your day...", nextId: 2000 }] },
                { id: 322, text: "You arrive at The Cheesecake Factory. It's bustling, as expected, but you get a table.", choices: [{ text: "So, about your day...", nextId: 2000 }] },
                { id: 900, text: "You arrive at Maggiano's. The atmosphere is cozy and romantic. You're seated at your table and look over the menu.", choices: [{ text: "Your partner points out an expensive bottle of wine.", nextId: 901 }, { text: "You spot something on the floor by a vacant table.", nextId: 307 }, { text: "Excuse yourself to the bathroom.", nextId: 950, condition: { gender: 'female', state: '!usedBathroom' } }] },
                
                // Date Scenarios
                { id: 950, text: "You excuse yourself and head to the restroom. It's a moment of quiet away from the restaurant buzz.", setState: { usedBathroom: true }, choices: [{ text: "Check your phone.", nextId: 951 }, { text: "Just freshen up and head back.", nextId: 900 }] },
                { id: 951, text: "You pull out your phone and see a text from your best friend Cammy: 'Hey hows the date?'", choices: [{ text: "its great!", nextId: 952 }, { text: "Girl, its amazing", nextId: 952 }, { text: "The food is the best here.", nextId: 952 }] },
                { id: 952, text: "You quickly send the text and put your phone away. You head back to the table, feeling refreshed.", choices: [{ text: "Continue the date...", nextId: 900 }] },
                { id: 2000, text: "Your partner leans in conspiratorially. 'Oh my god, there is tea,' they say, their eyes wide. 'There is work tea.'", textFemale: "Your partner leans in conspiratorially. 'Oh my god, there is tea,' he says, his eyes wide. 'There is work tea.'", choices: [ { text: "Remind him about the ring you're wearing.", nextId: 2029, condition: { gender: 'female', state: 'hasRing' } }, { text: "Okay, let's hear it.", nextId: 2001 }, { text: "You know I love it.", nextId: 2001 }, { text: "Oh yeah? Is it that you're the hottest woman that works there?", textFemale: "Oh yeah? Is it that you're the most handsome guy that works there?", nextId: 2002 } ] },
                { id: 2001, text: "Your partner launches into a long, dramatic story about office politics involving a birthday cake and a shared blouse. It's petty, hilarious, and you're completely engrossed.", choices: [{ text: "What a night.", nextId: 2011 }] },
                { id: 2002, text: "Your partner playfully rolls their eyes and laughs. 'Shut up. Okay, but for real, listen to this.'", textFemale: "Your boyfriend laughs. 'I wish. Nah, listen to this.'", choices: [{ text: "I'm listening...", nextId: 2001 }] },
                { id: 2011, text: "After the story, the conversation flows easily. The date is going perfectly.", choices: [{ text: "Time to head home.", nextId: 3000 }] },
                { id: 2029, text: "'This is still my favorite ring,' you say, showing him your hand. He smiles. 'I remember getting that for you a year ago. It looks perfect on you. I'll have to get you an even bigger one soon.'", setState: { hasRing: false }, choices: [{ text: "So, about this work tea...", nextId: 2001 }] },
                
                // Post-Date
                { id: 3000, text: "You walk out to their car, but as you approach, you both see it: the rear passenger-side tire is completely, hopelessly flat. 'You've got to be kidding me,' they groan.", choices: [{ text: "Well, looks like you're riding with me.", nextId: 3001 }] },
                { id: 3001, text: "The mood is set as you drive. The city lights blur past...", choices: [{ text: "Let's go inside.", nextId: 4000 }] }, // Simplified for brevity

                // Getting Ready for Date
                { id: 7000, text: "Time to get ready for your date.", routeBy: 'gender', routes: { male: 7001, female: 7010 } },
                { id: 7001, text: "You get home with plenty of time to get ready. First things first, time to clean up.", choices: [{ text: "Take a quick shower.", nextId: 7002 }, { text: "Nah, a little deodorant will do.", nextId: 7002 }] },
                { id: 7002, text: "You look in the mirror. Your facial hair is a little scruffy.", choices: [{ text: "Shave it clean.", nextId: 7003 }, { text: "Leave the whiskers. It's a look.", nextId: 7003 }] },
                { id: 7003, text: "Time for cologne. What's the vibe tonight?", choices: [{ text: "A heavy, musky cologne.", nextId: 7004 }, { text: "A light, fresh cologne.", nextId: 7004 }] },
                { id: 7004, text: "Now for the outfit. You want to look good tonight.", choices: [{ text: "Wear a black polo shirt and grey pants.", nextId: 7100 }, { text: "Wear a long sleeve light grey sweater and tan pants.", nextId: 7100 }, { text: "Wear a black t-shirt with a nice jacket and grey pants.", nextId: 7100 }] },
                { id: 7010, text: "You get home with plenty of time. A little pampering is in order before your date.", choices: [{ text: "Take a long, relaxing shower.", nextId: 7011 }, { text: "Just a quick touch-up is fine.", nextId: 7011 }] },
                { id: 7011, text: "You stand in front of your huge perfume collection. What's the scent for tonight?", choices: [{ text: "A light and balanced perfume.", nextId: 7012 }, { text: "A deep floral scent.", nextId: 7012 }, { text: "A spicy and sweet perfume.", nextId: 7012 }] },
                { id: 7012, text: "Perfect. Now for the killer outfit.", choices: [{ text: "The silk slip dress in deep emerald.", nextId: 7110 }, { text: "The bright pink mini dress.", nextId: 7110 }, { text: "The high-waisted leather skirt with a satin blouse.", nextId: 7110 }] },
                { id: 7050, text: "You head out for your date, feeling excited.", routeBy: 'dateLocation', routes: { maggianos: 900, cheesecake: 322, hotpot: 312 } },
                { id: 7100, text: "You're dressed and about to head out when your phone buzzes. It's a text from your friend Aaron in the group chat: 'Boys, me and Ian just shot -4 and -5 at the outing today. We're basically pros.'", choices: [{ text: "Damn boys that's legit", nextId: 7200 }, { text: "Send a GIF of Tim Robinson squinting.", nextId: 7200 }, { text: "I figured you boys would be in the sub 6's like me in no time.", nextId: 7200 }] },
                { id: 7110, text: "You're dressed and look amazing. As you're about to grab your purse, your phone buzzes. It's a text from your friend Tammy in the group chat: 'omg you will never beleive what tyler got me, a great dane puppy!'", choices: [{ text: "oh wow how cute, whats the name?", nextId: 7111 }, { text: "those dogs get huge, you live in a studio", nextId: 7111 }, { text: "thats great haha", nextId: 7111 }] },
                { id: 7111, text: "You reply to the text, a smile on your face. One last check. Any accessories?", choices: [{ text: "Put on the ring your boyfriend gave you.", nextId: 7112 }, { text: "No, this is perfect.", nextId: 7200 }] },
                { id: 7112, text: "You slip on the beautiful ring. It sparkles on your finger.", setState: { hasRing: true }, choices: [{ text: "Okay, now you're ready.", nextId: 7200 }] },
                { id: 7200, text: "You're all ready to go. You grab your keys and wallet and head out the door.", choices: [{ text: "Head to the date.", nextId: 7050 }] },
                
                // Endings and other paths
                { id: 4000, text: "You unlock the door and step inside. As the door clicks shut, you turn to each other...", choices: [{ text: "The night fades away...", nextId: 6000 }] },
                { id: 6000, text: "You wake up late the next morning, the sun streaming through the blinds. Last night was amazing. You feel a deep sense of peace and happiness.", choices: [{ text: "A perfect end to a wild day.", nextId: 1205 }] },
                { id: 1205, text: "This single day has changed your life forever. THE END.", choices: [{ text: "Play Again", nextId: 1 }] }
            ];
            
            // --- GAME STATE ---
            let gameState = {
                currentUser: '',
                playerGender: '',
                playerState: {},
            };

            const defaultPlayerState = { 
                hasKey: false, hasCoins: false, wearsHawaiianShirt: false, hasGlock: false, hasCarInfo: false,
                giftCard: false, tirePlugs: false, gum: false, cones: false, bluntWrap: false, candy: false,
                lotteryTicket: false, bossMug: false, stevesCard: false, embarrassingPhoto: false, heardGossip: false,
                fiveDollars: false, silverDollar: false, oldCasinoChip: false, guitarPick: false, silverLocket: false, pocketKnife: false,
                hasRing: false, usedBathroom: false, dateLocation: null
             };
             
             // --- CORE GAME LOGIC ---

            /**
             * Applies a color theme to the entire UI.
             * @param {string} themeName - The name of the theme to apply.
             */
            function applyTheme(themeName) {
                const theme = themes[themeName] || themes.default;
                const allThemeClasses = [...new Set(Object.values(themes).flatMap(t => Object.values(t)).join(' ').split(' '))];

                const applyClasses = (element, classList) => {
                    if (!element) return;
                    element.classList.remove(...allThemeClasses);
                    element.classList.add(...classList.split(' '));
                };

                applyClasses(document.body, `${theme.bg} ${theme.text}`);
                document.querySelectorAll('.themed-container').forEach(el => applyClasses(el, theme.container));
                document.querySelectorAll('.themed-text').forEach(el => applyClasses(el, theme.text));
                document.querySelectorAll('.themed-subtle-text').forEach(el => applyClasses(el, theme.subtleText));
                document.querySelectorAll('.themed-primary-btn').forEach(el => applyClasses(el, theme.primaryBtn));
                document.querySelectorAll('.themed-input').forEach(el => applyClasses(el, theme.input));
                document.querySelectorAll('.themed-border').forEach(el => applyClasses(el, theme.border));
                
                if (elements.choicesContainerElement) {
                    elements.choicesContainerElement.dataset.secondaryBtnClass = theme.secondaryBtn;
                }
            }

            /**
             * Updates the inventory display based on the current player state.
             */
            function updateInventoryDisplay() {
                if (!elements.inventoryList) return;
                elements.inventoryList.innerHTML = '';
                const itemsMap = {
                    hasKey: "Small Ornate Key", hasCoins: "8 Gold Coins", lotteryTicket: "Winning Lottery Ticket ($100)",
                    bossMug: "Chipped 'World's Best Boss' Mug", stevesCard: "Steve's Business Card", hasCarInfo: "Note with Phone # (Corvette)",
                    hasGlock: "Gold 9mm Glock", giftCard: "Starbucks Gift Card", tirePlugs: "Tire Plug Kit", gum: "Pack of Gum",
                    cones: "Raw Cones", bluntWrap: "Blunt Wrap", candy: "Partner's Favorite Candy", embarrassingPhoto: "Embarrassing High School Photo",
                    fiveDollars: "$5 Bill", silverDollar: "Old Silver Dollar", oldCasinoChip: "Old Casino Chip",
                    guitarPick: "Worn Guitar Pick", silverLocket: "Silver Locket", pocketKnife: "Classic Pocket Knife", hasRing: "Boyfriend's Ring"
                };

                const items = Object.keys(gameState.playerState)
                    .filter(key => gameState.playerState[key] && itemsMap[key])
                    .map(key => itemsMap[key]);

                if (items.length > 0) {
                    elements.inventoryContainer.classList.remove('hidden');
                    items.forEach(itemText => {
                        const li = document.createElement('li');
                        li.textContent = itemText;
                        elements.inventoryList.appendChild(li);
                    });
                } else {
                    elements.inventoryContainer.classList.add('hidden');
                }
            }
            
            /**
             * Main function to display a story node and its choices.
             * @param {number} nodeId - The ID of the story node to display.
             */
            function showStoryNode(nodeId) {
                let currentNode = story.find(node => node.id === nodeId);

                if (!currentNode) {
                    console.error(`Story node with id ${nodeId} not found! Resetting.`);
                    return showStoryNode(1);
                }

                if (currentNode.routeBy) {
                    const routeValue = gameState.playerState[currentNode.routeBy] || gameState[currentNode.routeBy];
                    const nextNodeId = currentNode.routes[routeValue];
                    if (nextNodeId !== undefined) {
                        return showStoryNode(nextNodeId);
                    } else {
                         console.error(`Invalid route for node ${nodeId} with value ${routeValue}`);
                         return showStoryNode(1);
                    }
                }

                if (currentNode.setState) {
                    Object.assign(gameState.playerState, currentNode.setState);
                }
                
                const textToDisplay = (gameState.playerGender === 'female' && currentNode.textFemale)
                    ? currentNode.textFemale
                    : currentNode.text;

                elements.storyTextElement.classList.remove('fade-in');
                void elements.storyTextElement.offsetWidth;
                elements.storyTextElement.innerText = textToDisplay;
                elements.storyTextElement.classList.add('fade-in');
                
                elements.choicesContainerElement.innerHTML = '';
                
                const availableChoices = currentNode.choices.filter(choice => {
                    if (!choice.condition) return true;
                    
                    let stateConditionMet = true;
                    if (choice.condition.state) {
                        const stateKey = choice.condition.state;
                        if (stateKey.startsWith('!')) {
                            stateConditionMet = !gameState.playerState[stateKey.substring(1)];
                        } else {
                            stateConditionMet = gameState.playerState[stateKey];
                        }
                    }

                    const genderConditionMet = !choice.condition.gender || gameState.playerGender === choice.condition.gender;

                    return stateConditionMet && genderConditionMet;
                });

                availableChoices.forEach(choice => {
                    const button = document.createElement('button');
                    const choiceText = (gameState.playerGender === 'female' && choice.textFemale) ? choice.textFemale : choice.text;
                    
                    button.innerText = choiceText;
                    const secondaryBtnClasses = elements.choicesContainerElement.dataset.secondaryBtnClass || themes.default.secondaryBtn;
                    button.className = `w-full text-white font-semibold py-3 px-4 rounded-lg shadow-md transition-all duration-300 ease-in-out transform hover:scale-105 fade-in ${secondaryBtnClasses}`;
                    
                    button.addEventListener('click', () => {
                        saveProgress(choice.nextId);
                        showStoryNode(choice.nextId);
                    });
                    elements.choicesContainerElement.appendChild(button);
                });
                
                updateInventoryDisplay();
            }

            /**
             * Handles starting the game after a user provides their name.
             */
            function startGame() {
                const username = elements.usernameInput.value.trim();
                if (!username) {
                    elements.usernameInput.placeholder = "Please enter a name!";
                    elements.usernameInput.classList.add('placeholder-red-400', 'ring-2', 'ring-red-500');
                    return;
                }
                gameState.currentUser = username;
                elements.playerNameElement.innerText = gameState.currentUser;

                const savedData = loadProgress();
                if (savedData && savedData.nodeId) {
                    gameState.playerGender = savedData.gender;
                    gameState.playerState = { ...defaultPlayerState, ...savedData.state };
                    elements.welcomeScreen.classList.add('hidden');
                    elements.gameContainer.classList.remove('hidden', 'fade-in');
                    void elements.gameContainer.offsetWidth;
                    elements.gameContainer.classList.add('fade-in');
                    showStoryNode(savedData.nodeId);
                } else {
                    elements.usernameInput.classList.add('hidden');
                    elements.startButton.classList.add('hidden');
                    elements.welcomeScreen.querySelector('.themed-subtle-text').innerText = `Welcome, ${gameState.currentUser}. Select your character.`;
                    elements.genderSelectionContainer.classList.remove('hidden');
                }
            }

            /**
             * Sets the player's gender and begins a new adventure.
             * @param {string} gender - 'male' or 'female'.
             */
            function setGenderAndStart(gender) {
                gameState.playerGender = gender;
                gameState.playerState = { ...defaultPlayerState };
                elements.welcomeScreen.classList.add('hidden');
                elements.gameContainer.classList.remove('hidden', 'fade-in');
                void elements.gameContainer.offsetWidth;
                elements.gameContainer.classList.add('fade-in');
                saveProgress(1);
                showStoryNode(1);
            }

            // --- LOCAL STORAGE ---
            function saveProgress(nodeId) {
                try {
                    const allProgress = JSON.parse(localStorage.getItem('adventureGameProgress')) || {};
                    allProgress[gameState.currentUser] = { nodeId, gender: gameState.playerGender, state: gameState.playerState };
                    localStorage.setItem('adventureGameProgress', JSON.stringify(allProgress));
                } catch (e) {
                    console.error("Could not save progress:", e);
                }
            }

            function loadProgress() {
                try {
                    const allProgress = JSON.parse(localStorage.getItem('adventureGameProgress')) || {};
                    return allProgress[gameState.currentUser];
                } catch (e) {
                    console.error("Could not load progress:", e);
                    return null;
                }
            }
            
            // --- INITIALIZATION & EVENT LISTENERS ---
            
            const savedTheme = localStorage.getItem('adventureGameTheme');
            if (savedTheme) {
                applyTheme(savedTheme);
                elements.welcomeScreen.classList.remove('hidden');
            } else {
                elements.colorSelectionScreen.classList.remove('hidden');
            }

            document.querySelectorAll('.theme-btn').forEach(button => {
                button.addEventListener('click', () => {
                    const themeName = button.dataset.theme;
                    localStorage.setItem('adventureGameTheme', themeName);
                    applyTheme(themeName);
                    elements.colorSelectionScreen.classList.add('hidden');
                    elements.welcomeScreen.classList.remove('hidden', 'fade-in');
                    void elements.welcomeScreen.offsetWidth;
                    elements.welcomeScreen.classList.add('fade-in');
                });
            });

            elements.startButton.addEventListener('click', startGame);
            elements.usernameInput.addEventListener('keyup', e => e.key === 'Enter' && startGame());
            elements.maleButton.addEventListener('click', () => setGenderAndStart('male'));
            elements.femaleButton.addEventListener('click', () => setGenderAndStart('female'));

            elements.resetButton.addEventListener('click', () => {
                localStorage.removeItem('adventureGameProgress');
                localStorage.removeItem('adventureGameTheme');
                window.location.reload();
            });
        });
    </script>
</body>
</html>

