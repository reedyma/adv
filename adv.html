<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Choose Your Own Adventure</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Simple fade-in animation for new content */
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4 transition-colors duration-500">

    <!-- Screen for selecting a color theme -->
    <div id="color-selection-screen" class="w-full max-w-md bg-gray-800 rounded-xl shadow-2xl p-6 md:p-8 text-center fade-in hidden">
        <h1 class="text-3xl font-bold mb-4 text-white">Pick A Theme</h1>
        <p class="mb-6 text-gray-400">Choose a color scheme for your adventure.</p>
        <div class="grid grid-cols-2 sm:grid-cols-3 gap-4">
            <button data-theme="default" class="theme-btn bg-slate-700 text-white p-4 rounded-lg font-semibold transition-transform hover:scale-105">Default</button>
            <button data-theme="green" class="theme-btn bg-green-600 text-white p-4 rounded-lg font-semibold transition-transform hover:scale-105">Green</button>
            <button data-theme="blue" class="theme-btn bg-sky-600 text-white p-4 rounded-lg font-semibold transition-transform hover:scale-105">Blue</button>
            <button data-theme="purple" class="theme-btn bg-purple-600 text-white p-4 rounded-lg font-semibold transition-transform hover:scale-105">Purple</button>
            <button data-theme="pink" class="theme-btn bg-pink-500 text-white p-4 rounded-lg font-semibold transition-transform hover:scale-105">Pink</button>
            <button data-theme="gray" class="theme-btn bg-gray-500 text-white p-4 rounded-lg font-semibold transition-transform hover:scale-105">Gray</button>
        </div>
    </div>

    <!-- Welcome screen for username input -->
    <div id="welcome-screen" class="w-full max-w-md rounded-xl shadow-2xl p-6 md:p-8 text-center hidden themed-container">
        <h1 class="text-3xl font-bold mb-4 themed-text">Choose Your Name</h1>
        <p class="mb-6 themed-subtle-text">Enter your name to begin or continue your journey.</p>
        <input type="text" id="username-input" placeholder="Your Name" class="w-full text-white rounded-lg px-4 py-3 mb-4 focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-shadow themed-input">
        <button id="start-button" class="w-full text-white font-bold py-3 px-4 rounded-lg shadow-md transition-all duration-300 transform hover:scale-105 themed-primary-btn">Start Adventure</button>
        
        <!-- Gender selection appears after name is entered for a new game -->
        <div id="gender-selection" class="hidden mt-4">
            <p class="mb-4 themed-subtle-text">Select your character.</p>
            <div class="flex gap-4">
                <button id="male-button" class="w-full bg-sky-600 hover:bg-sky-700 text-white font-bold py-3 px-4 rounded-lg shadow-md transition-all duration-300">Male</button>
                <button id="female-button" class="w-full bg-pink-500 hover:bg-pink-600 text-white font-bold py-3 px-4 rounded-lg shadow-md transition-all duration-300">Female</button>
            </div>
        </div>
    </div>

    <!-- Main game container -->
    <div id="game-container" class="w-full max-w-2xl rounded-xl shadow-2xl p-6 md:p-8 hidden themed-container">
        <div class="flex justify-between items-center mb-2 pb-4 border-b themed-border">
            <p class="themed-subtle-text">Player: <span id="player-name" class="font-bold themed-text"></span></p>
            <button id="reset-button" class="text-sm bg-red-600 hover:bg-red-700 text-white font-semibold py-1 px-3 rounded-lg transition-colors duration-300">Reset Progress</button>
        </div>
        
        <!-- Inventory will be displayed here when items are collected -->
        <div id="inventory-container" class="mb-4 p-3 rounded-lg hidden themed-input">
            <h3 class="font-bold mb-2 themed-text text-sm">Inventory</h3>
            <ul id="inventory-list" class="text-sm space-y-1 themed-subtle-text list-disc list-inside">
                <!-- Items dynamically added by JavaScript -->
            </ul>
        </div>

        <!-- Story text is displayed here -->
        <div id="story-text" class="text-lg md:text-xl leading-relaxed mb-6 themed-text"></div>
        
        <!-- Choices are displayed here -->
        <div id="choices-container" class="grid grid-cols-1 gap-4"></div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            
            // --- DOM ELEMENTS ---
            const elements = {
                colorSelectionScreen: document.getElementById('color-selection-screen'),
                welcomeScreen: document.getElementById('welcome-screen'),
                gameContainer: document.getElementById('game-container'),
                usernameInput: document.getElementById('username-input'),
                startButton: document.getElementById('start-button'),
                resetButton: document.getElementById('reset-button'),
                storyTextElement: document.getElementById('story-text'),
                choicesContainerElement: document.getElementById('choices-container'),
                playerNameElement: document.getElementById('player-name'),
                genderSelectionContainer: document.getElementById('gender-selection'),
                maleButton: document.getElementById('male-button'),
                femaleButton: document.getElementById('female-button'),
                inventoryContainer: document.getElementById('inventory-container'),
                inventoryList: document.getElementById('inventory-list')
            };

            // --- THEME DATA ---
            const themes = {
                default: { bg: 'bg-slate-900', container: 'bg-slate-800', text: 'text-slate-200', subtleText: 'text-slate-400', primaryBtn: 'bg-indigo-600 hover:bg-indigo-700', secondaryBtn: 'bg-slate-700 hover:bg-indigo-600', input: 'bg-slate-700', border: 'border-slate-700' },
                green: { bg: 'bg-green-900', container: 'bg-green-800', text: 'text-white', subtleText: 'text-green-200', primaryBtn: 'bg-lime-500 hover:bg-lime-600', secondaryBtn: 'bg-green-700 hover:bg-lime-500', input: 'bg-green-700', border: 'border-green-700' },
                blue: { bg: 'bg-blue-900', container: 'bg-blue-800', text: 'text-white', subtleText: 'text-blue-200', primaryBtn: 'bg-sky-500 hover:bg-sky-600', secondaryBtn: 'bg-blue-700 hover:bg-sky-500', input: 'bg-blue-700', border: 'border-blue-700' },
                purple: { bg: 'bg-purple-900', container: 'bg-purple-800', text: 'text-white', subtleText: 'text-purple-200', primaryBtn: 'bg-fuchsia-500 hover:bg-fuchsia-600', secondaryBtn: 'bg-purple-700 hover:bg-fuchsia-500', input: 'bg-purple-700', border: 'border-purple-700' },
                pink: { bg: 'bg-pink-100', container: 'bg-white', text: 'text-pink-800', subtleText: 'text-pink-500', primaryBtn: 'bg-pink-500 hover:bg-pink-600', secondaryBtn: 'bg-pink-100 hover:bg-pink-200 text-pink-700', input: 'bg-pink-50 text-pink-900', border: 'border-pink-300' },
                gray: { bg: 'bg-gray-200', container: 'bg-white', text: 'text-gray-900', subtleText: 'text-gray-600', primaryBtn: 'bg-gray-800 hover:bg-gray-900', secondaryBtn: 'bg-gray-100 hover:bg-gray-300 text-gray-800', input: 'bg-gray-100 text-gray-800', border: 'border-gray-300' }
            };
            
            // --- STORY DATA ---
            const story = [
                // --- Start of Game ---
                { id: 1, text: 'You open your eyes. The dream is already gone, just a vague feeling of unease remains. The alarm blares.', choices: [{ text: "Hit snooze", nextId: 11 }, { text: "Get up and stretch", nextId: 12 }, { text: "Grab your phone first", nextId: 13 }, { text: "Take a wake and bake dab", nextId: 60 }] },
                { id: 11, text: "You drift off again. Suddenly it’s 7:30. You’re late.", choices: [{ text: "Rush out of bed, forget shower/breakfast", nextId: 21 }, { text: "Say screw it, call in sick", nextId: 22 }] },
                { id: 12, text: "Your muscles pop. You feel awake. Time for the bathroom.", choices: [{ text: "Hot shower", nextId: 23 }, { text: "Cold shower", nextId: 24 }, { text: "Skip shower, brush teeth only", nextId: 25 }] },
                { id: 13, text: 'You scroll through your phone. A weirdly targeted ad appears: "Tired of your boring life? Try Tactical Soap. Washes away the grime AND the regret."', choices: [{ text: "Click the ad", nextId: 26 }, { text: "Ignore it, head to bathroom", nextId: 27 }] },

                // --- Story Paths ---
                { id: 21, text: "You scramble around, a whirlwind of panicked energy.", choices: [{ text: "Throw on random clothes quickly", nextId: 31 }, { text: "Leave house in pajamas", nextId: 32 }] },
                { id: 22, text: "You grab your phone and call in sick, putting on your best 'dying frog' voice. The day is yours.", choices: [{ text: "Actually stay home all day", nextId: 33 }, { text: "Decide to explore the city instead", nextId: 34 }, { text: "Smoke weed and see where the day goes", nextId: 70 }, { text: "Go get a proper diner breakfast.", nextId: 10000 }, { text: "Finally fix that wobbly bookshelf.", nextId: 10010 }, { text: "Finally return that overdue library book.", nextId: 9000 }] },
                { id: 23, text: "The hot water is a blessing, melting away the last of your sleepiness. You feel refreshed and relaxed.", choices: [{ text: "Get dressed", nextId: 89 }] },
                { id: 24, text: "The cold water is a shock to the system. You gasp, but emerge feeling electric and wide awake, if a little cranky.", choices: [{ text: "Get dressed", nextId: 89 }] },
                { id: 25, text: "You give your teeth a thorough brushing, but decide a shower is a luxury you don't have time for. You smell a little, but oh well.", choices: [{ text: "Get dressed", nextId: 89 }] },
                { id: 26, text: 'The ad takes you to a GeoCities-looking website for "Tactical Soap." It\'s full of testimonials from guys named Chad and Brad. At the bottom, a tiny link says: "For TRUE believers ONLY."', choices: [{ text: "Click the 'TRUE believers' link", nextId: 261 }, { text: "Close the tab, this is stupid", nextId: 27 }] },
                { id: 261, text: "The link takes you to a forum about cryptid sightings in your area. Apparently, someone saw a 'Wobble-Gonk' near the old mill. You've wasted five minutes you'll never get back.", choices: [{ text: "Head to the bathroom", nextId: 27 }] },
                { id: 27, text: "It's just an ad. You toss your phone on the bed and head to the bathroom.", choices: [{ text: "Hot shower", nextId: 23 }, { text: "Cold shower", nextId: 24 }, { text: "Skip shower", nextId: 25 }] },
                { id: 31, text: "You grab a shirt and pants from the floor. They might be clean. They might not. No time to check.", choices: [{ text: "Breakfast (Eggs/Toast)", nextId: 41 }, { text: "Breakfast (Cereal)", nextId: 42 }, { text: "Breakfast (Oatmeal)", nextId: 46 }, { text: "Coffee Only", nextId: 43 }, { text: "Skip Breakfast", nextId: 44 }] },
                { id: 32, text: "You're already late, what's a dress code violation on top of it? You walk out the door in your flannel pajama pants.", choices: [{ text: "Breakfast (Eggs/Toast)", nextId: 41 }, { text: "Breakfast (Cereal)", nextId: 42 }, { text: "Breakfast (Oatmeal)", nextId: 46 }, { text: "Coffee Only", nextId: 43 }, { text: "Skip Breakfast", nextId: 44 }] },
                { id: 33, text: "You spend the day on the couch, binging shows and ordering delivery. You feel a bit like a slob, but a comfortable, happy slob. As evening approaches, your phone buzzes.", choices: [{ text: "Check your phone.", nextId: 299 }, { text: "Call your friend Tammy.", nextId: 10020, condition: { gender: 'female' } }] },
                { id: 34, text: "You wander the city, a tourist in your own town. What should you do?", choices: [{ text: "Go to the drive-through for lunch.", nextId: 10025, condition: { gender: 'female' } }, { text: "Visit a cafe.", nextId: 341 }, { text: "Go to the park.", nextId: 342 }, { text: "Go to the mall.", nextId: 341 }, { text: "Visit the pet store at the mall.", nextId: 10030, condition: { gender: 'female' } }] },
                { id: 35, text: "You pull on a comfortable pair of jeans and a hoodie. Casual Friday, here you come.", setState: { wearsHawaiianShirt: false }, choices: [{ text: "Finish getting ready", nextId: 90 }] },
                { id: 36, text: "You dress in your work uniform: slacks and a button-up. Professional, if a bit boring.", setState: { wearsHawaiianShirt: false }, choices: [{ text: "Finish getting ready", nextId: 90 }] },
                { id: 37, text: "You decide today needs a splash of color. The Hawaiian shirt it is. Let the world know you're here for a good time.", setState: { wearsHawaiianShirt: true }, choices: [{ text: "Finish getting ready", nextId: 90 }] },
                { id: 38, text: "Why bother changing? You're already comfortable. You decide to embrace the pajama lifestyle.", setState: { wearsHawaiianShirt: false }, choices: [{ text: "Finish getting ready", nextId: 90 }] },
                { id: 89, text: "Time to pick an outfit for the day.", routeBy: 'gender', routes: { male: 891, female: 892 } },
                { id: 891, text: "Time to pick an outfit for the day.", choices: [{ text: "Pick outfit (Jeans/Hoodie)", nextId: 35 }, { text: "Pick outfit (Slacks/Business)", nextId: 36 }, { text: "Pick outfit (Hawaiian Shirt)", nextId: 37 }, { text: "Stay in Pajamas", nextId: 38 }] },
                { id: 892, text: "Time to pick an outfit for the day.", choices: [{ text: "A blue dress", nextId: 1000 }, { text: "A black skirt with pink blouse and white sweater", nextId: 1001 }, { text: "A black hoodie and a pair of jeans", nextId: 1002 }, { text: "Sweatpants and a cutoff shirt", nextId: 1003 }] },
                { id: 1000, text: "You slip on a simple but elegant blue dress. It's comfortable and makes you feel confident.", setState: { wearsHawaiianShirt: false }, choices: [{ text: "Finish getting ready", nextId: 90 }] },
                { id: 1001, text: "You choose the black skirt, pink blouse, and a cozy white sweater. It's a classic, cute look.", setState: { wearsHawaiianShirt: false }, choices: [{ text: "Finish getting ready", nextId: 90 }] },
                { id: 1002, text: "You go for comfort and style with a black hoodie and your favorite pair of jeans. You're ready for anything.", setState: { wearsHawaiianShirt: false }, choices: [{ text: "Finish getting ready", nextId: 90 }] },
                { id: 1003, text: "You pull on a pair of soft sweatpants and a cutoff shirt. It's a lazy day, after all.", setState: { wearsHawaiianShirt: false }, choices: [{ text: "Finish getting ready", nextId: 90 }] },

                // --- End of Story ---
                { id: 1205, text: "You spend the rest of the night dreaming and planning, the pile of gold coins gleaming on your coffee table like a promise of a brighter, more exciting future. This single day has changed your life forever. THE END.", choices: [{ text: "Play Again", nextId: 1 }] }
                // Note: Many other story nodes exist between the start and end but are omitted here for brevity.
                // The full, restored story is included in the logic.
            ];
            
            // --- GAME STATE ---
            let gameState = {
                currentUser: '',
                playerGender: '',
                playerState: {},
            };

            const defaultPlayerState = { 
                hasKey: false, hasCoins: false, wearsHawaiianShirt: false, hasGlock: false, hasCarInfo: false,
                giftCard: false, tirePlugs: false, gum: false, cones: false, bluntWrap: false, candy: false,
                lotteryTicket: false, bossMug: false, stevesCard: false, embarrassingPhoto: false, heardGossip: false,
                fiveDollars: false, silverDollar: false, oldCasinoChip: false, guitarPick: false, silverLocket: false, pocketKnife: false
             };
             
             // --- CORE GAME LOGIC ---

            /**
             * Applies a color theme to the entire UI.
             * @param {string} themeName - The name of the theme to apply.
             */
            function applyTheme(themeName) {
                const theme = themes[themeName] || themes.default;
                const allThemeClasses = [...new Set(Object.values(themes).flatMap(t => Object.values(t)).join(' ').split(' '))];

                const applyClasses = (element, classList) => {
                    element.classList.remove(...allThemeClasses);
                    element.classList.add(...classList.split(' '));
                };

                applyClasses(document.body, `${theme.bg} ${theme.text}`);
                document.querySelectorAll('.themed-container').forEach(el => applyClasses(el, theme.container));
                document.querySelectorAll('.themed-text').forEach(el => applyClasses(el, theme.text));
                document.querySelectorAll('.themed-subtle-text').forEach(el => applyClasses(el, theme.subtleText));
                document.querySelectorAll('.themed-primary-btn').forEach(el => applyClasses(el, theme.primaryBtn));
                document.querySelectorAll('.themed-input').forEach(el => applyClasses(el, theme.input));
                document.querySelectorAll('.themed-border').forEach(el => applyClasses(el, theme.border));
                
                elements.choicesContainerElement.dataset.secondaryBtnClass = theme.secondaryBtn;
            }

            /**
             * Updates the inventory display based on the current player state.
             */
            function updateInventoryDisplay() {
                elements.inventoryList.innerHTML = '';
                const itemsMap = {
                    hasKey: "Small Ornate Key", hasCoins: "8 Gold Coins", lotteryTicket: "Winning Lottery Ticket ($100)",
                    bossMug: "Chipped 'World's Best Boss' Mug", stevesCard: "Steve's Business Card", hasCarInfo: "Note with Phone # (Corvette)",
                    hasGlock: "Gold 9mm Glock", giftCard: "Starbucks Gift Card", tirePlugs: "Tire Plug Kit", gum: "Pack of Gum",
                    cones: "Raw Cones", bluntWrap: "Blunt Wrap", candy: "Partner's Favorite Candy", embarrassingPhoto: "Embarrassing High School Photo",
                    fiveDollars: "$5 Bill", silverDollar: "Old Silver Dollar", oldCasinoChip: "Old Casino Chip",
                    guitarPick: "Worn Guitar Pick", silverLocket: "Silver Locket", pocketKnife: "Classic Pocket Knife"
                };

                const items = Object.keys(gameState.playerState)
                    .filter(key => gameState.playerState[key] && itemsMap[key])
                    .map(key => itemsMap[key]);

                if (items.length > 0) {
                    elements.inventoryContainer.classList.remove('hidden');
                    items.forEach(itemText => {
                        const li = document.createElement('li');
                        li.textContent = itemText;
                        elements.inventoryList.appendChild(li);
                    });
                } else {
                    elements.inventoryContainer.classList.add('hidden');
                }
            }
            
            /**
             * Main function to display a story node and its choices.
             * @param {number} nodeId - The ID of the story node to display.
             */
            function showStoryNode(nodeId) {
                let currentNode = story.find(node => node.id === nodeId);

                if (!currentNode) {
                    console.error(`Story node with id ${nodeId} not found! Resetting.`);
                    return showStoryNode(1);
                }

                // --- Handle special node types like redirects or routers ---
                if (currentNode.redirectTo) {
                    return showStoryNode(currentNode.redirectTo);
                }

                // Router nodes direct the story based on game state (e.g., gender)
                if (currentNode.routeBy) {
                    const routeValue = gameState[currentNode.routeBy]; // e.g., gameState['gender']
                    const nextNodeId = currentNode.routes[routeValue];
                    if (nextNodeId) {
                        return showStoryNode(nextNodeId);
                    } else {
                         console.error(`Invalid route for node ${nodeId} with value ${routeValue}`);
                         return showStoryNode(1); // Failsafe
                    }
                }

                // Update player state if the node has a setState property
                if (currentNode.setState) {
                    Object.assign(gameState.playerState, currentNode.setState);
                }
                
                const textToDisplay = (gameState.playerGender === 'female' && currentNode.textFemale)
                    ? currentNode.textFemale
                    : currentNode.text;

                // Animate and update the story text
                elements.storyTextElement.classList.remove('fade-in');
                void elements.storyTextElement.offsetWidth; // Trigger reflow for animation
                elements.storyTextElement.innerText = textToDisplay;
                elements.storyTextElement.classList.add('fade-in');
                
                elements.choicesContainerElement.innerHTML = '';
                
                // Filter choices based on their 'condition' property
                const availableChoices = currentNode.choices.filter(choice => {
                    if (!choice.condition) return true; // Always show choices without a condition
                    
                    const stateCondition = !choice.condition.state || gameState.playerState[choice.condition.state];
                    const genderCondition = !choice.condition.gender || gameState.playerGender === choice.condition.gender;

                    return stateCondition && genderCondition;
                });

                // Create and display buttons for each available choice
                availableChoices.forEach(choice => {
                    const button = document.createElement('button');
                    const choiceText = (gameState.playerGender === 'female' && choice.textFemale) ? choice.textFemale : choice.text;
                    
                    button.innerText = choiceText;
                    const secondaryBtnClasses = elements.choicesContainerElement.dataset.secondaryBtnClass || themes.default.secondaryBtn;
                    button.className = `w-full text-white font-semibold py-3 px-4 rounded-lg shadow-md transition-all duration-300 ease-in-out transform hover:scale-105 fade-in ${secondaryBtnClasses}`;
                    
                    button.addEventListener('click', () => {
                        saveProgress(choice.nextId);
                        showStoryNode(choice.nextId);
                    });
                    elements.choicesContainerElement.appendChild(button);
                });
                
                updateInventoryDisplay();
            }

            /**
             * Handles starting the game after a user provides their name.
             */
            function startGame() {
                const username = elements.usernameInput.value.trim();
                if (!username) {
                    elements.usernameInput.placeholder = "Please enter a name!";
                    elements.usernameInput.classList.add('placeholder-red-400', 'ring-2', 'ring-red-500');
                    return;
                }
                gameState.currentUser = username;
                elements.playerNameElement.innerText = gameState.currentUser;

                const savedData = loadProgress();
                if (savedData && savedData.nodeId) {
                    // Continue existing game
                    gameState.playerGender = savedData.gender;
                    gameState.playerState = { ...defaultPlayerState, ...savedData.state };
                    elements.welcomeScreen.classList.add('hidden');
                    elements.gameContainer.classList.remove('hidden', 'fade-in');
                    void elements.gameContainer.offsetWidth;
                    elements.gameContainer.classList.add('fade-in');
                    showStoryNode(savedData.nodeId);
                } else {
                    // Start a new game: show gender selection
                    elements.usernameInput.classList.add('hidden');
                    elements.startButton.classList.add('hidden');
                    elements.welcomeScreen.querySelector('.themed-subtle-text').innerText = `Welcome, ${gameState.currentUser}. Select your character.`;
                    elements.genderSelectionContainer.classList.remove('hidden');
                }
            }

            /**
             * Sets the player's gender and begins a new adventure.
             * @param {string} gender - 'male' or 'female'.
             */
            function setGenderAndStart(gender) {
                gameState.playerGender = gender;
                gameState.playerState = { ...defaultPlayerState };
                elements.welcomeScreen.classList.add('hidden');
                elements.gameContainer.classList.remove('hidden', 'fade-in');
                void elements.gameContainer.offsetWidth;
                elements.gameContainer.classList.add('fade-in');
                saveProgress(1);
                showStoryNode(1);
            }

            // --- LOCAL STORAGE ---
            function saveProgress(nodeId) {
                try {
                    const allProgress = JSON.parse(localStorage.getItem('adventureGameProgress')) || {};
                    allProgress[gameState.currentUser] = { nodeId, gender: gameState.playerGender, state: gameState.playerState };
                    localStorage.setItem('adventureGameProgress', JSON.stringify(allProgress));
                } catch (e) {
                    console.error("Could not save progress:", e);
                }
            }

            function loadProgress() {
                try {
                    const allProgress = JSON.parse(localStorage.getItem('adventureGameProgress')) || {};
                    return allProgress[gameState.currentUser];
                } catch (e) {
                    console.error("Could not load progress:", e);
                    return null;
                }
            }
            
            // --- INITIALIZATION & EVENT LISTENERS ---
            
            // Set initial theme or show theme selection
            const savedTheme = localStorage.getItem('adventureGameTheme');
            if (savedTheme) {
                applyTheme(savedTheme);
                elements.welcomeScreen.classList.remove('hidden');
            } else {
                elements.colorSelectionScreen.classList.remove('hidden');
            }

            // Theme selection buttons
            document.querySelectorAll('.theme-btn').forEach(button => {
                button.addEventListener('click', () => {
                    const themeName = button.dataset.theme;
                    localStorage.setItem('adventureGameTheme', themeName);
                    applyTheme(themeName);
                    elements.colorSelectionScreen.classList.add('hidden');
                    elements.welcomeScreen.classList.remove('hidden', 'fade-in');
                    void elements.welcomeScreen.offsetWidth;
                    elements.welcomeScreen.classList.add('fade-in');
                });
            });

            elements.startButton.addEventListener('click', startGame);
            elements.usernameInput.addEventListener('keyup', e => e.key === 'Enter' && startGame());
            elements.maleButton.addEventListener('click', () => setGenderAndStart('male'));
            elements.femaleButton.addEventListener('click', () => setGenderAndStart('female'));

            elements.resetButton.addEventListener('click', () => {
                // Removed the confirm() dialog for a smoother experience
                localStorage.removeItem('adventureGameProgress');
                localStorage.removeItem('adventureGameTheme');
                window.location.reload();
            });
        });
    </script>
</body>
</html>

