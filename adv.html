<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Choose Your Own Adventure</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4 transition-colors duration-500">

    <div id="color-selection-screen" class="w-full max-w-md bg-gray-800 rounded-xl shadow-2xl p-6 md:p-8 text-center fade-in">
        <h1 class="text-3xl font-bold mb-4 text-white">Pick A Theme</h1>
        <p class="mb-6 text-gray-400">any theme</p>
        <div class="grid grid-cols-2 sm:grid-cols-3 gap-4">
            <button data-theme="default" class="theme-btn bg-slate-700 text-white p-4 rounded-lg font-semibold">Regular</button>
            <button data-theme="green" class="theme-btn bg-green-600 text-white p-4 rounded-lg font-semibold">Green</button>
            <button data-theme="blue" class="theme-btn bg-sky-600 text-white p-4 rounded-lg font-semibold">Blue</button>
            <button data-theme="purple" class="theme-btn bg-purple-600 text-white p-4 rounded-lg font-semibold">Purple</button>
            <button data-theme="pink" class="theme-btn bg-pink-500 text-white p-4 rounded-lg font-semibold">Pink</button>
            <button data-theme="gray" class="theme-btn bg-gray-500 text-white p-4 rounded-lg font-semibold">Gray</button>
        </div>
    </div>

    <div id="welcome-screen" class="w-full max-w-md rounded-xl shadow-2xl p-6 md:p-8 text-center hidden themed-container">
        <h1 class="text-3xl font-bold mb-4 themed-text">Choose Your Name</h1>
        <p class="mb-6 themed-subtle-text">Enter your name to begin or continue your journey.</p>
        <input type="text" id="username-input" placeholder="Your Name" class="w-full text-white rounded-lg px-4 py-3 mb-4 focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-shadow themed-input">
        <button id="start-button" class="w-full text-white font-bold py-3 px-4 rounded-lg shadow-md transition-all duration-300 transform hover:scale-105 themed-primary-btn">Start Adventure</button>
    
        <div id="gender-selection" class="hidden mt-4">
            <p class="mb-4 themed-subtle-text">Select your gender.</p>
            <div class="flex gap-4">
                <button id="male-button" class="w-full bg-sky-600 hover:bg-sky-700 text-white font-bold py-3 px-4 rounded-lg shadow-md transition-all duration-300">Male</button>
                <button id="female-button" class="w-full bg-pink-500 hover:bg-pink-600 text-white font-bold py-3 px-4 rounded-lg shadow-md transition-all duration-300">Female</button>
            </div>
        </div>
    </div>

    <div id="game-container" class="w-full max-w-2xl rounded-xl shadow-2xl p-6 md:p-8 hidden themed-container">
        <div class="flex justify-between items-center mb-2 pb-4 themed-border">
            <p class="themed-subtle-text">Player: <span id="player-name" class="font-bold themed-text"></span></p>
            <button id="reset-button" class="text-sm bg-red-600 hover:bg-red-700 text-white font-semibold py-1 px-3 rounded-lg transition-colors duration-300">Reset Progress</button>
        </div>
        
        <div id="inventory-container" class="mb-4 p-3 rounded-lg hidden themed-input">
            <h3 class="font-bold mb-2 themed-text text-sm">Inventory</h3>
            <ul id="inventory-list" class="text-sm space-y-1 themed-subtle-text list-disc list-inside">
                </ul>
        </div>

        <div id="story-text" class="text-lg md:text-xl leading-relaxed mb-6 themed-text"></div>
        
        <div id="choices-container" class="grid grid-cols-1 gap-4"></div>
    </div>

    <script>
        // --- STORY DATA ---
        const story = [
            // Morning Routine
            { id: 1, text: 'You open your eyes. The dream is already gone, just a vague feeling of unease remains. The alarm blares.', choices: [{ text: "Hit snooze", nextId: 11 }, { text: "Get up and stretch", nextId: 12 }, { text: "Grab your phone first", nextId: 13 }, { text: "Take a wake and bake dab", nextId: 60 }] },
            { id: 11, text: "You drift off again. Suddenly it’s 7:30. You’re late.", choices: [{ text: "Rush out of bed, forget shower/breakfast", nextId: 21 }, { text: "Say screw it, call in sick", nextId: 22 }] },
            { id: 12, text: "Your muscles pop. You feel awake. Time for the bathroom.", choices: [{ text: "Hot shower", nextId: 23 }, { text: "Cold shower", nextId: 24 }, { text: "Skip shower, brush teeth only", nextId: 25 }] },
            { id: 13, text: 'You scroll through your phone. A weirdly targeted ad appears: "Tired of your boring life? Try Tactical Soap. Washes away the grime AND the regret."', choices: [{ text: "Click the ad", nextId: 26 }, { text: "Ignore it, head to bathroom", nextId: 27 }] },
            
            // Late / Sick Path
            { id: 21, text: "You scramble around, a whirlwind of panicked energy.", choices: [{ text: "Throw on random clothes quickly", nextId: 31 }, { text: "Leave house in pajamas", nextId: 32 }] },
            { id: 22, text: "You grab your phone and call in sick, putting on your best 'dying frog' voice. The day is yours.", choices: [{ text: "Actually stay home all day", nextId: 33 }, { text: "Decide to explore the city instead", nextId: 34 }, { text: "Smoke weed and see where the day goes", nextId: 70 }, { text: "Go get a proper diner breakfast.", nextId: 10000 }, { text: "Finally fix that wobbly bookshelf.", nextId: 10010 }, { text: "Finally return that overdue library book.", nextId: 9000 }] },

            // Shower Path
            { id: 23, text: "The hot water is a blessing, melting away the last of your sleepiness. You feel refreshed and relaxed.", choices: [{ text: "Get dressed", nextId: 89 }] },
            { id: 24, text: "The cold water is a shock to the system. You gasp, but emerge feeling electric and wide awake, if a little cranky.", choices: [{ text: "Get dressed", nextId: 89 }] },
            { id: 25, text: "You give your teeth a thorough brushing, but decide a shower is a luxury you don't have time for. You smell a little, but oh well.", choices: [{ text: "Get dressed", nextId: 89 }] },

            // Ad Path
            { id: 26, text: 'The ad takes you to a GeoCities-looking website for "Tactical Soap." It\'s full of testimonials from guys named Chad and Brad. At the bottom, a tiny link says: "For TRUE believers ONLY."', choices: [{ text: "Click the 'TRUE believers' link", nextId: 261 }, { text: "Close the tab, this is stupid", nextId: 27 }] },
            { id: 261, text: "The link takes you to a forum about cryptid sightings in your area. Apparently, someone saw a 'Wobble-Gonk' near the old mill. You've wasted five minutes you'll never get back.", choices: [{ text: "Head to the bathroom", nextId: 27 }] },
            { id: 27, text: "It's just an ad. You toss your phone on the bed and head to the bathroom.", choices: [{ text: "Hot shower", nextId: 23 }, { text: "Cold shower", nextId: 24 }, { text: "Skip shower", nextId: 25 }] },

            // Outfit/Breakfast Path
            { id: 31, text: "You grab a shirt and pants from the floor. They might be clean. They might not. No time to check.", choices: [{ text: "Breakfast (Eggs/Toast)", nextId: 41 }, { text: "Breakfast (Cereal)", nextId: 42 }, { text: "Breakfast (Oatmeal)", nextId: 46 }, { text: "Coffee Only", nextId: 43 }, { text: "Skip Breakfast", nextId: 44 }] },
            { id: 32, text: "You're already late, what's a dress code violation on top of it? You walk out the door in your flannel pajama pants.", choices: [{ text: "Breakfast (Eggs/Toast)", nextId: 41 }, { text: "Breakfast (Cereal)", nextId: 42 }, { text: "Breakfast (Oatmeal)", nextId: 46 }, { text: "Coffee Only", nextId: 43 }, { text: "Skip Breakfast", nextId: 44 }] },
            { id: 35, text: "You pull on a comfortable pair of jeans and a hoodie. Casual Friday, here you come.", setState: { wearsHawaiianShirt: false }, choices: [{ text: "Finish getting ready", nextId: 90 }] },
            { id: 36, text: "You dress in your work uniform: slacks and a button-up. Professional, if a bit boring.", setState: { wearsHawaiianShirt: false }, choices: [{ text: "Finish getting ready", nextId: 90 }] },
            { id: 37, text: "You decide today needs a splash of color. The Hawaiian shirt it is. Let the world know you're here for a good time.", setState: { wearsHawaiianShirt: true }, choices: [{ text: "Finish getting ready", nextId: 90 }] },
            { id: 38, text: "Why bother changing? You're already comfortable. You decide to embrace the pajama lifestyle.", setState: { wearsHawaiianShirt: false }, choices: [{ text: "Finish getting ready", nextId: 90 }] },
            
            // Homebody / City Paths
            { id: 33, text: "You spend the day on the couch, binging shows and ordering delivery. You feel a bit like a slob, but a comfortable, happy slob. As evening approaches, your phone buzzes.", choices: [{ text: "Check your phone.", nextId: 299 }] },
            { id: 34, text: "You wander the city, a tourist in your own town. What should you do?", choices: [{ text: "Visit a cafe.", nextId: 341 }, { text: "Go to the park.", nextId: 342 }, { text: "Go to the mall.", nextId: 341 }] },
            { id: 341, text: "You spend a few hours at a cafe/mall, just people watching and enjoying the freedom. As the sun begins to set, your phone buzzes.", choices: [{ text: "Check your phone.", nextId: 299 }] },
            { id: 342, text: "You head to the local park. It's peaceful. You see a friendly-looking orange tabby cat sitting on a bench.", choices: [{ text: "Try to pet the cat.", nextId: 343 }, { text: "Leave it be and enjoy the quiet.", nextId: 341 }] },
            { id: 343, text: "You approach slowly and offer your hand. The cat purrs loudly and rubs against you before hopping off the bench. As it leaves, it nudges something shiny on the ground with its nose, looks back at you, and darts away. It's an old, heavy silver dollar.", setState: { silverDollar: true }, choices: [{ text: "What a strange cat. What a cool coin.", nextId: 341 }] },
            
            // Commute Path
            { id: 41, text: "You quickly whip up some eggs and toast. A solid breakfast.", choices: [{ text: "Commute (Drive)", nextId: 51 }, { text: "Commute (Bus)", nextId: 52 }, { text: "Smoke a bowl before you go", nextId: 80 }, { text: "Skip Work Last Minute", nextId: 54 }] },
            { id: 42, text: "You pour a bowl of cereal. It's fast and easy.", choices: [{ text: "Commute (Drive)", nextId: 51 }, { text: "Commute (Bus)", nextId: 52 }, { text: "Smoke a bowl before you go", nextId: 80 }, { text: "Skip Work Last Minute", nextId: 54 }] },
            { id: 43, text: "No time for food. You brew a strong cup of coffee and drink it black.", choices: [{ text: "Drink a second cup", nextId: 431 }, { text: "One is enough. Time to go.", nextId: 45 }] },
            { id: 44, text: "Your stomach rumbles, but you ignore it. Time is money.", choices: [{ text: "Commute (Drive)", nextId: 51 }, { text: "Commute (Bus)", nextId: 52 }, { text: "Smoke a bowl before you go", nextId: 80 }, { text: "Skip Work Last Minute", nextId: 54 }] },
            { id: 45, text: "Caffeine coursing through your veins, you head for the door.", choices: [{ text: "Commute (Drive)", nextId: 51 }, { text: "Commute (Bus)", nextId: 52 }, { text: "Smoke a bowl before you go", nextId: 80 }, { text: "Skip Work Last Minute", nextId: 54 }] },
            { id: 46, text: "You make a quick bowl of oatmeal. It's warm and filling.", choices: [{ text: "Commute (Drive)", nextId: 51 }, { text: "Commute (Bus)", nextId: 52 }, { text: "Smoke a bowl before you go", nextId: 80 }, { text: "Skip Work Last Minute", nextId: 54 }] },
            { id: 431, text: "The second cup makes your heart pound. You feel wired, a bit jittery, but immensely focused. The world seems to be moving in slow motion.", choices: [{ text: "Drink a third cup. Embrace the chaos.", nextId: 432 }, { text: "Okay, that's enough. Time to go.", nextId: 45 }] },
            { id: 432, text: "You down the third cup. Your hands are shaking, and you can hear your own heartbeat. You are a being of pure caffeine, ready to face the day at 1000 mph.", choices: [{ text: "Commute (Drive, VERY fast)", nextId: 512 }, { text: "Commute (Bus, try not to vibrate out of your seat)", nextId: 52 }] },

            // Branching to Main Storylines
            { id: 51, text: "You get in your old, trusty truck and head to your job at the bank. The gas gauge has been broken for weeks, but you have a pretty good feel for it. Usually. Halfway there, the engine sputters, coughs, and then goes silent. You coast to the shoulder. You're out of gas.", choices: [{ text: "Call for help", nextId: 401 }, { text: "Start walking to the nearest gas station", nextId: 402 }, { text: "Call an Uber to work and deal with this later", nextId: 403 }, { text: "Just wait and see what happens", nextId: 405 }] },
            { id: 52, text: "You catch the bus to work. As you ride, you see someone drop a folded piece of paper. You pick it up. It looks like a lottery ticket.", choices: [{ text: "Check the numbers.", nextId: 55 }, { text: "Put it in your pocket for later.", nextId: 101 }] },
            { id: 55, text: "You pull up the lottery results on your phone. You scan the ticket. Holy cow. It's a $100 winner! You carefully fold it and put it in your pocket, a grin spreading across your face.", setState: { lotteryTicket: true }, choices: [{ text: "Arrive at the bank, feeling lucky.", nextId: 101 }] },
            { id: 53, text: "You decide to bike to work. The fresh air is nice, but a car cuts you off and you narrowly avoid a nasty accident. Your heart is pounding as you arrive at the bank.", choices: [{ text: "Continue to work", nextId: 101 }] },
            { id: 54, text: "You know what? Screw it. You're not going to work. The city awaits.", choices: [{ text: "Begin your adventure", nextId: 34 }] },

            // --- Weed Paths ---
            { id: 60, text: "You grab your rig from the nightstand. The torch roars to life. You take a fat dab and hold it in, coughing until you see stars. The world slows down. Everything is hazy and kinda funny now.", choices: [{ text: "Get up and stretch (slowly)", nextId: 61 }, { text: "Grab your phone and zone out", nextId: 13 }] },
            { id: 61, text: "You slowly rise, your body feeling both heavy and light. A good stretch feels incredible. Time to get ready, maybe.", choices: [{ text: "Hot shower", nextId: 62 }, { text: "Cold shower", nextId: 63 }, { text: "Just brush teeth", nextId: 64 }] },
            { id: 62, text: "The hot water feels amazing. You space out for what feels like an hour, just enjoying the steam.", choices: [{ text: "Pick outfit (Jeans/Hoodie)", nextId: 65 }, { text: "Pick outfit (Slacks/Business)", nextId: 36 }] },
            { id: 63, text: "The cold water is a sensory explosion. Your brain short-circuits for a second, then reboots with crystal clarity. A bold choice.", choices: [{ text: "Pick outfit (Jeans/Hoodie)", nextId: 65 }, { text: "Pick outfit (Slacks/Business)", nextId: 36 }] },
            { id: 64, text: "Showering seems like a lot of work. You brush your teeth meticulously instead, focusing intensely on each tooth.", choices: [{ text: "Pick outfit (Jeans/Hoodie)", nextId: 65 }, { text: "Pick outfit (Slacks/Business)", nextId: 36 }] },
            { id: 65, text: "You pull on a comfortable pair of jeans and a hoodie. As you put your hands in the pockets, you feel something cold and metallic. It's a small, ornate key you've never seen before. Weird. You shrug and pocket it, feeling a strange sense of destiny.", setState: { hasKey: true }, choices: [{ text: "Get some breakfast", nextId: 95 }] },
            { id: 70, text: "You pack a fat bowl. The sweet smoke fills your lungs. An hour later, you're staring at the ceiling, contemplating the mysteries of the universe and whether you have any chips in the house.", choices: [{ text: "Watch TV", nextId: 71 }, { text: "Go on a snack quest to the kitchen", nextId: 72 }, { text: "Mindlessly scroll Facebook Marketplace", nextId: 73 }] },
            { id: 71, text: "You flip on the TV. What's the plan?", choices: [{ text: "See what's on Adult Swim", nextId: 711 }, { text: "Watch daytime court shows and feel superior", nextId: 712 }] },
            { id: 711, text: "You get sucked into a marathon of 'Delocated'. Jon is trying to get a new 'krime' photo taken. You grab your snacks and forget the outside world exists.", choices: [{ text: "The perfect day.", nextId: 79 }] },
            { id: 712, text: "You get sucked into hours of petty disputes and questionable rulings. You yell at the TV a lot. It's surprisingly cathartic.", choices: [{ text: "A surprisingly cathartic day.", nextId: 79 }] },
            { id: 72, text: "You embark on a perilous journey to the kitchen. You construct a magnificent sandwich out of leftovers and eat it over the sink like an animal. It's the best thing you've ever tasted.", choices: [{ text: "A truly magnificent sandwich.", nextId: 79 }] },
            { id: 73, text: "You open Facebook Marketplace. Amidst the broken furniture and MLM scams, something beautiful catches your eye: a 1995 Z28 Camaro, T-tops, cherry red. The price is... suspiciously low.", choices: [{ text: "Message the seller: 'is this still available?'", nextId: 201 }, { text: "Assume it's a scam and look for weird taxidermy instead", nextId: 70 }] },
            { id: 79, text: "You spend the rest of the day in a blissful haze. As evening sets in, your phone buzzes, pulling you back to reality.", choices: [{ text: "See who it is.", nextId: 299 }] },
            { id: 80, text: "You take a quick rip from your bong to 'prepare' for the day. You feel calm, maybe too calm. Time to head to work, hopefully no one notices your eyes are as red as the devil's... well, you know.", choices: [{ text: "Commute (Drive, probably a bad idea)", nextId: 511 }, { text: "Commute (Bus, the safer choice)", nextId: 52 }] },
            { id: 89, text: "Time to pick an outfit for the day.", choices: [{ text: "Pick outfit (Jeans/Hoodie)", nextId: 35 }, { text: "Pick outfit (Slacks/Business)", nextId: 36 }, { text: "Pick outfit (Hawaiian Shirt)", nextId: 37 }, { text: "Stay in Pajamas", nextId: 38 }] },
            // Glock Path
            { id: 90, text: "You're all dressed. One last look in the mirror before you head out. Any final preparations?", choices: [{ text: "Strap on your shoulder harness and gold 9mm Glock.", nextId: 91 }, { text: "Nah, let's just get some breakfast.", nextId: 95 }] },
            { id: 91, text: "You open a hidden compartment in your closet and pull out your custom gold 9mm Glock. You strap on the leather shoulder harness. It feels heavy and familiar under your jacket. You're ready for anything.", setState: { hasGlock: true }, choices: [{ text: "Now for some breakfast.", nextId: 95 }] },
            { id: 95, text: "Time for the most important meal of the day. What's on the menu?", choices: [{ text: "Breakfast (Eggs/Toast)", nextId: 41 }, { text: "Breakfast (Cereal)", nextId: 42 }, { text: "Breakfast (Oatmeal)", nextId: 46 }, { text: "Coffee Only", nextId: 43 }, { text: "Skip Breakfast", nextId: 44 }] },

            // High Commute Path
            { id: 511, text: "You get in your car. The music sounds incredible. You're driving 15 mph under the speed limit and are intensely focused on the lines on the road. You make it to the bank, but you're mentally exhausted from the effort.", choices: [{ text: "Stumble into work (feeling fuzzy)", nextId: 1011 }] },
            { id: 512, text: "You get in your car, vibrating with energy. You're driving 15 mph OVER the speed limit, weaving through traffic. In your mind, you're a pro race car driver. In reality, you're a menace. A cop pulls you over. 'Just coffee, officer!' you say, vibrating. He gives you a hefty speeding ticket. You arrive at work late and angry.", choices: [{ text: "Today is not your day.", nextId: 140 }] },
            { 
                id: 1011, 
                text: "You stumble into the bank. Matt waves at you. 'Whoa, man, you look... relaxed.' Mr. Johns just squints at you from his office. 'Are you high on my clock? Go home. Now. We'll talk about this tomorrow.' You're sent home in disgrace. A few hours later, your phone buzzes.",
                textFemale: "You stumble into the bank. Karen waves at you. 'Whoa, sunshine, you look... relaxed.' Mr. Johns just squints at you from his office. 'Are you high on my clock? Go home. Now. We'll talk about this tomorrow.' You're sent home in disgrace. A few hours later, your phone buzzes.",
                choices: [{ text: "Check your phone.", nextId: 299 }]
            },

            // --- BANK TELLER PATH ---
            { 
                id: 101, 
                text: "Centerville Savings Bank stands tall in its beige blandness. The lobby smells faintly of stale coffee and Lysol. You swipe in and step behind the counter. Matt, your coworker, waves at you. 'Hey, they finally restocked the Nutter Butters.' Mr. Johns, your boss, shuffles past. 'Clock in already. And no slacking.'", 
                textFemale: "Centerville Savings Bank stands tall in its beige blandness. The lobby smells faintly of stale coffee and Lysol. You swipe in and step behind the counter. Karen, your coworker, waves at you. 'Hey, they finally restocked the Nutter Butters.' Mr. Johns, your boss, shuffles past. 'Clock in already. And no slacking.'",
                choices: [{ text: "Talk about Nutter Butters.", nextId: 102 }, { text: "Go straight to work", nextId: 130 }, { text: "Sneak to breakroom for a donut first", nextId: 104 }] 
            },
            { 
                id: 102, 
                text: "You walk over to Matt. 'No way, for real?' you ask.",
                textFemale: "You walk over to Karen. 'No way, for real?' you ask.",
                choices: [{ text: "I love Nutter Butters.", nextId: 105 }, { text: "Nutter Butters are kinda gross.", nextId: 106 }] 
            },
            { 
                id: 104, 
                text: "You sneak a powdered donut. Sweet victory — but Mr. Johns catches you. 'You’re already late and now you’re eating on my time?'", 
                choices: [{ text: "Apologize sincerely", nextId: 110 }, { text: "Sass him back", nextId: 111 }, { text: "Pretend to choke dramatically to distract him", nextId: 112 }] 
            },
            { 
                id: 105, 
                text: "Matt scoffs. ''Gross.'' he says. 'You should see their Instagram page, though. It's completely insane. The stuff they post is wild.'",
                textFemale: "Karen scoffs. ''Gross.'' she says. 'You should see their Instagram page, though. It's completely insane. The stuff they post is wild.'",
                choices: [{ text: "Huh. Weird. Well, time to get ready.", nextId: 130 }] 
            },
            { 
                id: 106, 
                text: "'Are you kidding?' Matt says, looking shocked. 'They're the best. You gotta check out their Instagram page, it rips. I'll show you what's up later.'",
                textFemale: "'Are you kidding?' Karen says, looking shocked. 'They're the best. You gotta check out their Instagram page, it rips. I'll show you what's up later.'",
                choices: [{ text: "Alright, whatever. Time to get ready.", nextId: 130 }] 
            },
            { id: 110, text: "Mr. Johns sighs. 'Just don’t let it happen again.'", choices: [{ text: "Get to work", nextId: 130 }] },
            { id: 111, text: "'Maybe if you bought better donuts I’d be faster,' you joke. Mr. Johns glares. 'Last warning.'", choices: [{ text: "Get to work", nextId: 130 }] },
            { 
                id: 112, 
                text: "You clutch your throat dramatically. Matt rushes in pretending to save you. Mr. Johns rolls his eyes. 'Idiots.'",
                textFemale: "You clutch your throat dramatically. Karen rushes in pretending to save you. Mr. Johns rolls his eyes. 'Idiots.'",
                choices: [{ text: "Get to work", nextId: 130 }]
            },
            {
                id: 117,
                text: "You start to slide him the cash, but something feels wrong. At the last second, you pull it back. 'I need to verify this with my manager.' The man's face pales, and he bolts out the door. Mr. Johns is furious you almost fell for it, but relieved you didn't. He gives you a stern lecture on procedure.",
                choices: [{ text: "Continue the workday, shaken.", nextId: 140 }]
            },
            
            // --- TEXTING PARTNER PATH ---
            { 
                id: 130, 
                text: "As you wait for the first customer, you think of your partner. You miss their wonderful personality and the way they make you feel. You pull out your phone under the counter.",
                textFemale: "As you wait for the first customer, you think of your partner. You miss his wonderful personality and the way he makes you feel. You pull out your phone under the counter.",
                choices: [
                    { text: "Send them a ❤️ and 😘 emoji.", nextId: 131 },
                    { text: "Send them an 'i miss you bb' text.", nextId: 132 },
                    { text: "Just think about them. Don't want to seem clingy.", nextId: 133 }
                ]
            },
            { 
                id: 131, 
                text: "A moment later, your phone buzzes. She's sent back a 😘. You smile and put your phone away, feeling a little warmer.",
                textFemale: "A moment later, your phone buzzes. He's sent back a 😘. You smile and put your phone away, feeling a little warmer.",
                choices: [{ text: "Time to get to work.", nextId: 134 }]
            },
            { 
                id: 132, 
                text: "Your phone buzzes almost instantly with a reply: 'ILY'. You feel a rush of affection and quickly put your phone away as the first customer approaches.",
                choices: [{ text: "Time to get to work.", nextId: 134 }]
            },
            { 
                id: 133, 
                text: "You decide against it. Better to stay focused. Unbeknownst to you, at that very moment, you were on your partner's mind all day. You put your phone away and get ready for the day.",
                choices: [{ text: "Time to get to work.", nextId: 134 }]
            },
            { id: 134, text: "You put your phone away, feeling good. Barry from HR wanders over.", choices: [{ text: "Great. It's Barry.", nextId: 135 }] },
            { id: 135, text: "'Hey,' Barry says, leaning conspiratorially. 'Did you hear about what happened in the parking lot this morning? Classic Mr. Johns.'", choices: [{ text: "No, what happened?", nextId: 136 }, { text: "Sorry Barry, I've got to get to work.", nextId: 137 }] },
            { id: 136, text: "Barry launches into a juicy, probably exaggerated story about Mr. Johns getting into a screaming match with the parking garage gate. You try to stifle a laugh.", setState: { heardGossip: true }, choices: [{ text: "File that away for later.", nextId: 138 }] },
            { id: 137, text: "You politely excuse yourself. Barry seems annoyed at being brushed off, but you've got work to do.", choices: [{ text: "Probably the right call.", nextId: 150 }] },
            { id: 138, text: "Later that day, you head to the breakroom for a coffee. Mr. Johns is in there, looking grumpy as usual.", choices: [{ text: "Get your coffee and leave.", nextId: 140 }] },
            { id: 139, text: "You can't resist. 'Rough morning with the parking gate, huh?' you ask casually. Mr. Johns' eyes widen, then he lets out an unexpected chuckle. 'Don't you start. It's a menace.' You might have just earned a shred of his respect.", choices: [{ text: "The day flies by after that.", nextId: 140 }] },
            { id: 140, text: "The rest of the workday is surprisingly calm. As you're packing up to leave, your phone buzzes.", choices: [{ text: "Check the text from your partner.", nextId: 299 }] },
            
            // --- NEW MUNDANE WORK PATH ---
            { id: 150, text: "The morning rush is over, leaving a quiet lull. What should you tackle next?", choices: [ { text: "Process last week's deposit slips.", nextId: 151 }, { text: "Do it later. Stretch your legs for a bit.", nextId: 160 } ] },
            { id: 151, text: "You grab the stack of deposit slips. It's tedious work, but it has to be done.", choices: [{ text: "File them and export a copy for your records.", nextId: 152 }, { text: "Just file them. No need for extra steps.", nextId: 153 }] },
            { id: 152, text: "You finish filing and start an export. Do you want to CC Mr. Johns on the confirmation email?", choices: [{ text: "Yes, keep the boss in the loop.", nextId: 154 }, { text: "No, no need to bother him.", nextId: 154 }] },
            { id: 153, text: "You efficiently file away the slips. The task takes up a good chunk of your afternoon.", choices: [{ text: "Alright, that's done.", nextId: 140 }] },
            { id: 154, text: "You send the email. It's good to have a digital paper trail. That task takes a while, and before you know it, the day is winding down.", choices: [{ text: "Time flew by.", nextId: 140 }] },
            { id: 160, text: "You decide to put off the paperwork and wander into the back offices. You pass an empty cubicle with a sad-looking plant. On the desk sits a chipped mug that reads 'World's Best Boss'.", choices: [{ text: "Take the mug as a souvenir.", nextId: 168 }, { text: "Leave it and keep walking.", nextId: 169 }] },
            { id: 168, text: "You grab the mug. It feels appropriately cynical. You tuck it under your arm and continue your stroll.", setState: { bossMug: true }, choices: [{ text: "Let's see what else is back here.", nextId: 169 }] },
            { id: 169, text: "You notice the door to the old records room is slightly ajar.", choices: [{text: "Peek inside.", nextId: 170}, {text: "Probably shouldn't. Keep walking.", nextId: 161}] },
            { id: 170, text: "You slip into the dusty room. It's filled with old file cabinets. On a table sits a long-forgotten deposit box. Inside, under some papers, you find a single, heavy clay poker chip from 'The River Palace,' a casino that closed down decades ago.", setState: { oldCasinoChip: true }, choices: [{text: "What a cool find.", nextId: 161}] },
            { id: 161, text: "You see Steve, the maintenance guy, working on a flickering light.", choices: [{ text: "Say hi to Steve.", nextId: 162 }] },
            { id: 162, text: "'Hey Steve, how's it going?' you ask. He looks up, wiping his brow. 'Same old, same old. Hey, you like classic cars?'", choices: [{ text: "Always wanted one. Why?", nextId: 163 }] },
            { id: 163, text: "'My brother-in-law's selling his '88 Corvette. Red. You've always wanted one of those, right?'", choices: [{ text: "Yeah! What's the condition like?", nextId: 164 }] },
            { id: 164, text: "'It's in pretty good shape for its age. A few scratches on the bumper, but the engine runs smooth. Got about 80,000 miles on it.'", choices: [{ text: "That sounds amazing. Is he asking a lot?", nextId: 1645 }] },
            { id: 1645, text: "'Nah, he's letting it go for a steal. Here,' Steve says, scribbling a number on the back of his own business card. 'That's the seller's number. And you've got mine if you ever need any work done.' You pocket the card, your mind racing.", setState: { hasCarInfo: true, stevesCard: true }, choices: [{ text: "Thanks, Steve! I'll do that.", nextId: 165 }] },
            { id: 165, text: "You continue your walk, dreaming of the Corvette, when Jenny from accounting spots you. 'Shouldn't you be up front? What are you doing back here?'", choices: [{ text: "Just stretching my legs.", nextId: 166 }, { text: "Talking to Steve about a car.", nextId: 166 }] },
            { id: 166, text: "Jenny narrows her eyes. 'Stretching your legs? There's a lot of work to do, you know. Mr. Johns doesn't like people wandering.' She seems suspicious for no reason.", choices: [{ text: "You're right. I'll head back now.", nextId: 167 }] },
            { id: 167, text: "You head back to your station, the brief escape over. Time to get back to it. The rest of the afternoon passes by.", choices: [{ text: "Finally, quitting time.", nextId: 140 }] },

            // Camaro Quest
            { id: 201, text: "A reply comes back almost instantly: 'yo it is. cash only no test drives i know what i got. u want it or not? address is 123 sketchy lane out by the old factory.'", choices: [{ text: "Agree to go check it out", nextId: 202 }, { text: "'No test drive? No thanks.'", nextId: 203 }] },
            { id: 202, text: "You decide to risk it. You end up in a tense cash exchange and drive off in a rumbling beast that smells like cigarettes and freedom. It breaks down two miles later, but what a story.", choices: [{ text: "Well, that was an adventure.", nextId: 209 }] },
            { id: 203, text: "You're not an idiot. You block the seller and go back to watching TV. You may not have a Camaro, but you also didn't get robbed.", choices: [{ text: "A wise choice.", nextId: 209 }] },
            { id: 209, text: "Well, that was an adventure. You head home, shaking your head at the weirdness of Facebook Marketplace. Later that evening, your phone buzzes.", choices: [{ text: "Check the text.", nextId: 299 }] },
            
            // --- DATE PATH ENTRY ---
            { 
                id: 299, 
                text: "Your phone buzzes. It's a text from your partner: 'Date night tonight! What are you feeling? Maggiano's, Cheesecake Factory, or that new Hot Pot place?'",
                choices: [
                    { text: "Maggiano's sounds perfect.", nextId: 300, setState: { postReadyNodeId: 900 } },
                    { text: "Cheesecake Factory, a classic.", nextId: 300, setState: { postReadyNodeId: 322 } },
                    { text: "Let's try the Hot Pot place!", nextId: 300, setState: { postReadyNodeId: 312 } },
                    { text: "Let's hotbox the truck and go to Maggiano's.", nextId: 300, setState: { postReadyNodeId: 601 } },
                    { text: "Let's hotbox the truck and go to Cheesecake Factory.", nextId: 300, setState: { postReadyNodeId: 602 } },
                    { text: "Let's hotbox the truck and go to the Hot Pot place.", nextId: 300, setState: { postReadyNodeId: 603 } }
                ] 
            },
            {
                id: 300,
                text: "Your partner texts back: 'Perfect! Get ready and let's meet up soon.'",
                choices: [{ text: "Head home to get ready.", nextId: 7000 }]
            },

            // Out of Gas Path
            { 
                id: 401, 
                text: "You call your girlfriend, feeling a bit embarrassed. 'Hey... so, funny story...' She laughs but agrees to bring you a can of gas. You wait 45 minutes, but she arrives like a queen, saving the day. You get the truck running again, but you are now extremely late for work.",
                textFemale: "You call your boyfriend, feeling a bit embarrassed. 'Hey... so, funny story...' He laughs but agrees to bring you a can of gas. You wait 45 minutes, but he arrives like a king, saving the day. You get the truck running again, but you are now extremely late for work.",
                choices: [{ text: "Finally arrive at the bank", nextId: 404 }] 
            },
            { id: 402, text: "You check your map. There's a gas station about a mile up the road. You lock up the truck and start hoofing it. It's hot, and by the time you buy a gas can, fill it, and walk back, you're sweaty, exhausted, and over an hour late.", choices: [{ text: "Finally arrive at the bank, looking disheveled", nextId: 404 }] },
            { id: 403, text: "You decide the truck is a problem for 'Future You'. You call an Uber and get to the bank only about 20 minutes late. You'll have to figure out the truck situation after your shift, which is a stressful thought looming over you all day.", choices: [{ text: "Clock in at the bank, slightly late", nextId: 101 }] },
            { id: 404, text: "You walk into the bank, trying to look composed. Mr. Johns is standing by the door with his arms crossed, tapping his foot. 'My office. Now.' You sit down, and he gives you a severe lecture on punctuality. It's your final warning.", choices: [{ text: "Get to work, chastened.", nextId: 130 }] },
            { id: 405, text: "You put your flashers on, lean your seat back, and wait. Maybe someone will stop. It's a long shot, but it's better than walking.", choices: [{ text: "Wait for an hour", nextId: 406 }, { text: "Smoke a joint while you wait", nextId: 700 }] },
            { id: 406, text: "An hour passes. Cars have been whizzing by without a second glance. You're starting to lose hope. Your phone battery is draining. What now?", choices: [{ text: "Keep waiting. Patience is a virtue.", nextId: 407 }, { text: "Give up and call for help", nextId: 401 }] },
            { id: 407, text: "Just as you're about to give up, a beat-up van painted with flames pulls over. A man in a purple satin jacket that says 'GAS GUYS' on the back gets out. 'Look like you're in a pickle, friend!' he says with a grin. 'First time's free!' He fills your tank with a couple of gallons, gives you a wink, and drives off. You make it to work just in the nick of time. What a weird start to the day. The rest of the shift is thankfully uneventful.", choices: [{ text: "Finally, time to head home.", nextId: 140 }] },
            
            // --- DATE PATHS CONTINUED ---
            { id: 312, text: "You arrive at the Hot Pot place, ready for a fun and interactive meal.", choices: [{ text: "Continue the date...", nextId: 2000}] },
            { id: 315, text: "You finish your free and delicious meal.", choices: [{ text: "Continue the date...", nextId: 2000 }] },
            { id: 322, text: "You arrive at The Cheesecake Factory. The sheer size of the menu is dizzying, but you're ready for it.", choices: [{ text: "Continue the date...", nextId: 2000}] },
            
            // --- Pre-Date Smoking Paths ---
            { 
                id: 601, 
                text: "You meet up with your partner, freshly changed and ready for the night. 'There you are,' she says with a smile, getting into the truck. You hotbox the truck and get comfortably hazy. The vibes are good. You look over at her.",
                textFemale: "You meet up with your partner, freshly changed and ready for the night. 'There you are,' he says with a smile, getting into the truck. You hotbox the truck and get comfortably hazy. The vibes are good. You look over at him.",
                choices: [{ text: "Compliment their outfit", nextId: 611 }, { text: "Just enjoy the music and head out", nextId: 900 }]
            },
            { 
                id: 611, 
                text: "You tell her how amazing her outfit looks. She blushes and thanks you, the compliment landing perfectly in the hazy atmosphere. You feel a closer connection as you head to the restaurant.",
                textFemale: "You tell him how amazing his outfit looks. He grins and thanks you, the compliment landing perfectly in the hazy atmosphere. You feel a closer connection as you head to the restaurant.",
                choices: [{ text: "Head to Maggiano's", nextId: 900 }]
            },
            { 
                id: 602, 
                text: "You meet up with your partner, freshly changed and ready for the night. 'There you are,' she says with a smile, getting into the truck. You hotbox the truck and get comfortably hazy. The vibes are good. You look over at her.",
                textFemale: "You meet up with your partner, freshly changed and ready for the night. 'There you are,' he says with a smile, getting into the truck. You hotbox the truck and get comfortably hazy. The vibes are good. You look over at him.",
                choices: [{ text: "Compliment their clothes", nextId: 612 }, { text: "Just enjoy the music and head out", nextId: 322 }]
            },
            { 
                id: 612, 
                text: "You tell her how great her clothes look. She lights up and thanks you, the compliment landing perfectly in the hazy atmosphere. You feel a closer connection as you head to the restaurant.",
                textFemale: "You tell him how great his clothes look. He lights up and thanks you, the compliment landing perfectly in the hazy atmosphere. You feel a closer connection as you head to the restaurant.",
                choices: [{ text: "Head to The Cheesecake Factory", nextId: 322 }]
            },
            { 
                id: 603, 
                text: "You meet up with your partner, freshly changed and ready for the night. 'There you are,' she says with a smile, getting into the truck. You hotbox the truck and get comfortably hazy. The vibes are good. You look over at her.",
                textFemale: "You meet up with your partner, freshly changed and ready for the night. 'There you are,' he says with a smile, getting into the truck. You hotbox the truck and get comfortably hazy. The vibes are good. You look over at him.",
                choices: [{ text: "Compliment their hair", nextId: 613 }, { text: "Just enjoy the music and head out", nextId: 312 }]
            },
            { 
                id: 613, 
                text: "You tell her how awesome her hair looks today. She beams and thanks you, the compliment landing perfectly in the hazy atmosphere. You feel a closer connection as you head to the restaurant.",
                textFemale: "You tell him how awesome his hair looks today. He beams and thanks you, the compliment landing perfectly in the hazy atmosphere. You feel a closer connection as you head to the restaurant.",
                choices: [{ text: "Head to the Hot Pot place", nextId: 312 }]
            },

            // --- Squirrel Encounter Path ---
            { id: 700, text: "You figure you might as well pass the time. You spark up a joint. As you're taking a puff, a small squirrel scurries down a nearby tree and sits on the guardrail, twitching its nose and staring right at the joint.", choices: [{ text: "Offer the squirrel a hit.", nextId: 701 }, { text: "Ignore it and keep smoking.", nextId: 702 }] },
            { id: 701, text: "You hold the joint out. 'Want some, little guy?' The squirrel, with no fear, scampers over, takes the joint in its tiny paws, and actually takes a drag. Its eyes go wide. Before you can react, it snatches the rest of the joint and darts back up the tree, leaving you completely stunned.", choices: [{ text: "Well... that happened. Keep waiting.", nextId: 406 }] },
            { id: 702, text: "You're not sharing your weed with a rodent. You turn away from it. The squirrel chitters in annoyance for a moment before giving up and running off into the woods.", choices: [{ text: "Finish your joint and keep waiting.", nextId: 406 }] },
            
            // Maggiano's Wine Path
            { id: 900, text: "You arrive at Maggiano's. The atmosphere is cozy and romantic. You're seated at your table and look over the menu.", choices: [{ text: "Your partner points out an expensive bottle of wine.", nextId: 901 }, { text: "You spot something on the floor by a vacant table.", nextId: 307 }] },
            { id: 901, text: "Your partner points to a bottle of Barolo on the wine list. 'I've always wanted to try this one,' they say, their eyes sparkling. You see the price and gulp... it's definitely a special occasion wine.", choices: [{ text: "Order it. 'You only live once.'", nextId: 902 }, { text: "'Maybe we can find a nice Chianti instead?'", nextId: 903 }] },
            { id: 902, text: "You wave the waiter over and order the Barolo. It's incredible - rich, complex, and absolutely delicious. You both savor every sip, getting a pleasant, warm buzz. The conversation flows effortlessly. It's a perfect meal. 'Wow, I am definitely too buzzed to drive right now,' you say with a happy sigh.", choices: [{ text: "Suggest a walk to Cold Stone for milkshakes.", nextId: 904 }] },
            { id: 903, text: "You gently steer them towards a more reasonably priced Chianti. It's fine, but you can't help but notice a flicker of disappointment in their eyes. The rest of the dinner is nice, but not quite the magical night it could have been.", choices: [{ text: "Continue the date...", nextId: 2000 }] },
            { id: 904, text: "The walk in the cool air is refreshing. You find the Cold Stone Creamery and order two thick, decadent milkshakes. You sit outside, laughing and enjoying the cool treat as the wine buzz fades into a perfect, happy memory. It's been the best date night you've had in a long time.", choices: [{ text: "Continue the date...", nextId: 2000 }] },
            { id: 307, text: "You excuse yourself and walk over. It's two folded twenty-dollar bills. Forty bucks, just lying there. The previous occupants of the table are long gone. What do you do?", choices: [{ text: "Pocket the cash. Finders keepers.", nextId: 308 }, { text: "Give the money to the server.", nextId: 309 }] },
            { id: 308, text: "You slip the money into your pocket. It feels a little weird, but hey, finders keepers. You return to your table, ready to enjoy the rest of your night.", choices: [{ text: "So, you were saying about work...", nextId: 2000 }] },
            { id: 309, text: "You flag down your server and hand them the money, explaining where you found it. The server is incredibly grateful. 'Wow, thank you so much for your honesty!' they say. You return to your table, feeling good about yourself.", choices: [{ text: "So, about that work drama...", nextId: 2000 }] },

            // --- NEW FEMALE OUTFIT PATHS ---
            { id: 1000, text: "You slip on a simple but elegant blue dress. It's comfortable and makes you feel confident.", setState: { wearsHawaiianShirt: false }, choices: [{ text: "Finish getting ready", nextId: 90 }] },
            { id: 1001, text: "You choose the black skirt, pink blouse, and a cozy white sweater. It's a classic, cute look.", setState: { wearsHawaiianShirt: false }, choices: [{ text: "Finish getting ready", nextId: 90 }] },
            { id: 1002, text: "You go for comfort and style with a black hoodie and your favorite pair of jeans. You're ready for anything.", setState: { wearsHawaiianShirt: false }, choices: [{ text: "Finish getting ready", nextId: 90 }] },
            { id: 1003, text: "Maximum comfort is the goal. You pull on a pair of soft sweatpants and a cutoff shirt. It's a lazy day, after all.", setState: { wearsHawaiianShirt: false }, choices: [{ text: "Finish getting ready", nextId: 90 }] },

            // --- NEW MYSTERY PHONE CALL PATH ---
            { id: 1100, text: "You're sitting on the couch when your phone rings. The caller ID just says 'UNKNOWN'.", choices: [{ text: "Answer it.", nextId: 1101 }, { text: "Ignore it.", nextId: 1102 }] },
            { id: 1101, text: "You answer. 'Hello?' you say cautiously. A distorted voice on the other end says, 'Hey, what's up?'", choices: [{ text: "'Who is this?'", nextId: 1103 }, { text: "'Nothing much, who's this?'", nextId: 1103 }, { text: "'Wrong number.' Hang up.", nextId: 1102 }] },
            { id: 1102, text: "You let it go to voicemail. They don't leave a message. The rest of your day is quiet until you get a much more welcome text in the evening.", choices: [{ text: "Check your phone.", nextId: 299 }] },
            { id: 1103, text: "The voice chuckles. 'I don't know, who is this?'", choices: [{ text: "'You called me! Who is this?'", nextId: 1104 }, { text: "'Look, I don't have time for games.'", nextId: 1104 }] },
            { id: 1104, text: "'Alright, alright, relax,' the voice says. 'So you're not at the bank today, huh? Taking a little mental health day?'", choices: [{ text: "'How did you know that?'", nextId: 1105 }] },
            { id: 1105, text: "The caller ignores your question. 'So, how's the weather over there? Looks a little cloudy from here.'", choices: [{ text: "Ask where 'here' is.", nextId: 1106 }, { text: "'It's fine. Why are you asking?'", nextId: 1107 }] },
            { id: 1106, text: "'Oh, I'm in Bermuda,' the voice says casually. 'It's lovely this time of year. Anyway, pop quiz, hotshot. What is 12 times 12?'", choices: [{ text: "144", nextId: 1108 }, { text: "124", nextId: 1109 }, { text: "24", nextId: 1109 }] },
            { id: 1107, text: "'Just making conversation,' the voice says. 'So... what are you wearing?' This is getting weird.", choices: [{ text: "Hang up.", nextId: 1110 }, { text: "Ask them a math question back.", nextId: 1106 }] },
            { id: 1108, text: "'Correct!' the voice exclaims. 'You're smarter than you look. Listen, I have to go, but... try to stay out of trouble. And don't trust the gnomes.' The line goes dead.", choices: [{ text: "Stare at your phone in confusion.", nextId: 1110 }] },
            { id: 1109, text: "'Wrong!' the voice buzzes. 'I expected better from you. Listen, I have to go. Think about what you've done.' The line goes dead.", choices: [{ text: "Stare at your phone in confusion.", nextId: 1110 }] },
            { id: 1110, text: "You're left in silence, thoroughly confused by the strangest phone call of your life. Was it a prank? Or something else? You shake your head and try to forget about it. That evening, your phone buzzes with a much more welcome text.", choices: [{ text: "Check your phone.", nextId: 299 }] },
            
            // --- NEW GOLD COIN CONVERSATION PATH ---
            { id: 1201, text: "You open your laptop and start researching the coins. Your eyes go wide. They're not just gold; they're rare 19th-century sovereigns. Based on recent auction prices, the eight coins are worth... over $100,000. You both stare at the screen in stunned silence.", choices: [{ text: "Discuss what to do with the money.", nextId: 1202 }] },
            { 
                id: 1202, 
                text: "'Oh my god,' your girlfriend says, her voice a whisper. 'We're rich! The first thing I'm doing is buying that diamond necklace we saw at the mall. And then a whole new wardrobe. And we HAVE to take a trip to the beach, a real one, like in the Maldives!'",
                textFemale: "'Oh my god,' your boyfriend says, his voice a whisper. 'We're rich! We could put a down payment on a house! A real house, with a yard! Or... you know what I've always wanted? A brand new Corvette. A red one.'",
                choices: [
                    { text: "That sounds amazing!", textFemale: "A Corvette? Are you serious?", nextId: 1203 },
                    { text: "Let's not get ahead of ourselves.", nextId: 1204 }
                ]
            },
            { 
                id: 1203, 
                text: "Her face lights up. 'I knew you'd understand! We could be sipping cocktails on a white sand beach in a week!' Your mind swims with the possibilities.",
                textFemale: "'Completely serious!' he says, his eyes gleaming. 'Imagine pulling up in a brand new Stingray. We'd be legends!' His excitement is infectious, even if the idea is a little wild.",
                choices: [{ text: "This is the start of a whole new life.", nextId: 1205 }]
            },
            { 
                id: 1204, 
                text: "Her smile fades a little. 'Oh. Right. I guess we should be responsible. But can't we have a little fun first?'",
                textFemale: "His face falls a little. 'What? It's a classic! It's an investment! Okay, maybe not, but it would be awesome. A house is a good idea too, I guess.'",
                choices: [{ text: "Let's make a plan.", nextId: 1205 }]
            },
            { id: 1205, text: "You spend the rest of the night dreaming and planning, the pile of gold coins gleaming on your coffee table like a promise of a brighter, more exciting future. This single day has changed your life forever. THE END.", choices: [{ text: "Play Again", nextId: 1 }] },

            // --- NEW WORK TEA DIALOGUE PATH ---
            { id: 1999, text: "You pull out the lottery ticket. 'Good news, dinner's on me tonight. Found this earlier.' Your partner's eyes go wide. 'No way! That's amazing!' The good mood is set for the entire night.", setState: { lotteryTicket: false }, choices: [{ text: "So, about this tea...", nextId: 2000 }] },
            {
                id: 2000,
                text: "Your partner leans in conspiratorially. 'Oh my god, there is tea,' they say, their eyes wide. 'There is work tea.'",
                textFemale: "Your partner leans in conspiratorially. 'Oh my god, there is tea,' he says, his eyes wide. 'There is work tea.'",
                choices: [
                    { text: "Okay, let's hear it.", nextId: 2001 },
                    { text: "You know I love it.", nextId: 2001 },
                    { text: "Oh yeah? Is it that you're the hottest woman that works there?", textFemale: "Oh yeah? Is it that you're the most handsome guy that works there?", nextId: 2002 }
                ]
            },
            {
                id: 2002,
                text: "Your girlfriend rolls her eyes and playfully smacks your arm. 'Shut up,' she laughs. 'Okay, but for real, listen to this.'",
                textFemale: "Your boyfriend laughs. 'I wish. Nah, listen to this.'",
                choices: [{ text: "I'm listening...", nextId: 2001 }]
            },
            {
                id: 2001,
                text: "'Okay babe, you are not ready for this. Like, I am actually screaming inside. So you remember Heather’s birthday last month, right? She made this huge deal out of it, sent a calendar invite for her own cake cutting, and she got that big Costco sheet cake?'",
                textFemale: "'Okay babe, you're not gonna believe this. Remember Heather’s birthday last month? How she made a huge deal about it and got that giant Costco sheet cake?'",
                choices: [
                    { text: "The one with the little pink roses? That cake was fire.", nextId: 2003 },
                    { text: "Vaguely. What about it?", nextId: 2003 }
                ]
            },
            {
                id: 2003,
                text: "'Right? I had two slices, no shame. ANYWAY. Fast forward to THIS week. It’s Danielle’s birthday. Guess what she brings?'",
                textFemale: "'Yeah, that one. So, it was Danielle's birthday this week. Guess what cake she brought in?'",
                choices: [
                    { text: "No...", nextId: 2004 },
                    { text: "The same cake?", nextId: 2004 }
                ]
            },
            {
                id: 2004,
                text: "'The. SAME. EXACT. CAKE. Like, literally identical. Same roses, same frosting, same plastic happy birthday thingy stuck on top. Heather was FUMING.'",
                textFemale: "'Yup. The exact same one. Roses and everything. Heather was losing her mind.'",
                choices: [
                    { text: "What did she do?", nextId: 2005 },
                    { text: "That's a bold move by Danielle.", nextId: 2005 }
                ]
            },
            {
                id: 2005,
                text: "'She goes in the break room, sees the cake, and she goes, ‘Wow… how original.’ Out loud. And she refused a slice! Said she didn't even like Costco cake!'",
                textFemale: "'She walked into the breakroom, saw it, and just said 'Wow, original' loud enough for everyone to hear. Then she refused to have a slice, said she doesn't even like it.'",
                choices: [
                    { text: "But... she just bought one for herself?", nextId: 2006 },
                    { text: "The drama!", nextId: 2006 }
                ]
            },
            {
                id: 2006,
                text: "'GIRL, PLEASE. You had three slices of your own Costco cake last month, don’t play! And babe, this is not the first time. Listen to this. Heather and Danielle have this whole blouse situation.'",
                textFemale: "'Right? Total hypocrite. And it gets worse. This isn't the first time. They have this thing with the same blouse.'",
                choices: [
                    { text: "A blouse situation?", nextId: 2007 }
                ]
            },
            {
                id: 2007,
                text: "'THREE times they’ve shown up in the exact same top. Not like, ‘oh that’s similar,’ I mean the same black-and-white striped Target blouse. The third time it happened? Heather spilt coffee on herself on purpose and went home to change.'",
                textFemale: "'Three times now, they've worn the exact same striped shirt from Target on the same day. The last time it happened, Heather 'accidentally' spilled coffee on herself so she could go home and change.'",
                choices: [
                    { text: "She's unhinged. I love it.", nextId: 2008 },
                    { text: "So what's the deal? Does Danielle have a secret shrine to Heather?", nextId: 2008 }
                ]
            },
            {
                id: 2008,
                text: "'That's what Heather thinks! She told Kelly that Danielle is ‘obsessed’ with her, which is insane. Like… obsessed with what? Buying normal clothes and sheet cakes from Costco? Congratulations, you’re middle America.'",
                textFemale: "'Heather is convinced Danielle is obsessed with her. It's ridiculous. They both just shop at Target.'",
                choices: [
                    { text: "So what did Danielle do?", nextId: 2009 }
                ]
            },
            {
                id: 2009,
                text: "'Danielle knows Heather’s spiraling, so she goes all fake sweet, like, ‘Oh, I didn’t realize you got your cake from Costco too, small world!’ and Heather almost combusted. Danielle serving for real.'",
                textFemale: "'Danielle knows it gets under Heather's skin, so she's super sweet about it. She was like 'Oh, small world!' when Heather mentioned the cake. Heather looked like she was gonna explode.'",
                choices: [
                    { text: "This is the best story I've ever heard.", nextId: 2010 },
                    { text: "I am living for this.", nextId: 2010 }
                ]
            },
            {
                id: 2010,
                text: "'Now the whole office is joking about it and I hope someone wears the blouse again next week.' Your partner sits back, a satisfied grin on their face.",
                textFemale: "'The whole office is making jokes about it now. It's hilarious.' Your partner sits back, a satisfied grin on his face.",
                choices: [{ text: "What a night.", nextId: 2011 }]
            },
            {
                id: 2011,
                text: "After the story, you pass a vintage movie theater with a brightly lit marquee. They're playing a one-night-only screening of a classic romantic movie.",
                choices: [ { text: "Want to go see it?", nextId: 2013 }, { text: "Nah, let's stick to the plan.", nextId: 3000 } ]
            },
            {
                id: 2013,
                text: "You both go inside. The theater is old and beautiful. You share a large popcorn, whispering jokes to each other during the previews and holding hands through the whole film. It's perfect.",
                choices: [{ text: "This was a great idea.", nextId: 2014 }]
            },
            {
                id: 2014,
                text: "Leaving the theater, your partner squeezes your hand. 'That was the most romantic, spontaneous thing we've done in ages,' they say. The mood is set for the rest of the night.",
                choices: [{ text: "Time to head home.", nextId: 3000 }]
            },
            { id: 2020, text: "'That's not even the weirdest thing that happened today,' you say, pulling out the silver dollar. 'I met this weirdly smart cat...' You tell the story. Your partner is captivated. 'So you're saying a cat gave you a lucky coin? That's amazing.'", setState: { silverDollar: false }, choices: [{ text: "Now tell me about the work tea.", nextId: 2000 }] },
            { id: 2022, text: "You pull out the old casino chip. 'Look what I found in a dusty old room at the bank.' Your partner's eyes light up. 'No way! The River Palace? My grandpa used to tell stories about that place.' It sparks a long conversation about what your town used to be like.", setState: { oldCasinoChip: false }, choices: [{ text: "Anyway, you mentioned some drama...", nextId: 2000 }] },
            { id: 2024, text: "You show them the worn guitar pick. 'Found this today. I was thinking maybe I should start playing again.' Your partner smiles. 'You totally should! I loved hearing you play.' It's a sweet, supportive moment.", setState: { guitarPick: false }, choices: [{ text: "So, about this work tea...", nextId: 2000 }] },
            { id: 2026, text: "'You're not going to believe the weird day I had,' you begin, pulling out the silver locket. 'I met this strange old man in a diner...' You recount the story. Your partner is enthralled. 'A hidden treasure? That's incredible! What do you think the story is behind it?'", setState: { silverLocket: false }, choices: [{ text: "Anyway, you were saying about work?", nextId: 2000 }] },
            { id: 2027, text: "You pull out the torn magazine page with a laugh. 'By the way, I was *this close* to wearing this tonight.' He looks at the absurd outfit and bursts out laughing. 'You would have shut the whole place down. I love your sense of humor.'", setState: { magazinePage: false }, choices: [{ text: "Alright, for real, what's the tea?", nextId: 2000 }] },
            { id: 2028, text: "You pull out the small silver locket you found. 'I have something for you.' Her eyes go wide. 'Oh my gosh, it's beautiful. Where did you get this?' You tell her the story of the old man and the diner. She's completely enchanted. 'It's a story and a gift all in one,' she says, her eyes shining. 'Thank you.'", setState: { silverLocket: false }, choices: [{ text: "Now, what was this about work tea?", nextId: 2000 }] },

            // --- FLAT TIRE & SEDUCTION PATH ---
            {
                id: 3000,
                text: "You walk out to her car, but as you approach, you both see it: the rear passenger-side tire is completely, hopelessly flat. 'You've got to be kidding me,' she groans.",
                textFemale: "You walk out to his car, but as you approach, you both see it: the rear passenger-side tire is completely, hopelessly flat. 'You've got to be kidding me,' he groans.",
                choices: [{ text: "Well, looks like you're riding with me.", textFemale: "Well, I guess I'm riding with you.", nextId: 3001 }]
            },
            {
                id: 3001,
                text: "She gets in your truck, a little closer than usual. The cab is filled with her perfume. The drive back to your place is quiet at first, the streetlights painting stripes across her face.",
                textFemale: "You get in his truck, a little closer than usual. The cab smells like his cologne. The drive back to your place is quiet at first, the streetlights painting stripes across his face.",
                choices: [
                    { text: "'I had such a great time tonight. That place is boss.'", nextId: 3002 },
                    { text: "'It's crazy how hot you are, just like, all the time.'", textFemale: "Compliment him back. 'It's crazy how handsome you are.'", nextId: 3003 },
                    { text: "'The waiter was cool... I like that dark oil stuff he brought.'", textFemale: "'The waiter was cool... I like that dark oil stuff he brought.'", nextId: 3004 },
                    { text: "Hand her the aux cord.", textFemale: "Ask for the aux cord.", nextId: 3005 },
                    { text: "Let's stop for gas and snacks.", textFemale: "Suggest stopping for gas and snacks.", nextId: 3100 }
                ]
            },
            {
                id: 3002,
                text: "'I did too,' she says, smiling. 'It was perfect.' She scoots a little closer on the bench seat.",
                textFemale: "'I did too,' he says, smiling. 'It was perfect.' He scoots a little closer.",
                choices: [{ text: "Continue driving...", nextId: 3006 }]
            },
            {
                id: 3003,
                text: "She blushes, a real, genuine blush. 'Stop,' she says, but she's smiling. 'You're not so bad yourself.' She puts her hand on your thigh.",
                textFemale: "He grins, a real, genuine grin. 'Oh yeah?' he says, his voice a little lower. 'You're not so bad yourself.' He puts his hand on your thigh.",
                choices: [{ text: "Continue driving...", nextId: 3006 }]
            },
            {
                id: 3004,
                text: "She laughs, a bright, clear sound. 'You mean the balsamic vinegar?' she asks, playfully. 'You're such a dork.'",
                textFemale: "'You mean the balsamic vinegar?' he asks, laughing. 'You're such a dork.'",
                choices: [{ text: "Continue driving...", nextId: 3006 }]
            },
            {
                id: 3005,
                text: "You hand her the aux cord. A moment later, a slow, moody song fills the truck. She knows exactly what she's doing.",
                textFemale: "He hands you the aux cord. A moment later, a slow, moody song fills the truck. He knows exactly what he's doing.",
                choices: [{ text: "Continue driving...", nextId: 3006 }]
            },
            {
                id: 3006,
                text: "The mood in the truck is thick with unspoken energy. The city lights blur past.",
                choices: [ { text: "Just enjoy the silence and the music.", nextId: 3200 } ]
            },
            {
                id: 3007,
                text: "'Oh, please,' she says, but you can tell she's pleased. 'It's awesome having such a gorgeous girlfriend, isn't it?' She winks.",
                textFemale: "'Oh, please,' he says, but you can tell he's pleased. 'It's awesome having such a handsome boyfriend, isn't it?' He winks.",
                choices: [{ text: "Almost home...", nextId: 3200 }]
            },
            {
                id: 3008,
                text: "'Want a piece of gum?' you ask, holding out the pack. She takes one with a smile. 'Thanks, babe.'",
                textFemale: "'Want a piece of gum?' he asks, holding out the pack. You take one with a smile. 'Thanks, babe.'",
                setState: { gum: false },
                choices: [{ text: "Continue the drive...", nextId: 3006 }]
            },
            {
                id: 3009,
                text: "'I got you these,' you say, handing her her favorite candy. Her face lights up. 'You remembered!'",
                textFemale: "'I got you these,' he says, handing you your favorite candy. Your face lights up. 'You remembered!'",
                setState: { candy: false },
                choices: [{ text: "Continue the drive...", nextId: 3006 }]
            },
            {
                id: 3010,
                text: "You slide the old CD into the player. After a moment of whirring, the speakers boom with the iconic beat of a classic 2000s gangster rap song. She looks surprised, then breaks into a huge grin. 'No way! I LOVE this song!' She starts rapping along, and you both spend the rest of the drive laughing and enjoying the hits.",
                textFemale: "He slides the old CD into the player. After a moment of whirring, the speakers boom with the iconic beat of a classic 2000s gangster rap song. You look surprised, then break into a huge grin. 'No way! I LOVE this song!' You start rapping along, and you both spend the rest of the drive laughing and enjoying the hits.",
                setState: { mixCD: false },
                choices: [{ text: "Continue the drive...", nextId: 3006 }]
            },
            {
                id: 3100,
                text: "You pull into a brightly lit gas station. 'Be right back,' you say, hopping out of the truck.",
                textFemale: "'Be right back,' he says, hopping out of the truck.",
                choices: [{ text: "Go inside.", nextId: 3101 }]
            },
            {
                id: 3101,
                text: "You put $20 of gas in the truck. Inside, you grab a pack of gum, a box of Raw cones, and a blunt wrap. Anything else?",
                textFemale: "He puts $20 of gas in the truck. He comes back from inside with a pack of gum, a box of Raw cones, and a blunt wrap.",
                setState: { cones: true, bluntWrap: true, gum: true },
                choices: [
                    { text: "Get some candy.", textFemale: "Ask him to get your favorite candy.", nextId: 3102 },
                    { text: "No, that's good.", nextId: 3103 }
                ]
            },
            {
                id: 3102,
                text: "You grab a bag of her favorite candy. You know the way to her heart.",
                textFemale: "He comes back with a bag of your favorite candy. He knows the way to your heart.",
                setState: { candy: true },
                choices: [{ text: "Head back to the truck.", nextId: 3103 }]
            },
            {
                id: 3103,
                text: "You get back in the truck with your supplies. She gives you a knowing smile as you pull back onto the road.",
                textFemale: "He gets back in the truck with the supplies. You give him a knowing smile as he pulls back onto the road.",
                choices: [{ text: "Now, where were we...", nextId: 3006 }]
            },
            {
                id: 3200,
                text: "You pull up to your apartment. You kill the engine, and the sudden silence is heavy. You both look at each other, the question hanging in the air.",
                textFemale: "He pulls up to his apartment. He kills the engine, and the sudden silence is heavy. You both look at each other, the question hanging in the air.",
                choices: [{ text: "Let's go inside.", nextId: 4000 }]
            },

            // --- SEX SCENE PART 1 ---
            {
                id: 4000,
                text: "You unlock the door and step inside, the tension from the car following you in. As the door clicks shut, you turn to each other. Without a word, you close the distance and your lips meet in a deep, hungry kiss.",
                textFemale: "He unlocks the door and you step inside, the tension from the car following you in. As the door clicks shut, you turn to each other. Without a word, he closes the distance and your lips meet in a deep, hungry kiss.",
                choices: [
                    { text: "Raise your hand to her face as you kiss.", textFemale: "Raise your hand to his face as you kiss.", nextId: 4001 },
                    { text: "Move your hands down her sides slowly.", textFemale: "Move your hands down his sides slowly.", nextId: 4002 },
                    { text: "Reach down and grab her leg, pulling it up to your waist.", textFemale: "Wrap your leg around his waist.", nextId: 4003 },
                    { text: "Lock your hands behind her back and pull her in.", textFemale: "Lock your hands behind his back and pull him in.", nextId: 4004 }
                ]
            },
            {
                id: 4001,
                text: "As you kiss, you slowly raise your hand to her face, your thumb gently caressing her cheekbone. She leans into your touch, a soft sigh escaping her lips.",
                textFemale: "As you kiss, you slowly raise your hand to his face, your thumb gently caressing his cheekbone. He leans into your touch, a soft sigh escaping his lips.",
                choices: [
                    { text: "Pick her up and hold her.", textFemale: "Leap into his arms.", nextId: 4100 },
                    { text: "Spin her around against the door.", textFemale: "Let him press you against the door.", nextId: 4200 },
                    { text: "Kiss down her neck.", textFemale: "Kiss down his neck.", nextId: 4300 }
                ]
            },
            {
                id: 4002,
                text: "Your hands find her waist, tracing the curve of her hips and moving slowly down her sides. You can feel the warmth of her skin through her clothes.",
                textFemale: "His hands find your waist, tracing the curve of your hips and moving slowly down your sides. You can feel the warmth of his touch through your clothes.",
                choices: [
                    { text: "Pick her up and hold her.", textFemale: "Leap into his arms.", nextId: 4100 },
                    { text: "Spin her around against the door.", textFemale: "Let him press you against the door.", nextId: 4200 },
                    { text: "Kiss down her neck.", textFemale: "Kiss down his neck.", nextId: 4300 }
                ]
            },
            {
                id: 4003,
                text: "Your right hand slides down her thigh, gripping it firmly and pulling her leg up to wrap around your waist. The sudden intimacy makes her gasp against your mouth.",
                textFemale: "You wrap your leg around him, pulling him impossibly closer. The sudden intimacy makes him gasp against your mouth.",
                choices: [
                    { text: "Pick her up and hold her.", textFemale: "Leap into his arms.", nextId: 4100 },
                    { text: "Spin her around against the door.", textFemale: "Let him press you against the door.", nextId: 4200 },
                    { text: "Kiss down her neck.", textFemale: "Kiss down his neck.", nextId: 4300 }
                ]
            },
            {
                id: 4004,
                text: "You lock your hands behind the small of her back, pulling her body flush against yours. There is absolutely no space between you now.",
                textFemale: "You lock your hands behind the small of his back, pulling his body flush against yours. There is absolutely no space between you now.",
                choices: [
                    { text: "Pick her up and hold her.", textFemale: "Leap into his arms.", nextId: 4100 },
                    { text: "Spin her around against the door.", textFemale: "Let him press you against the door.", nextId: 4200 },
                    { text: "Kiss down her neck.", textFemale: "Kiss down his neck.", nextId: 4300 }
                ]
            },
            {
                id: 4100,
                text: "You break the kiss just long enough to scoop her up into your arms. Her legs instinctively wrap around your waist as you kiss her again, deeper this time. Her skirt rides up to her hips, and your hand finds her smooth, bare thigh. You give it a gentle squeeze and playfully bite her lip.",
                textFemale: "He breaks the kiss just long enough to scoop you up into his arms. Your legs instinctively wrap around his waist as he kisses you again, deeper this time. Your skirt rides up to your hips, and his hand finds your smooth, bare thigh. He gives it a gentle squeeze and playfully bites your lip.",
                choices: [
                    { text: "Carry her to the bedroom.", nextId: 5001 },
                    { text: "Carry her to the couch.", nextId: 5000 }
                ]
            },
            {
                id: 4200,
                text: "In one fluid motion, you spin her around so her back is pressed against the door. You press your body against hers, leaving no space between you. Your hand glides up from her waist, feeling her taut midsection, slowly moving up to her breast. You gently press it as your hand passes over, reaching its destination at her jaw. Your thumb caresses her lip. 'You are perfect in every way,' you whisper, before kissing her again.",
                textFemale: "In one fluid motion, he spins you around so your back is pressed against the door. He presses his body against yours, leaving no space between you. His hand glides up from your waist, feeling your taut midsection, slowly moving up to your breast. He gently presses it as his hand passes over, reaching its destination at your jaw. His thumb caresses your lip. 'You are perfect in every way,' he whispers, before kissing you again.",
                choices: [
                    { text: "Slowly start unbuttoning her blouse.", textFemale: "Help him unbutton his shirt.", nextId: 5000 },
                    { text: "Slide your hand into her hair.", textFemale: "Slide your hand into his hair.", nextId: 5000 }
                ]
            },
            {
                id: 4300,
                text: "Your lips leave hers and trail down the side of her neck, finding the sensitive spot just below her ear. She tilts her head, giving you better access, her fingers tangling in your hair.",
                textFemale: "His lips leave yours and trail down the side of your neck, finding the sensitive spot just below your ear. You tilt your head, giving him better access, your fingers tangling in his hair.",
                choices: [
                    { text: "Lift her up onto the nearby kitchen counter.", textFemale: "Let him lift you onto the kitchen counter.", nextId: 5000 },
                    { text: "Let your hands roam her back.", textFemale: "Let your hands roam his back.", nextId: 5000 }
                ]
            },

            // --- SEX SCENE PART 2 & MORNING AFTER ---
            {
                id: 5000,
                text: "The passion of the moment completely takes over, a whirlwind of touch and sensation. It's clear where this is heading.",
                textFemale: "The passion of the moment completely takes over, a whirlwind of touch and sensation. It's clear where this is heading.",
                choices: [{text: "Move things to the bedroom.", textFemale: "Let him lead you to the bedroom.", nextId: 5001}]
            },
            {
                id: 5001,
                text: "You pull back from the kiss, your foreheads touching. Your breathing is heavy.",
                textFemale: "He pulls back from the kiss, your foreheads touching. Your breathing is heavy.",
                choices: [
                    { text: "'Come on, let's head to the bedroom.'", textFemale: "Take his hand and lead him to the bedroom.", nextId: 5002 },
                    { text: "'I need you in there. Now.'", textFemale: "Whisper 'I need you.'", nextId: 5002 },
                    { text: "Just look her in the eyes and guide her to the bedroom.", textFemale: "Just look him in the eyes and walk towards the bedroom.", nextId: 5002 }
                ]
            },
            {
                id: 5002,
                text: "You lead her into the bedroom. The air is electric. You stand beside the bed, the moonlight from the window casting a soft glow over the room.",
                textFemale: "He leads you into his bedroom. The air is electric. You stand beside the bed, the moonlight from the window casting a soft glow over the room.",
                choices: [
                    { text: "Lift her up and gently place her on the bed.", textFemale: "Let him lift you onto the bed.", nextId: 5003 },
                    { text: "You lay on the bed first.", textFemale: "You lay on the bed first, beckoning him.", nextId: 5003 },
                    { text: "Caress her side as you kiss her neck.", textFemale: "He caresses your side as he kisses your neck.", nextId: 5003 }
                ]
            },
            {
                id: 5003,
                text: "You both end up on the bed, tangled in each other's arms, the world outside fading away completely. You get into the bed, pulling the covers over you both. You look deeply into her eyes, they are locked on yours.",
                textFemale: "You both end up on the bed, tangled in each other's arms, the world outside fading away completely. You get into the bed, pulling the covers over you both. He looks deeply into your eyes, they are locked on his.",
                choices: [
                    { text: "'I love you more than anything in this world.'", nextId: 5004 },
                    { text: "'You are perfect in every way.'", nextId: 5004 },
                    { text: "Say nothing, just stare at her.", textFemale: "Say nothing, just stare at him.", nextId: 5004 }
                ]
            },
            {
                id: 5004,
                text: "A slow, beautiful smile spreads across her face. 'I love you, too,' she whispers.",
                textFemale: "A slow, beautiful smile spreads across his face. 'I love you, too,' he whispers.",
                choices: [{ text: "The night fades away...", nextId: 6000 }]
            },
            {
                id: 6000,
                text: "You wake up late the next morning, the sun streaming through the blinds. She's still asleep, her head on your chest. Last night was amazing. You feel a deep sense of peace and happiness. After a while, she stirs.",
                textFemale: "You wake up late the next morning, the sun streaming through the blinds. He's still asleep beside you. Last night was amazing. You feel a deep sense of peace and happiness. After a while, he stirs.",
                choices: [{ text: "'Morning, sleepyhead.'", nextId: 6001 }]
            },
            {
                id: 6001,
                text: "'Morning,' she says, her voice husky. 'Last night was... wow.' You both share a smile. 'I'm starving,' she adds.",
                textFemale: "'Morning,' he says, his voice husky. 'Last night was... wow.' You both share a smile. 'I'm starving,' he adds.",
                choices: [
                    { text: "Breakfast (Eggs/Toast)", nextId: 6002 },
                    { text: "Breakfast (Cereal)", nextId: 6002 },
                    { text: "Breakfast (Oatmeal)", nextId: 6002 },
                    { text: "Coffee Only", nextId: 6002 }
                ]
            },
            {
                id: 6002,
                text: "After a lazy breakfast filled with laughter and talk about your amazing date, you remember the problem. 'Oh, right... your car,' you say.",
                textFemale: "After a lazy breakfast filled with laughter and talk about your amazing date, you remember the problem. 'Oh, right... your car,' he says.",
                choices: [{ text: "What should we do about the flat tire?", nextId: 6003 }]
            },
            {
                id: 6003,
                text: "You both think for a moment. Her car is still sitting in the restaurant parking lot with a very flat tire.",
                textFemale: "You both think for a moment. His car is still sitting in the restaurant parking lot with a very flat tire.",
                choices: [
                    { text: "Call AAA. They can handle it.", nextId: 6004 },
                    { text: "I can fix it. It'll just take a while.", nextId: 6005 },
                    { text: "Let's just get you an Uber for now.", textFemale: "Let's just get me an Uber for now.", nextId: 6006 }
                ]
            },
            {
                id: 6004,
                text: "You call AAA. After a long phone call, it's sorted. They'll tow the car to her place and have a new tire on it within 4 hours. It costs you a hefty $430. 'Thanks for handling that,' she says, giving you a kiss. 'Today was perfect.'",
                textFemale: "He calls AAA. After a long phone call, it's sorted. They'll tow the car to his place and have a new tire on it within 4 hours. It costs him a hefty $430. 'Thanks for handling that,' you say, giving him a kiss. 'Today was perfect.'",
                choices: [{ text: "Time for the grand finale.", nextId: 12000 }]
            },
            {
                id: 6005,
                text: "You decide to handle the tire yourself. It's the chivalrous thing to do.",
                choices: [{ text: "Time to get this sorted.", nextId: 8000 }]
            },
            {
                id: 6006,
                text: "You order her an Uber to get her home safely. While you wait, you reminisce about the incredible date. 'Don't worry about the car, I'll take care of it,' you promise. She gives you a long, passionate kiss. 'Thank you for everything. Last night was incredible.'",
                textFemale: "He orders you an Uber to get you home safely. While you wait, you reminisce about the incredible date. 'Don't worry about the car, I'll take care of it,' he promises. He gives you a long, passionate kiss. 'Thank you for everything. Last night was incredible.'",
                choices: [{ text: "Head home and relax for the day.", nextId: 11000 }]
            },
            {
                id: 6007,
                text: "You spend the rest of the day relaxing, basking in the afterglow of a perfect date. Around 5pm, you get a text from AAA: 'Your boyfriend's car is on its way to his apartment now.'",
                choices: [{ text: "Let him know and head over.", nextId: 6008 }]
            },
            {
                id: 6008,
                text: "You shoot him a text and head over to his place to meet the tow truck and pay the driver. It's a sweet end to a chaotic, wonderful day.",
                choices: [{ text: "Time for the grand finale.", nextId: 12000 }]
            },
            { id: 6009, text: "You remember Steve's business card. You give him a call. 'Hey Steve, it's me from the bank. Funny story...' He laughs and says he'll send his brother-in-law over. The tow and repair costs the same as AAA, a hefty $430, but you feel good giving the business to a friend-of-a-friend. 'Thanks for the hookup!' you text your boyfriend.", choices: [{ text: "Time for the grand finale.", nextId: 12000 }] },
            { id: 6010, text: "'Want me to pack a few cones for the road?' you ask, pulling out the package you bought last night. 'I got these at the gas station.'", choices: [ { text: "Yeah, that sounds perfect.", nextId: 6011 }, { text: "No thanks, I'm good for now.", nextId: 6003 } ] },
            { id: 6011, text: "You pack a couple of cones for her to take with her. She smiles. 'You're the best.'", setState: { cones: false }, choices: [{ text: "Now, about that car...", nextId: 6003 }] },

            // --- "GETTING READY" SEQUENCE ---
            { id: 7000, text: "Routing to your getting ready sequence...", choices: [] },
            // MALE PATH
            { id: 7001, text: "You get home with plenty of time to get ready. First things first, time to clean up.", choices: [{ text: "Take a quick shower.", nextId: 7002 }, { text: "Nah, a little deodorant will do.", nextId: 7002 }] },
            { id: 7002, text: "You look in the mirror. Your facial hair is a little scruffy.", choices: [{ text: "Shave it clean.", nextId: 7003 }, { text: "Leave the whiskers. It's a look.", nextId: 7003 }] },
            { id: 7003, text: "Time for cologne. What's the vibe tonight?", choices: [{ text: "A heavy, musky cologne.", nextId: 7004 }, { text: "A light, fresh cologne.", nextId: 7004 }] },
            { id: 7004, text: "Now for the outfit. You want to look good tonight.", choices: [
                { text: "Wear a black polo shirt and grey pants.", nextId: 7100 },
                { text: "Wear a long sleeve light grey sweater and tan pants.", nextId: 7100 },
                { text: "Wear a black t-shirt with a nice jacket and grey pants.", nextId: 7100 }
            ]},
            { id: 7005, text: "You look sharp. All ready to go. One last thing to consider...", choices: [{ text: "Stop and buy flowers on the way.", nextId: 7006 }, { text: "No flowers, just head straight there.", nextId: 90000 }] },
            { id: 7006, text: "You make a quick stop at a local grocery store. They have a decent selection of bouquets. A nice touch. How are you paying?", choices: [{ text: "Pay with cash (keep some for a tip).", nextId: 7007 }, { text: "Pay with card.", nextId: 7007 }] },
            { id: 7007, text: "Flowers in hand, you're ready to go meet your date. You feel confident and excited.", choices: [{ text: "Head to the date.", nextId: 90000 }] },
            // FEMALE PATH
            { id: 7010, text: "You get home with plenty of time. A little pampering is in order before your date.", choices: [{ text: "Take a long, relaxing shower.", nextId: 7011 }, { text: "Just a quick touch-up is fine.", nextId: 7011 }] },
            { id: 7011, text: "You stand in front of your huge perfume collection. What's the scent for tonight?", choices: [
                { text: "A light and balanced perfume.", nextId: 7012 },
                { text: "A deep floral scent.", nextId: 7012 },
                { text: "A spicy and sweet perfume.", nextId: 7012 }
            ]},
            { id: 7012, text: "Perfect. Now for the killer outfit.", choices: [
                { text: "The silk slip dress in deep emerald.", nextId: 7110 },
                { text: "The bright pink mini dress.", nextId: 7110 },
                { text: "The high-waisted leather skirt with a satin blouse.", nextId: 7110 }
            ]},
            { id: 7013, text: "You look absolutely stunning. You check yourself in the mirror one last time before heading out.", choices: [{ text: "Head to the date.", nextId: 90000 }] },

            // --- GROUP CHAT PATHS ---
            { id: 7100, text: "You're dressed and about to head out when your phone buzzes. It's a text from your friend Aaron in the group chat: 'Boys, me and Ian just shot -4 and -5 at the outing today. We're basically pros.'", choices: [
                { text: "Damn boys that's legit", nextId: 7101 },
                { text: "Send a GIF of Tim Robinson squinting.", nextId: 7102 },
                { text: "I figured you boys would be in the sub 6's like me in no time.", nextId: 7103 }
            ]},
            { id: 7101, text: "Aaron replies instantly: 'lol for real'. You chuckle and put your phone away.", choices: [{ text: "Time to go.", nextId: 7200 }] },
            { id: 7102, text: "Ian replies with a GIF of a guy furiously typing on a tiny keyboard. Aaron sends one of a cat looking shocked. You reply with a GIF of a spinning hot dog. Ian sends a trophy GIF. The war is won. You laugh.", choices: [{ text: "Okay, for real this time.", nextId: 7200 }] },
            { id: 7103, text: "Ian replies: 'lol you've never shot under par in your life'. He's right, but it's funny. You put your phone away.", choices: [{ text: "Time to go.", nextId: 7200 }] },
            { id: 7110, text: "You look amazing. As you're grabbing your purse, your phone buzzes. It's a text from your friend Tammy in the group chat: 'omg you will never beleive what tyler got me, a great dane puppy!'", choices: [
                { text: "oh wow how cute, girl or boy whats the name?", nextId: 7111 },
                { text: "those dogs get huge, you live in a studio apartment", nextId: 7112 },
                { text: "thats great haha", nextId: 7113 }
            ]},
            { id: 7111, text: "She replies a minute later: 'i know right? his name is goose'. You smile.", choices: [{ text: "Time to go.", nextId: 7200 }] },
            { id: 7112, text: "Tammy replies almost instantly: 'OMG you are so negative, your gonna love him.' You roll your eyes, but smile.", choices: [{ text: "Okay, time to focus.", nextId: 7200 }] },
            { id: 7113, text: "She sends back a bunch of heart emojis and 'his name is goose'.", choices: [{ text: "Time to go.", nextId: 7200 }] },
            { id: 7200, text: "You're almost ready to go. Just need to grab your keys and wallet.", choices: [{ text: "Where did I leave them...", nextId: 7201 }] },
            { id: 7201, text: "You check the usual spots. The kitchen counter, the coffee table... nothing.", choices: [{ text: "Check the junk drawer.", nextId: 7202 }, { text: "Look in your old coat.", nextId: 7203 }] },
            { id: 7202, text: "You rifle through the junk drawer. Amongst old batteries and takeout menus, you find them. You also find a faded, worn-out guitar pick. You remember you used to play a little.", setState: { guitarPick: true }, choices: [{ text: "A memory from another life.", nextId: 7005, nextIdFemale: 7013 }] },
            { id: 7203, text: "You check the pockets of the old coat hanging by the door. There they are. Phew. Tucked into the inner pocket is an old, burned mix CD labeled 'CRUIZIN\' JAMS 2004'. A wave of nostalgia hits you.", setState: { mixCD: true }, choices: [{ text: "Time to go.", nextId: 7005, nextIdFemale: 7013 }] },
            
            // --- TIRE FIXING SEQUENCE ---
            { id: 8000, text: "You order her an Uber. While you wait, you carry her bag out for her. 'I love you, and I had a wonderful time,' you say. 'I'm gonna go fix that tire. I'll text you when I'm done and I'll drop the car off, then we can go get my truck.'", choices: [{ text: "Wait for her reply.", nextId: 8001 }] },
            { id: 8001, text: "'Okay, love you too,' she says as the Uber pulls up. 'Be safe.' The car is waiting.", choices: [{ text: "Open the door for her.", nextId: 8002 }, { text: "Let her get in.", nextId: 8003 }] },
            { id: 8002, text: "You open the car door. The driver, an older man, smiles. 'You don't see that much anymore,' he says. You smile, close the door, and wave as she leaves.", choices: [{ text: "Time to get to work.", nextId: 8004 }] },
            { id: 8003, text: "She gets in the car, blows you a kiss, and is on her way. You wave as the car disappears down the street.", choices: [{ text: "Time to get to work.", nextId: 8004 }] },
            { id: 8004, text: "Alright, time to deal with this tire. It's a bit of a buzzkill, but you're still feeling great from the date.", choices: [{ text: "Smoke a joint before you go.", nextId: 8005 }, { text: "Just head straight over.", nextId: 8006 }] },
            { id: 8005, text: "You light up a joint and take a few puffs to get in the right headspace for some manual labor. You grab an extra one for the road.", choices: [{ text: "Head to the restaurant parking lot.", nextId: 8006 }] },
            { id: 8006, text: "You get to the restaurant parking lot. It's mostly empty now. You pull up next to her car and assess the situation.", choices: [{ text: "Time to jack up the car.", nextId: 8007 }] },
            { id: 8007, text: "Which jack are you going to use?", choices: [{ text: "The heavy floor jack from your truck.", nextId: 8008 }, { text: "The scissor jack in her car's trunk.", nextId: 8009 }] },
            { id: 8008, text: "You haul the heavy floor jack out of your truck. It's a beast to maneuver, but it's reliable. You get it in position under the car frame.", choices: [{ text: "Jack it up.", nextId: 8010 }] },
            { id: 8009, text: "You pop her trunk. It's held down by a stubborn zip tie. You spend a few frustrating minutes trying to wrestle it free, busting your knuckles against the trunk latch in the process. A little blood wells up.", choices: [{ text: "Okay, ow. Jack up the car.", nextId: 8010 }] },
            { id: 80091, text: "You pop her trunk. It's held down by a stubborn zip tie. No problem. You pull out your pocket knife and cleanly slice it open. Easy. You get the jack out without any trouble.", choices: [{ text: "Time to jack up the car.", nextId: 8010 }] },
            { id: 8010, text: "With the car safely jacked up, you get the lugs off and pull the wheel off. You quickly find the culprit: a small, sharp nail. You pull it out with your pliers. Now, to find the tire patch kit in your truck...", choices: [
                { text: "Check the glovebox.", nextId: 8011 },
                { text: "Check the center console.", nextId: 8012 },
                { text: "Look in the storage under the back seat.", nextId: 8013 }
            ]},
            { id: 8011, text: "You rummage through the glovebox. No patch kit, but you do find a forgotten Starbucks gift card with a few bucks on it. Score.", setState: { giftCard: true }, choices: [{ text: "Okay, where else...", nextId: 8010 }] },
            { id: 8012, text: "You check the center console. No kit, but you find a pack of gum. You pop a piece in your mouth.", setState: { gum: true }, choices: [{ text: "Okay, where else...", nextId: 8010 }] },
            { id: 8013, text: "You lift the back seat and there it is. The trusty tire plug kit. You also spot an old shirt you forgot you had. Nice.", setState: { tirePlugs: true }, choices: [{ text: "Got it. Time to plug this thing.", nextId: 8014 }] },
            { id: 8014, text: "You get the sticky plug ready and ream the hole. This is the hard part: forcing the plug into the tire.", choices: [
                { text: "Wedge the tire against the truck for leverage.", nextId: 8015 },
                { text: "Sit on the tire and try to press it straight down.", nextId: 8016 }
            ]},
            { id: 8015, text: "You prop the tire against your truck's frame and use your body weight. With a grunt, the plug pops into place. Easy enough.", choices: [{ text: "Perfect. Now to fill it up.", nextId: 8017 }] },
            { id: 8016, text: "You sit on the tire, trying to get enough downward force. The tire wobbles, and the sticky patch goop smears all over your pant leg. The plug goes in crooked and fails. You curse, pull it out, and have to use the truck for leverage anyway. It works, but now your pants are stained.", choices: [{ text: "Finally. Now to fill it up.", nextId: 8017 }] },
            { id: 8017, text: "You get the portable air pump from your truck, plug it into the cigarette lighter, and fill the tire. It stops at a perfect 32 PSI. You put the wheel back on, lower the car, and tighten the lugs. All done.", choices: [{ text: "Job's finished. What about this mess?", nextId: 8018 }] },
            { id: 8018, text: "You look at the jacks, the tools, the patch kit wrappers.", choices: [{ text: "Toss everything in the back of the truck and leave.", nextId: 8019 }, { text: "Clean it all up properly.", nextId: 8020 }] },
            { id: 8019, text: "You quickly throw all the tools into the bed of your truck and hop in. You send a quick text: 'Car is all set. On my way to drop it off!'", choices: [{ text: "Time for the grand finale.", nextId: 12000 }] },
            { id: 8020, text: "You take a few extra minutes to put everything back in its proper place. As you're finishing up, a couple of teenagers skateboard into the parking lot. They see you watching them.", choices: [{ text: "'You skate?' one of them asks.", nextId: 8021 }] },
            { id: 8021, text: "They're just kids, full of energy. You can't help but smile.", choices: [
                { text: "'Yeah, a little bit.'", nextId: 8022 },
                { text: "'Nah, not really.'", nextId: 8022 },
                { text: "'Not anymore, but I used to.'", nextId: 8022 }
            ]},
            { id: 8022, text: "'No way! Try a kickflip on this,' the kid says, offering you his board.", choices: [
                { text: "Okay, try a kickflip.", nextId: 8023 },
                { text: "Nah, let's impress them with a tre flip.", nextId: 8023 },
                { text: "Do a 360 shove-it.", nextId: 8024 }
            ]},
            { id: 8023, text: "You pop the board, flick your ankle, and land it cleanly. The kids give you a nod of respect. 'Sick.'", choices: [{ text: "Give the board back.", nextId: 8025 }] },
            { id: 8024, text: "You decide to show off a little. You pop the board and it spins a perfect 360 degrees under your feet before you land bolts. The kids lose their minds. 'WHOA! THAT WAS INSANE!'", choices: [{ text: "Give the board back, legend.", nextId: 8025 }] },
            { id: 8025, text: "You hand the board back with a smile. You feel pretty cool. You shoot your girlfriend a text: 'Car is all set. On my way to drop it off!' What a day.", choices: [{ text: "Time for the grand finale.", nextId: 12000 }] },
            
            // --- SHOPPING & ROUTING ---
            {
                id: 90000,
                text: "You meet up at the mall first. You spend an hour or so browsing the shops, enjoying the pre-date adventure. It's fun and relaxing.",
                textFemale: "You meet up at the mall first. He wants to check out the electronics store while you look for a new top. You spend an hour or so browsing, enjoying the pre-date adventure.",
                choices: [{ text: "Now, on to the main event...", nextId: 90001 }]
            },
            { id: 90001, text: "Heading out...", choices: [] }, // New Router Hub

            // --- LIBRARY ARC ---
            { id: 9000, text: "You decide to be a responsible adult and finally return that library book that's been sitting on your shelf for weeks. First, you have to find it.", choices: [{ text: "Search the apartment.", nextId: 9001 }] },
            { id: 9001, text: "Your apartment is a bit of a mess. Where do you start looking for 'A Brief History of Time'?", choices: [ {text: "Look under the couch.", nextId: 9002}, {text: "Check the kitchen.", nextId: 9003}, {text: "Rummage through the closet.", nextId: 9004} ] },
            { id: 9002, text: "You reach under the couch cushions and feel the familiar hardcover. Success! You also pull out $5 in loose change. A productive search.", setState: { fiveDollars: true }, choices: [{ text: "Time to head to the library.", nextId: 9005 }] },
            { id: 9003, text: "You find the book on the kitchen counter, but it's got a sticky coffee ring on the cover. You wipe it off as best you can.", choices: [{ text: "Time to head to the library.", nextId: 9005 }] },
            { id: 9004, text: "You don't find the book, but you do find an old, incredibly embarrassing photo of yourself from your high school goth phase. You cringe, but pocket it for the memories.", setState: { embarrassingPhoto: true }, choices: [{ text: "Okay, the book must be somewhere else.", nextId: 9001 }] },
            { id: 9005, text: "You get to the library. The librarian is an eccentric old man with a long, white beard. He scans your book. 'Ah, a bit overdue, I see. That'll be a $12 late fee.'", choices: [ {text: "Just pay the fee.", nextId: 9006}, {text: "Try to flirt your way out of it.", nextId: 9007}, {text: "Ask if there's any other way.", nextId: 9008} ] },
            { id: 9006, text: "You sigh and pay the fee. Your conscience is clear. You head home, your errand complete. Later that evening, your phone buzzes.", choices: [{ text: "Check your phone.", nextId: 299 }] },
            { id: 9007, text: "You give him your best smile. 'Is there any way we can... negotiate?' The librarian just chuckles. 'Nice try. I'll knock it down to $6 for the effort.' You pay the reduced fee and head home.", choices: [{ text: "Check your phone later.", nextId: 299 }] },
            { id: 9008, text: "He strokes his beard. 'I'll tell you what. I am the light that cannot be seen, the story that cannot be told. What am I?'", choices: [ {text: "A secret.", nextId: 9009}, {text: "The future.", nextId: 9010} ] },
            { id: 9009, text: "'Precisely!' the librarian exclaims. 'The fee is waived!' You feel a surge of pride. You head home, victorious. That evening, your phone buzzes.", choices: [{ text: "Check your phone.", nextId: 299 }] },
            { id: 9010, text: "The librarian shakes his head sadly. 'Incorrect. The answer was a secret.' You pay the fee, slightly embarrassed. Later that evening, your phone buzzes.", choices: [{ text: "Check your phone.", nextId: 299 }] },
            
            // --- DINER & DIY ARCS ---
            { id: 10000, text: "You decide to treat yourself to a proper meal. You head to 'The Silver Skillet,' a classic local diner that smells like coffee and bacon.", choices: [{ text: "Order the 'Lumberjack Special'.", nextId: 10001 }] },
            { id: 10001, text: "As you're halfway through a mountain of pancakes, a friendly but rambling old man sits down in your booth uninvited. 'Mind if I join you?' he asks, already settled.", choices: [{ text: "Be polite and listen.", nextId: 10002 }, { text: "Tell him you'd rather eat alone.", nextId: 10003 }] },
            { id: 10002, text: "You listen as he tells you a long story about the diner's 'glory days.' Before he leaves, he winks. 'The original owner, he was a sneaky one. Always said he left a piece of his heart under booth seven.' He points at your booth and then shuffles away.", choices: [{ text: "Check under the booth.", nextId: 10004 }, { text: "He was just a crazy old man.", nextId: 10005 }] },
            { id: 10003, text: "The old man looks a little hurt, but he gets up and leaves you to your meal. The rest of your breakfast is peaceful. As evening sets in, your phone buzzes.", choices: [{ text: "Check your phone.", nextId: 299 }] },
            { id: 10004, text: "When no one's looking, you feel under the seat. Your fingers close around a loose tile. You pry it up and find a small, velvet pouch. Inside is an old but beautiful silver locket.", setState: { silverLocket: true }, choices: [{ text: "What a story. You head home.", nextId: 10005 }] },
            { id: 10005, text: "You finish your breakfast and head home, the weird encounter making for a memorable morning. Later that evening, your phone buzzes.", choices: [{ text: "Check your phone.", nextId: 299 }] },
            { id: 10010, text: "You decide to be productive and finally tackle the wobbly bookshelf that's been annoying you for months. You grab your toolbox but realize you're missing the right size Allen key.", choices: [{ text: "Jury-rig it with a screwdriver.", nextId: 10011 }, { text: "Go to the hardware store.", nextId: 10012 }] },
            { id: 10011, text: "You spend an hour trying to tighten the bolt with the wrong tool, stripping the screw and making the wobble even worse. Frustrated, you give up. The bookshelf will have to wait. Later, your phone buzzes.", choices: [{ text: "Check your phone.", nextId: 299 }] },
            { id: 10012, text: "You head to Middletown Hardware. While looking for the Allen key set, you see a display of vintage-style pocket knives. One with a simple wooden handle catches your eye.", choices: [{ text: "Buy the classic pocket knife.", nextId: 10013 }, { text: "Just get the Allen keys.", nextId: 10014 }] },
            { id: 10013, text: "You buy the knife. It feels solid and well-made in your hand. You also grab the Allen keys.", setState: { pocketKnife: true }, choices: [{ text: "Head home to finish the job.", nextId: 10014 }] },
            { id: 10014, text: "You get home, and with the proper tool, you fix the bookshelf in under five minutes. It's perfectly stable. You feel a surge of accomplishment. Later that evening, your phone buzzes.", choices: [{ text: "Check your phone.", nextId: 299 }] },
            
            // --- Placeholder & Ending Nodes ---
            { id: 10020, text: "You call Tammy to chat. You spend an hour on the phone laughing about the latest drama in your friend group. It's a nice, relaxing way to spend the day off. Later that evening, your phone buzzes.", choices: [{ text: "Check your phone.", nextId: 299 }] },
            { id: 10025, text: "You hit up the Taco Bell drive-through. A Cheesy Gordita Crunch never disappoints. You eat in your car while listening to a podcast. It's a simple pleasure. Later that evening, your phone buzzes.", choices: [{ text: "Check your phone.", nextId: 299 }] },
            { id: 10030, text: "You wander into the pet store. The puppies are adorable and you spend a solid thirty minutes just watching them play. You manage to resist the urge to take one home. Later that evening, your phone buzzes.", choices: [{ text: "Check your phone.", nextId: 299 }] },
            { id: 10035, text: "You decide to give yourself a manicure. You pull out your nail polish and put on a show while you carefully paint a cool design. They look great! You feel put-together and ready for your date.", choices: [{ text: "Time to go.", nextId: 7110 }] },
            { id: 11000, text: "You spend the rest of the day in a happy haze, replaying the perfect date in your mind. It's a day you won't forget anytime soon. THE END.", choices: [{ text: "Play Again", nextId: 1 }] },
            { id: 12000, text: "After a long and eventful day, you finally meet up with your partner again. The car is fixed, the adventure is over, and you're both exhausted but happy. It was a day for the books. THE END.", choices: [{ text: "Play Again", nextId: 1 }] }
        ];

        const welcomeScreen = document.getElementById('welcome-screen');
        const gameContainer = document.getElementById('game-container');
        const colorSelectionScreen = document.getElementById('color-selection-screen');
        const usernameInput = document.getElementById('username-input');
        const startButton = document.getElementById('start-button');
        const resetButton = document.getElementById('reset-button');
        const storyTextElement = document.getElementById('story-text');
        const choicesContainerElement = document.getElementById('choices-container');
        const playerNameElement = document.getElementById('player-name');
        const genderSelectionContainer = document.getElementById('gender-selection');
        const maleButton = document.getElementById('male-button');
        const femaleButton = document.getElementById('female-button');
        const inventoryContainer = document.getElementById('inventory-container');
        const inventoryList = document.getElementById('inventory-list');

        let currentUser = '';
        let playerGender = '';
        let playerState = {};

        const defaultPlayerState = { 
            hasKey: false, hasCoins: false, wearsHawaiianShirt: false, hasGlock: false, hasCarInfo: false,
            giftCard: false, tirePlugs: false, gum: false, cones: false, bluntWrap: false, candy: false,
            lotteryTicket: false, bossMug: false, stevesCard: false, embarrassingPhoto: false, heardGossip: false,
            fiveDollars: false, silverDollar: false, oldCasinoChip: false, guitarPick: false, silverLocket: false, pocketKnife: false,
            postReadyNodeId: null, mixCD: false // Added mixCD to the default state
        };

        const themes = {
            default: { bg: 'bg-slate-900', container: 'bg-slate-800', text: 'text-slate-200', subtleText: 'text-slate-400', primaryBtn: 'bg-indigo-600 hover:bg-indigo-700', secondaryBtn: 'bg-slate-700 hover:bg-indigo-600', input: 'bg-slate-700', border: 'border-slate-700' },
            green: { bg: 'bg-green-900', container: 'bg-green-800', text: 'text-white', subtleText: 'text-green-200', primaryBtn: 'bg-lime-500 hover:bg-lime-600', secondaryBtn: 'bg-green-700 hover:bg-lime-500', input: 'bg-green-700', border: 'border-green-700' },
            blue: { bg: 'bg-blue-900', container: 'bg-blue-800', text: 'text-white', subtleText: 'text-blue-200', primaryBtn: 'bg-sky-500 hover:bg-sky-600', secondaryBtn: 'bg-blue-700 hover:bg-sky-500', input: 'bg-blue-700', border: 'border-blue-700' },
            purple: { bg: 'bg-purple-900', container: 'bg-purple-800', text: 'text-white', subtleText: 'text-purple-200', primaryBtn: 'bg-fuchsia-500 hover:bg-fuchsia-600', secondaryBtn: 'bg-purple-700 hover:bg-fuchsia-500', input: 'bg-purple-700', border: 'border-purple-700' },
            pink: { bg: 'bg-pink-100', container: 'bg-white', text: 'text-pink-800', subtleText: 'text-pink-500', primaryBtn: 'bg-pink-500 hover:bg-pink-600', secondaryBtn: 'bg-pink-100 hover:bg-pink-200 text-pink-700', input: 'bg-pink-50 text-pink-900', border: 'border-pink-300' },
            gray: { bg: 'bg-gray-200', container: 'bg-white', text: 'text-gray-900', subtleText: 'text-gray-600', primaryBtn: 'bg-gray-800 hover:bg-gray-900', secondaryBtn: 'bg-gray-100 hover:bg-gray-300 text-gray-800', input: 'bg-gray-100 text-gray-800', border: 'border-gray-300' }
        };

        function applyTheme(themeName) {
            const theme = themes[themeName] || themes.default;
            const allThemeClasses = [...new Set(Object.values(themes).flatMap(t => Object.values(t)).join(' ').split(' '))];
            
            const themedElements = document.querySelectorAll('.themed-container, .themed-text, .themed-subtle-text, .themed-primary-btn, .themed-input, .themed-border');
            
            document.body.classList.remove(...allThemeClasses);
            themedElements.forEach(el => el.classList.remove(...allThemeClasses));

            document.body.classList.add(theme.bg, theme.text);
            document.querySelectorAll('.themed-container').forEach(el => el.classList.add(theme.container));
            document.querySelectorAll('.themed-text').forEach(el => el.classList.add(theme.text));
            document.querySelectorAll('.themed-subtle-text').forEach(el => el.classList.add(theme.subtleText));
            document.querySelectorAll('.themed-primary-btn').forEach(el => el.classList.add(...theme.primaryBtn.split(' ')));
            document.querySelectorAll('.themed-input').forEach(el => el.classList.add(...theme.input.split(' ')));
            document.querySelectorAll('.themed-border').forEach(el => el.classList.add(theme.border));
            
            choicesContainerElement.dataset.secondaryBtnClass = theme.secondaryBtn;
        }
        
        function updateInventoryDisplay() {
            inventoryList.innerHTML = '';
            const itemMap = {
                hasKey: "Small Ornate Key", hasCoins: "8 Gold Coins", lotteryTicket: "Winning Lottery Ticket ($100)", bossMug: "Chipped 'World's Best Boss' Mug", stevesCard: "Steve's Business Card", hasCarInfo: "Note with Phone # (Corvette)", hasGlock: "Gold 9mm Glock", giftCard: "Starbucks Gift Card", tirePlugs: "Tire Plug Kit", gum: "Pack of Gum", cones: "Raw Cones", bluntWrap: "Blunt Wrap", candy: "Partner's Favorite Candy", embarrassingPhoto: "Embarrassing High School Photo", fiveDollars: "$5 Bill", silverDollar: "Old Silver Dollar", oldCasinoChip: "Old Casino Chip", guitarPick: "Worn Guitar Pick", silverLocket: "Silver Locket", pocketKnife: "Classic Pocket Knife", mixCD: "Old Mix CD"
            };
            const items = Object.keys(itemMap).filter(key => playerState[key]).map(key => itemMap[key]);

            if (items.length > 0) {
                inventoryContainer.classList.remove('hidden');
                items.forEach(item => {
                    const li = document.createElement('li');
                    li.textContent = item;
                    inventoryList.appendChild(li);
                });
            } else {
                inventoryContainer.classList.add('hidden');
            }
        }

        function initializeGame() {
            const username = usernameInput.value.trim();
            currentUser = username;
            playerNameElement.innerText = currentUser;

            const savedData = loadProgress();
            if (savedData && savedData.nodeId) {
                playerGender = savedData.gender;
                playerState = { ...defaultPlayerState, ...savedData.state };
                welcomeScreen.classList.add('hidden');
                gameContainer.classList.remove('hidden');
                gameContainer.classList.add('fade-in');
                showStoryNode(savedData.nodeId);
            } else {
                usernameInput.classList.add('hidden');
                startButton.classList.add('hidden');
                document.querySelector('#welcome-screen .themed-subtle-text').innerText = `Welcome, ${currentUser}. Select your gender.`;
                genderSelectionContainer.classList.remove('hidden');
            }
        }
        
        window.addEventListener('load', () => {
            const savedTheme = localStorage.getItem('adventureGameTheme');
            if (savedTheme) {
                applyTheme(savedTheme);
                colorSelectionScreen.classList.add('hidden');
                welcomeScreen.classList.remove('hidden');
            } else {
                colorSelectionScreen.classList.remove('hidden');
                welcomeScreen.classList.add('hidden');
            }

            document.querySelectorAll('.theme-btn').forEach(button => {
                button.addEventListener('click', () => {
                    const themeName = button.dataset.theme;
                    localStorage.setItem('adventureGameTheme', themeName);
                    applyTheme(themeName);
                    colorSelectionScreen.classList.add('hidden');
                    welcomeScreen.classList.remove('hidden');
                    welcomeScreen.classList.add('fade-in');
                });
            });
        });

        function setGenderAndStart(gender) {
            playerGender = gender;
            playerState = { ...defaultPlayerState };
            welcomeScreen.classList.add('hidden');
            gameContainer.classList.remove('hidden');
            gameContainer.classList.add('fade-in');
            showStoryNode(1);
        }
        
        startButton.addEventListener('click', () => {
            if (usernameInput.value.trim() === '') {
                usernameInput.placeholder = "Please enter a name!";
                usernameInput.classList.add('placeholder-red-400', 'ring-2', 'ring-red-500');
                return;
            }
            initializeGame();
        });

        usernameInput.addEventListener('keyup', (event) => {
            if (event.key === 'Enter' && usernameInput.value.trim() !== '') {
                initializeGame();
            }
        });

        maleButton.addEventListener('click', () => setGenderAndStart('male'));
        femaleButton.addEventListener('click', () => setGenderAndStart('female'));

        resetButton.addEventListener('click', () => {
            localStorage.removeItem('adventureGameProgress');
            localStorage.removeItem('adventureGameTheme');
            window.location.reload();
        });

        function showStoryNode(storyNodeId) {
            // --- SPECIAL ROUTING LOGIC ---
            if (storyNodeId === 7000) return showStoryNode(playerGender === 'male' ? 7001 : 7010);
            if (storyNodeId === 90001) { // Router for after shopping
                const nextNode = playerState.postReadyNodeId || 1; 
                playerState.postReadyNodeId = null; // Clear state after use
                return showStoryNode(nextNode);
            }
            if (storyNodeId === 6004 && playerGender === 'female') return showStoryNode(6007);
            if (storyNodeId === 2011 && playerState.hasCoins) return showStoryNode(1201);
            if (storyNodeId === 8009 && playerState.pocketKnife) storyNodeId = 80091;

            const storyNode = story.find(node => node.id === storyNodeId);

            if (!storyNode) {
                console.error(`Story node with id ${storyNodeId} not found!`);
                return showStoryNode(1);
            }

            // Save progress whenever a node is successfully displayed
            saveProgress(storyNodeId);

            let textToDisplay = storyNode.text;
            if (playerGender === 'female' && storyNode.textFemale) {
                textToDisplay = storyNode.textFemale;
            }

            storyTextElement.classList.remove('fade-in');
            void storyTextElement.offsetWidth;
            storyTextElement.classList.add('fade-in');
            storyTextElement.innerText = textToDisplay;

            choicesContainerElement.innerHTML = '';
            
            let choices = [...(storyNode.choices || [])];

            // --- CONDITIONAL CHOICES LOGIC ---
            if (storyNode.id === 6002 && playerState.cones && playerGender === 'male') {
                choices.unshift({ text: "Offer to pack a few cones.", nextId: 6010 });
            }
             if (storyNode.id === 3006) {
                if (playerState.mixCD) choices.unshift({ text: "Play the old mix CD.", nextId: 3010 });
                if (playerState.gum) choices.unshift({ text: "Offer her a piece of gum.", textFemale: "He offers you a piece of gum.", nextId: 3008 });
                if (playerState.candy) choices.unshift({ text: "Offer her the candy.", textFemale: "He offers you the candy.", nextId: 3009 });
            }
            if (storyNode.id === 138 && playerState.heardGossip) {
                choices.unshift({ text: "Make a joke about the parking gate.", nextId: 139 });
            }
            if ((storyNode.id === 900 || storyNode.id === 322 || storyNode.id === 312) && playerState.lotteryTicket) {
                choices.unshift({ text: "Use your $100 lottery ticket to make the night special.", nextId: 1999 });
            }
            if (storyNode.id === 2000) {
                if (playerState.silverDollar) choices.unshift({ text: "Tell her about the cat and the silver dollar.", nextId: 2020 });
                if (playerState.oldCasinoChip) choices.unshift({ text: "Show her the old casino chip you found.", nextId: 2022 });
                if (playerState.guitarPick) choices.unshift({ text: "Tell her you found your old guitar pick.", nextId: 2024 });
                if (playerState.silverLocket) choices.unshift({ text: "I have something for you.", nextId: 2028 });
            }
            if (storyNode.id === 6003 && playerGender === 'female' && playerState.stevesCard) {
                const aaaIndex = choices.findIndex(c => c.nextId === 6004);
                if (aaaIndex !== -1) choices[aaaIndex] = { text: "Call Steve for help.", nextId: 6009 };
            }
            if (storyNodeId === 6003 && playerGender === 'female') {
                choices = choices.filter(choice => choice.nextId !== 6005 && choice.nextId !== 6006);
            }
            if (storyNode.id === 89 && playerGender === 'female') {
                choices = [
                    { text: "A blue dress", nextId: 1000 }, { text: "A black skirt with pink blouse and white sweater", nextId: 1001 },
                    { text: "A black hoodie and a pair of jeans", nextId: 1002 }, { text: "Sweatpants and a cutoff shirt", nextId: 1003 }
                ];
            }
            if (storyNode.id === 33 && playerGender === 'female') {
                choices.unshift({ text: "Call your friend Tammy.", nextId: 10020 });
            }
            if (storyNode.id === 34 && playerGender === 'female') {
                choices.unshift({ text: "Go to the drive-through for lunch.", nextId: 10025 });
                choices.push({ text: "Visit the pet store at the mall.", nextId: 10030 });
            }
            if (storyNode.id === 7012 && playerGender === 'female') {
                choices.push({ text: "Do a quick DIY nail art project.", nextId: 10035 });
            }

            updateInventoryDisplay();

            choices.forEach(choice => {
                const button = document.createElement('button');
                let choiceText = choice.text;

                // Handle gender-specific text in choices
                if (playerGender === 'female' && choice.textFemale) {
                    choiceText = choice.textFemale;
                }
                
                const secondaryBtnClasses = choicesContainerElement.dataset.secondaryBtnClass || themes.default.secondaryBtn;
                button.innerText = choiceText;
                button.className = 'w-full text-white font-semibold py-3 px-4 rounded-lg shadow-md transition-all duration-300 ease-in-out transform hover:scale-105 fade-in';
                button.classList.add(...secondaryBtnClasses.split(' '));
                button.addEventListener('click', () => selectChoice(choice));
                choicesContainerElement.appendChild(button);
            });
        }

        function selectChoice(choice) {
            // If the choice sets state, apply it before moving on
            if (choice.setState) {
                Object.assign(playerState, choice.setState);
            }

            let nextNodeId = choice.nextId;
            // Handle gender-specific routing in choices
            if (playerGender === 'female' && choice.nextIdFemale) {
                nextNodeId = choice.nextIdFemale;
            }

            showStoryNode(nextNodeId);
        }

        function saveProgress(nodeId) {
            try {
                const allProgress = JSON.parse(localStorage.getItem('adventureGameProgress')) || {};
                allProgress[currentUser] = { nodeId, gender: playerGender, state: playerState };
                localStorage.setItem('adventureGameProgress', JSON.stringify(allProgress));
            } catch (e) {
                console.error("Could not save progress:", e);
            }
        }

        function loadProgress() {
            try {
                const allProgress = JSON.parse(localStorage.getItem('adventureGameProgress')) || {};
                return allProgress[currentUser];
            } catch (e) {
                console.error("Could not load progress:", e);
                return null;
            }
        }
    </script>
</body>
</html>
